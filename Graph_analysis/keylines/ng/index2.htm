<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <link rel="stylesheet" href="bootstrap.css"/>
    <link rel="stylesheet" href="../css/keylines.css"/>
    <style type='text/css'>
      ul.selected-items {
        padding: 0;
        margin: 0;
      }
      .selected-items li {
        list-style-type: none;
      }
      .rhs-panel {
        max-height: 650px;
        overflow-y: auto;
      }
      .panel {
        padding: 5px;
        margin-bottom: 10px;
        border: 1px solid #E0E0E0;
        border-radius: 3px;
      }
      #timebarId, #chartId {
        border-left: 1px solid #E0E0E0;
        border-right: 1px solid #E0E0E0;
        border-top: 1px solid #E0E0E0;
      }
      #timebarId {
        margin-top: -5px;
        border-bottom: 1px solid #E0E0E0;
      }
    </style>
    <title>Angular & KeyLines demo: chart and timebar</title>
  </head>
  <body>


    <div class="container" ng-app='myApp' ng-controller='MyController'>

      <h1>KeyLines AngularJS Demo 2 (Beta)</h1>
      <div class="row">
        <div class="col-md-8">
          <div class="components-container">

              <div
                id='chartId'
                style='width:744px; height:430px;'
                kl-base-path='../'
                kl-selected='selected'
                kl-chart='chart'
                kl-options='chartOptions'>
              </div>

              <div
                id='timebarId'
                style='width:744px; height: 200px;'
                kl-base-path='../'
                kl-options='timebarOptions'
                kl-timebar='timebar'>
              </div>

          </div>
        </div>
        <div class="col-md-4 rhs-panel">
          <div class="row">
            <div class="col-md-12">
              <div class='panel'>
                <legend>Chart controls</legend>
                <div class='checkbox'>
                  <label>
                    <input type='checkbox' ng-model='chartOptions.handMode'>
                    Hand mode
                  </label>
                </div>
              </div>
              <div class='panel'>
                <legend>Time bar controls</legend>
                <button class='btn btn-large' ng-click='zoom("in")'> Zoom in </button>
                <button class='btn btn-large' ng-click='zoom("out")'> Zoom out </button>
              </div>
              <div class='panel'>
                <legend>Chart and time bar controls</legend>
                <label>Set background colour</label>
                <div class='radio'>
                  <label>
                    <input type='radio' ng-model='bg' value='white' ng-change='changeColour()'>
                    White
                  </label>
                </div>
                <div class='radio'>
                  <label>
                    <input type='radio' ng-model='bg' value='grey' ng-change='changeColour()'>
                    Grey
                  </label>
                </div>
                <div class='radio'>
                  <label>
                    <input type='radio' ng-model='bg' value='black' ng-change='changeColour()'>
                    Black
                  </label>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>


      <div class="row">
        <div class="col-md-8">
          <h4> Notes </h4>
          <p> View page source for implementation details </p>
          <p>
            <ul>
              <li> kl-chart='myChart' gives access to standard KeyLines chart methods on 'myChart'</li>
              <li> kl-timebar='myTimeBar' gives access to standard KeyLines time bar methods on 'myTimeBar' </li>
              <li> The last part of the event name within $scope.$on identifies the component that raised it. For example 'kl:hover:timebarId' is the hover event on the component that has the id 'timebarId'. </li> 
            </ul>
          </p>
          
        </div>
      </div>

      <script src="angular.js"></script>
      <script src="../js/keylines.js"></script>
      <script src="ng-keylines.js"></script>

      <script>
        function randomData() {
          function randInt(begin, end) {
            return Math.floor(Math.random() * (end - begin)) + begin;
          }
          var items = [];
          var date = new Date().getTime();
          for (var i = 0; i < 20; i++) {
            date -= (1000 * 60 * 60);
            items.push({
              id: 'item' + i,
              type: 'node',
              c: 'rgb(20, 100, 200)',
              t: 'item' + i
            });
            items.push({
              id: 'link' + i,
              type: 'link',
              dt: date,
              id1: 'item' + i,
              id2: 'item' + ((i > 10) ? randInt(0, 11) : randInt(11, 20)),
              v: randInt(1, 10)
            });
          }
          return {type: 'LinkChart', items: items};
        }

        var data = randomData();
        var defaultSliderColour, defaultFontColour;

        angular.module('myApp', ['myApp.controllers', 'keylines']);

        angular.module('myApp.controllers', []).
          controller('MyController', function($scope, $http) {

            $scope.$on('kl:ready:timebarId', function () {
              defaultSliderColour = $scope.timebar.options().sliderColour;
              defaultFontColour = $scope.timebar.options().fontColour;
              $scope.timebar.load(data, function () {
                $scope.timebar.zoom('fit');
              });
            });

            $scope.$on('kl:ready:chartId', function () {
              $scope.chart.load(data, function () {
                $scope.chart.layout('standard', function () {
                  $scope.chart.zoom('fit');
                });
              });
            });

            // all keylines events are prefixed with kl and be captured like so:
            $scope.$on('kl', function (event, eventName, componentId, componentType) {

            });

            // event shared by timebar and chart
            $scope.$on('kl:hover', function (event, componentId, type) {
              
            });

            // click event for all chart components (timebar doesn't raise click events)
            $scope.$on('kl:click', function (event, componentId, type, id, x, y, button, sub) {
              
            });

            $scope.chartOptions = {backColour: 'white', overview: false, controlColour: 'grey', selectionColour: '#44D'};
            $scope.timebarOptions = {backColour: 'white'};

            //for convenience we define a scope level variable for the background colour of both timebar and chart
            $scope.bg = 'white';

            $scope.changeColour = function () {
              $scope.chartOptions.backColour = $scope.bg;
              $scope.timebarOptions.backColour = $scope.bg;
              // change slider colour for timebar also (to look nicer with BG)
              switch ($scope.bg) {
                case 'white':
                  $scope.timebarOptions.sliderColour = defaultSliderColour;
                  $scope.timebarOptions.fontColour = defaultFontColour;
                  break;
                case 'grey':
                  $scope.timebarOptions.sliderColour = 'rgba(0, 0, 0, 0.3)';
                  $scope.timebarOptions.fontColour = 'white';
                  break;
                case 'black':
                  $scope.timebarOptions.sliderColour = 'rgba(0, 0, 0, 0.7)';
                  $scope.timebarOptions.fontColour = defaultFontColour;
                  break;
              }
            };

            $scope.zoom = function (type) {
              $scope.timebar.zoom(type, {animate: true, time: 400});
            };

          });
      </script>

  </body>
</html>
