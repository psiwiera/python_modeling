//
//     KeyLines v2.7.1-2069 professional eval
//
//     Copyright Â© 2011-2015 Cambridge Intelligence Limited. 
//     All rights reserved.
//

KeyLines="undefined"!=typeof KeyLinesServer?exports:"undefined"!=typeof KeyLines?KeyLines:{},KeyLines.TimeBar={},!function(){var e=KeyLines.Model={};e.createModel=function(e,t,n){function r(e,t){switch(e){case"x1":return et[t.id1].x;case"y1":return et[t.id1].y;case"x2":return et[t.id2].x;case"y2":return et[t.id2].y}}function i(e){"node"===e.type&&(e.x||(e.x=0),e.y||(e.y=0))}function a(e,t){var n={},r={};if(e)for(var a=0;a<e.length;a++){var o=e[a];if(o.id&&!(o.id in n||o.id in r)){var u=null;if("node"===o.type){u=n;var s=!0;t&&et[o.id]&&(s=!1),s&&i(o)}"link"===o.type&&(u=r),u&&(u[o.id]=Q.clone(o))}}return{nodes:n,links:r}}function o(){function e(e){var n=Q.clone(e,!0);n.id=Q.rawId(e.id),t.push(n)}var t=[];return Q.iterator(tt,e),Q.iterator(et,e),t}function u(e){at(e.items)}function s(e){var t=[];for(var n in e)("undefined"==typeof e[n]||null===e[n])&&t.push(n);for(n in t)delete e[t[n]]}function c(e,t){var n,r;if(e){for(r=0;r<ut.length;r++)n=ut[r],e[n]&&(e[n]=Number(e[n])),e[n]<0&&!dt[n]&&(e[n]=null);for(r=0;r<st.length;r++)n=st[r],Q.isNullOrUndefined(e[n])||(e[n]=e[n]+"");for(r=0;r<ct.length;r++)n=ct[r],e[n]&&(e[n]=$.validatergb(e[n])?e[n]:void 0);for(r=0;r<lt.length;r++)delete e[lt[r]];if(t)for(r=0;r<ft.length;r++)delete e[ft[r]]}}function f(e,t){var n={};if(e&&Q.isArray(e))for(var r=e.length-1;!t&&r>=0;r--){var i=e[r].p;!i||!/(ne|nw|se|sw)/.test(i)&&2!==i.length?e.splice(r,1):n[i]?e.splice(r,1):n[i]=1}}function l(e,t){for(var n=0;n<ht.length;n++){var r=ht[n],i=e[r];i&&(t?i.hasOwnProperty("c")||i.hasOwnProperty("r")||i.hasOwnProperty("w")||delete e[r]:i.hasOwnProperty("c")&&i.hasOwnProperty("r")&&i.hasOwnProperty("w")||delete e[r])}}function d(e){if(Q.isArray(e.bu))delete e.bu;else{e.bu.p||(e.bu.p="ne");var t=e.bu.p;/(ne|nw|se|sw)/.test(t)||2===t.length||delete e.bu}}function h(e){var t={};for(var n in e)e[n].id1!==e[n].id2&&(t[n]=e[n]);return t}function v(e,t){var n={};for(var r in e)g(e[r],t)&&(n[r]=e[r]);return n}function g(e,t){return t=t||{},(et[e.id1]||t[e.id1])&&(et[e.id2]||t[e.id2])}function m(e,t){for(var n in tt){var r=tt[n];(et[r.id1][e]===t||et[r.id2][e]===t)&&(tt[n][e]=t)}}function y(e,t){e[t]&&bt(e.id,!0)}function p(e){for(var t in tt)y(tt[t],e);for(t in et)y(et[t],e)}function x(){w("hi")}function w(e,t){m(e,!0),t||p(e),"hi"===e&&P()}function M(e,t,n){for(var r=0;r<e.length;r++)et[e[r]]&&(et[e[r]][t]=n),tt[e[r]]&&(tt[e[r]][t]=n)}function b(e,t){var n=!1;return et[e]&&(n=T(et[e],t)),tt[e]&&(n=T(tt[e],t)),n}function k(e){return(et[e]||tt[e])&&!(b(e,"hi")||b(e,"gh"))}function T(e,t){return e[t]?!0:!1}function S(e,t,n){e=Q.ensureArray(e),M(e,t,!1);var r;if(w(t),n){var i={};for(r=0;r<e.length;r++)i[e[r]]=1;for(r in tt)T(tt[r],t)&&(T(et[tt[r].id1],t)||T(et[tt[r].id2],t)||(i[tt[r].id1]||i[tt[r].id2])&&(tt[r][t]=!1))}}function C(e){var t,n=[];for(t in et)t=Q.rawId(t),et[t][e]&&n.push(t);for(t in tt)t=Q.rawId(t),tt[t][e]&&n.push(t);return n}function I(e,t){e=Q.ensureArray(e),M(e,t,!0),w(t)}function L(e){var t={};for(var n in e)"undefined"==typeof e[n].off&&(t[n]=e[n]);return t}function O(){var e=E(et);return e=E(tt)||e}function E(e){var t=!1;for(var r in e){var i=e[r];if(t=D(i)||t,n.itemHasGlyph(i))for(var a=0;a<i.g.length;a++)t=D(i.g[a])||t;i.bu&&(t=D(i.bu.g)||t)}return t}function D(e){if(e){var t=e.u;if(t&&!(t in yt))return yt[t]=1,!0}}function P(){X=V=null}function A(e){var t={};for(var n in e){var r=e[n];r.hi||(t[n]=r)}return t}function z(e){for(var t in e)Mt(t,!0)}function N(t){var n=KeyLines.Graph.create(e);return n.privateSetProperties(et,t),n}function B(){return N(tt).connections()}function U(e,t){for(var n=N(e).sortedAdjacency({all:!0}).find,r=B(),i={},a=0;a<r.length;a++){var o=tt[r[a][0]];n(o.id1,o.id2)&&(i[a]=1)}t(r,i)}function R(e){for(var t={},n=0;n<e.length;n++){var r=e[n],i=tt[r];i&&(t[r]=i)}return t}function K(){H(B())}function F(){for(var e in tt){var t=tt[e];delete t.st}}function _(e,t,n,r){function i(e,t){return a(tt[e])-a(tt[t])}function a(e){var t=Q.defined(e.off)?e.off:s;return e.id1>=e.id2&&(t=-t),t}function o(e,t){r(e,e.id1<e.id2?t:-t)}var u,s=1e6,c=t||e,f=40;Q.iterator(c,function(t,r){u=e[r],n||(u=Q.filter(u,function(e){return!tt[e].gh})),u.sort(i);for(var a=Math.floor(u.length/2),s=(u.length+1)%2/2,c=0;c<u.length;c++){var l=tt[u[c]];o(l,(c-a+s)*f)}})}function H(e,t){function n(e,t){e.off=t}_(e,t,!0,n)}function j(e,t,n){function r(e,t){i.push({id:e.id,off:t})}var i=[];return _(e,t,n,r),i}function Y(){for(var e=B(),t={},n=0;n<e.length;n++){var r=!1,i=e[n];if(i.length>1){for(var a=0;a<i.length;a++){var o=tt[i[a]];o&&(r=r||"undefined"!=typeof o.off)}r||(t[n]=1)}}H(e,t)}function G(e){return(e+"").match(Lt)}function W(e){var t=G(e);return Ot[t[2]]}function q(e){var t=G(e);return t?t[1]:null}var X,V,Z,$=KeyLines.Rendering,Q=KeyLines.Util,J={},et={},tt={},nt=Q.idSep(),rt=null,it=KeyLines.Layouts.create();J.graph=function(){return rt||(rt=KeyLines.Graph.create(e),rt.privateSetProperties(et,tt)),rt},J.load=function(e){if(e){et={},tt={},Tt(!0),u(e);var t=a(e.items);et=t.nodes,tt=v(t.links),tt=h(tt),x(),Y(tt),rt=null}O()};var at=J.ensureTypesInArray=function(e,t){if(e)for(var n=0;n<e.length;n++)ot(e[n],t)},ot=J.ensureObject=function(e,t){c(e,t),e.g&&(Q.isArray(e.g)?(at(e.g),f(e.g,"link"===e.type)):delete e.g),l(e,t),e.bu&&d(e)};J.defaultValueFor=function(e){switch(e){case"e":return 1;case"fs":return n.fontSize;case"off":return 0;case"x":case"y":return 0;case"w":case"h":return 1;case"bw":return 4;case"c":case"b":return $.colours.midgrey;case"fc":return $.colours.black;case"fbc":return $.colours.textback}};var ut=["x","y","w","h","e","fs","off","b1","b2","bw"],st=["t","u","id","id1","id2","ff","sh","p","ls","bs"],ct=["c","b","fc","fbc"],ft=["hi","bg","ci","du","fb","a1","a2","re","tc","a"],lt=["gh"],dt={x:1,y:1,off:1},ht=["ha0","ha1","ha2","ha3","ha4","ha5","ha6","ha7","ha8","ha9"];J.bothEndsShown=function(e){return!(et[e.id1].hi||et[e.id2].hi)},J.ensureBackgroundConsistency=function(){w("bg",!0)},J.resurrect=function(e,t){S(e,"gh",t)},J.ghost=function(e){I(e,"gh")},J.show=function(e,t){S(e,"hi",t)},J.hidden=function(){return C("hi")},J.hide=function(e){I(e,"hi")},J.each=function(e,t){if(e.type.match(/^(node|all)$/))for(var n in et)t(et[n]);if(e.type.match(/^(link|all)$/))for(var r in tt)t(tt[r])},J.setItem=function(e){ot(e);var t=null;return"node"===e.type&&(t=et),"link"!==e.type||(t=tt,g(e))?(i(e),e.id&&(t[e.id]=Q.clone(e),e.hi?x():P()),O()):!1};var vt=J.type=function(){return"LinkChart"};J.setOptions=function(e){Z=e.marqueeLinkSelection,t.setOptions(e),n.setOptions(e)},J.serialize=function(){return{type:vt(),items:o()}};var gt=J.applyChanges=function(e,t){var n,r,i,a,o,u,c;for(n=0;n<e.length;n++){if(r=Q.rawId(e[n].id))if(u=[],t){c=new RegExp(r,"im");for(i in et)c.test(i)&&u.push(et[i]);for(a in tt)c.test(a)&&u.push(tt[a])}else et[r]&&u.push(et[r]),tt[r]&&u.push(tt[r]);var f=Q.clone(e[n]);for(delete f.id,delete f.type,o=0;o<u.length;o++)u[o]=Q.merge(u[o],f),s(u[o])}};J.setProperties=function(e,t){e=Q.ensureArray(e),at(e),gt(e,t),x();var n=O();return n},J.merge=function(e,t){t=t||{},at(e);var n=a(e,!0);n.links=v(n.links,n.nodes),n.links=h(n.links);for(var r in n.nodes)et[r]=Q.merge(et[r],n.nodes[r]);for(var i in n.links)tt[i]=Q.merge(tt[i],n.links[i]);if(!t.preserveOffsets){var o=L(n.links);Ct(o)}x();var u=O();return u},J.getItem=function(e){var t=mt(e);return Q.clone(t,!0)};var mt=J.getByID=function(e){return e=Q.rawId(e),et[e]||tt[e]},yt={};J.imageList=function(e){var t={};for(var n in yt)t[e+n]=1;return t};var pt=J.generate=function(e,t,r,i,a,o,u){X||(X=A(et),V=A(tt)),n.generate(X,V,e,t,r,i,a,o,u,kt,wt)};J.resetDrawing=function(){n.reset()},J.generateSelection=function(e,t,n,r,i,a){pt(e,t,n,r,i,function(e){return e.id in xt},a)},J.contains=function(e){return n.contains(e,et)},J.animated=function(){return n.animated()};var xt={},wt=[];J.setSelection=function(e,t,n){e=Q.rawId(e),t||n||Tt(e),xt[e]?t&&bt(e):Mt(e)};var Mt=J.addToSelection=function(t,n){t=Q.rawId(t),t&&(xt[t]||k(t)&&(xt[t]=1,wt.push(t),n||e.trigger("selectionchange")))},bt=J.removeFromSelection=function(t,n){if(t=Q.rawId(t),xt[t]){delete xt[t];var r=Q.indexOf(wt,t);r>-1&&wt.splice(r,1),n||e.trigger("selectionchange")}};J.hasSelection=function(){return wt.length>0};var kt=J.isSelected=function(e){return e=Q.rawId(e),e in xt},Tt=J.clearSelection=function(t){xt={},wt=[],t||e.trigger("selectionchange")};J.selectAll=function(){z(et),z(tt),e.trigger("selectionchange")};var St=J.doSelection=function(e){if(e){Tt(!0);for(var t=0;t<e.length;t++)Mt(e[t],!0)}return Q.clone(wt)};J.moveSelection=function(e,t){var n=[];if(xt){for(var r in et)kt(r)&&n.push(r);for(var i in tt)kt(i)&&(et[tt[i].id1].du&&n.push(tt[i].id1),et[tt[i].id2].du&&n.push(tt[i].id2))}for(var a=0;a<n.length;a++){var o=et[n[a]];o.x+=e,o.y+=t}},J.removeItem=function(e,t){t=t||{};var n;e=Q.ensureArray(e);for(var r={},i={},a=0;a<e.length;a++)n=e[a],tt[n]&&(r[n]=tt[n]),et[n]&&(i[n]=1);for(n in tt)(i[tt[n].id1]||i[tt[n].id2])&&(r[n]=tt[n]);for(n in r)bt(n,!0),delete tt[n];for(n in i)bt(n,!0),delete et[n];t.preserveOffsets||Ct(r),P()},J.selectionPlusDummyNodes=function(){for(var e=St(),t=0;t<e.length;t++){var n=tt[e[t]];n&&(et[n.id1].du&&e.push(n.id1),et[n.id2].du&&e.push(n.id2))}return e};var Ct=J.resetConnectionOffsets=function(e){U(e,H)},It=function(e,t){var n;return U(e,function(e,r){n=j(e,r,t)}),n};J.showHideBendLinks=function(e){var t=R(e);Ct(t)},J.showHideGetLinksToBend=function(e,t){for(var n=R(e),r=It(n,t),i=[],a=0;a<r.length;a++){var o=r[a];tt[o.id].off!==o.off&&i.push(o)}return i},J.getCursor=function(e,t){var n=q(e);return n?n:e?'url("'+t+'openhand.cur"), pointer':"auto"},J.getResizePrimitive=function(){return n.getResizePrimitive()};var Lt=new RegExp(nt+"((\\S+)(?:\\-resize))$"),Ot={nw:["x1","y1"],n:["y1"],ne:["x2","y1"],e:["x2"],se:["x2","y2"],s:["y2"],sw:["x1","y2"],w:["x1"]},Et=new RegExp(nt+"(id[1|2])$");J.startDragger=function(e,n,r,i,a,o,u){var s=(u+"").match(Et),c=Q.rawId(i);return t.createLinkEndDragger(e,J,r,et,tt[c],s[1],a,o,c)},J.createDragger=function(n,i,a,o,u,s,c,f,l,d,h,v){var g=l.handMode,m=Q.rawId(s),y=G(s);if(y){var p=W(s),x=v;return t.primitiveMover($,o,u,m,x,!0,p,c,f,function(t){e.trigger("prechange","resize");var n=et[Q.rawId(s)];if("C"===t.p)n.x=u.newToOldX(t.x),n.y=u.newToOldY(t.y),n.w=n.h=2*u.undim(t.r);else{var r=u.newToOldX(t.x1),i=u.newToOldY(t.y1),a=u.newToOldX(t.x2),o=u.newToOldY(t.y2);n.x=r+Math.floor((a-r)/2),n.y=i+Math.floor((o-i)/2),n.w=a-r,n.h=o-i}})}if(null!==m&&tt[m]&&"h"!==tt[m].st){var w=(s+"").match(Et);return w?t.createLinkEndDragger(a,J,u,et,tt[m],w[1],c,f,m):t.createLinkDragger(r,o,u,tt[m],c,f,m)}return g&&null===s?t.createHandDragger(u,c,f,Tt):null!==m?t.createDefaultDragger(et,tt,kt,o,u,s,c,f):Dt(n,i,o,u,m,c,f,d,h,l.crossingBox)};var Dt=function(t,n,r,i,a,o,u,s,c,f){function l(e,t){x.x1=Math.min(i.oldToNewX(y),e),x.y1=Math.min(i.oldToNewY(p),t),x.x2=Math.max(i.oldToNewX(y),e),x.y2=Math.max(i.oldToNewY(p),t)}function d(e,t,n){for(var r in e)e[r]?Mt(r,!0):t||n?g[r]||bt(r,!0):bt(r,!0)}function h(e,t,n,r){l(e,t);var a={};a.x1=i.newToOldX(x.x1),a.y1=i.newToOldY(x.y1),a.x2=i.newToOldX(x.x2),a.y2=i.newToOldY(x.y2);var o={};for(var u in et)o[u]=$.inside(a,et[u].x,et[u].y);if("off"!==Z)for(var s in tt)if("centre"===Z)o[s]=$.inside(a,tt[s]._x,tt[s]._y);else if("ends"===Z){var c=et[tt[s].id1],f=et[tt[s].id2];o[s]=$.inside(a,c.x,c.y)&&$.inside(a,f.x,f.y)}d(o,n,r)}function v(e,i,a,o){if(l(e,i),t){var u,s={};t.each(function(e){if(e.p!==$.primitives.line&&e.p!==$.primitives.arc&&""!==e.p){var t=$.extents(r,e);u=Q.rawId(e.id),s[u]=s[u]||$.intersects(x,t)}}),n.each(function(e){u=Q.rawId(e.id),s[u]=s[u]||$.inside(x,e.x,e.y)}),d(s,a,o)}}if(!e.trigger("dragstart","area",null,i.unscale(o),i.unscale(u),null)){var g={};for(var m in xt)g[m]=1;var y=i.newToOldX(o),p=i.newToOldY(u),x={p:$.primitives.rect,x1:o,y1:u,x2:o,y2:u,bc:$.colours.midgrey,bw:1,fc:$.colours.blue,fi:!1},w={scrollable:!0,getCursor:function(){return"crosshair"},generate:function(e){e.copyPrimitive(x)},dragMove:function(e,t,n,r){e>o||!f?h(e,t,n,r):v(e,t,n,r)},endDrag:function(t,n,r){i.cancelScroll();var a=e.trigger("dragend","area",null,i.unscale(n),i.unscale(r));a||(t?e.trigger("selectionchange"):Tt()),e.trigger("dragcomplete","area",null,i.unscale(n),i.unscale(r))}};return w}};return J.createGestureDragger=function(t,n,r){function i(e,n,r){var i=2*-e*Math.PI/360;i*=2;var a=Math.sin(i),o=Math.cos(i);for(var u in et)et[u].x=(d[u].x-f)*o+(d[u].y-l)*a+f,et[u].y=-(d[u].x-f)*a+(d[u].y-l)*o+l;var s=t.newToOldX(n),c=t.newToOldY(r);for(var h in et)et[h].x+=s-f,et[h].y+=c-l}function a(e){e=Math.pow(e,2),t.zoomToPosition(e*c,n,r)}function o(e,t,n,r){v=e,g=t,m=n,y=r}function u(){a(v),p=p||Math.abs(g)>12,w=w||Math.abs(m-f)>x||Math.abs(y-l)>x,i(p?g:0,w?m:f,w?y:l)}function s(){for(var e in et)et[e].x=d[e].x,et[e].y=d[e].y}var c=t.zoom(),f=t.newToOldX(n),l=t.newToOldY(r),d={};for(var h in et)d[h]={x:et[h].x,y:et[h].y};var v,g,m,y;o(1,0,f,l);var p=!1,x=60,w=!1,M={animate:function(){u()},getCursor:function(){return"move"},dragMove:function(e,t,n,r){o(e,t,n,r)},endDrag:function(t,n,r,i,a){o(n,r,i,a),t?(s(),e.trigger("prechange","move"),u()):s()}};return M},J.labelPosition=function(e,t){var r=mt(e);return n.labelPosition(r,t)},J.extractStructure=function(e,t,r){return t.straighten&&K(),F(),it.extractStructure(n,e,et,tt,t.fixed,r)},J.layout=function(e,t,n,r,i,a){it.layout(e,t,n,r,i,a)},J.arrange=function(e,t,n,r,i,a){it.arrange(e,t,n,r,i,a)},J.applyVertices=function(e){for(var t in et)e[t]&&(et[t].x=e[t].x,et[t].y=e[t].y)},J.makeAnimator=function(e,t,n){var r=t,i={};for(var a in et)i[a]={x:et[a].x,y:et[a].y};return{animate:function(a){r-=a;var o=n(Math.max(0,(t-r)/t));for(var u in et)e[u]&&(et[u].x=i[u].x+o*(e[u].x-i[u].x),et[u].y=i[u].y+o*(e[u].y-i[u].y));return r>0}}},J}}(),!function(){var e=KeyLines.Graph={};e.create=function(e){function t(e){if(e.direction=e.direction||"any",!/^(any|from|to)$/.test(e.direction))throw new TypeError("opts direction property should be either 'from', 'to' or 'any'")}function n(e){if(e.normalization=e.normalization||"any",!/^(chart|component|unnormalized)$/.test(e.normalization))throw new TypeError("opts normalization property should be either 'component', 'chart' or 'unnormalized'")}function r(e){return y(e,function(t,n,r,i){if(E(r,i,n,e)<=0)throw new Error("Link Weight must be Positive")}),{direction:e.direction,value:e.value,weights:u(e)}}function i(e){return/^(component|chart)$/.test(e.normalization)?e.normalization:"unnormalized"}function a(e){return t(e)||r(e)}function o(e){e.all=!!e.all}function u(e){return!!e.weights}function s(e){var t=0;return p(e,function(){t++}),t}var c=KeyLines.Util,f={},l={},d={},h=e;f.privateSetProperties=function(e,t){l=e,d=t};var v={},g=[],m={},y=function(e,t){var n=e&&e.all;for(var r in d){r=c.rawId(r);var i=d[r];(n||!i.hi)&&t(i,r,i.id1,i.id2)}},p=function(e,t){var n=e&&e.all;for(var r in l){r=c.rawId(r);var i=l[r];(n||!i.hi)&&t(i,r)}},x=function(e,t,n,r){function i(){var t=[];return p(e,function(e){t.push(e)}),t}var a=i(),o=a.length,u=-1,s=(new Date).getTime(),c=s,f=700,l=function(){return u++,u>=o?(d(1),r(),void 0):(n(a[u],g),void 0)},d=function(e){h&&h.trigger("progress",t,e)},v=function(){return s=(new Date).getTime(),s-c>f?(c=(new Date).getTime(),!0):!1},g=function(){v()?(d(u/o),setTimeout(l,0)):l()};d(0),g()},w=function(e,t){return t>e?e:t},M=function(e,t){return t>e?t:e},b=f.sortedAdjacency=function(e){var t={};return y(e,function(e,n,r,i){var a=w(r,i),o=M(r,i);t[a]||(t[a]={}),t[a][o]||(t[a][o]=[]),t[a][o].push(e.id)}),{adj:t,find:function(e,n){var r=w(e,n),i=M(e,n);return t[r]?t[r][i]:void 0}}},k=f.connections=function(e){var t=[],n=b(e).adj;for(var r in n){r=c.rawId(r);for(var i in n[r])i=c.rawId(i),t.push(n[r][i])}return t};f.neighbours=function(e,t){var n=[],r={},i=c.makeIdMap(e);t=c.defaults(t,{all:!1,direction:"any"}),o(t);for(var a in i)if(a=c.rawId(a),!l[a]&&!d[a])throw new Error("neighbours error: ids must be present in the graph");return y(t,function(e,a,o,u){i[o]&&O(o,u,a,t)&&(n.push(a),r[u]=1),i[u]&&O(u,o,a,t)&&(n.push(a),r[o]=1),i[a]&&(O(u,o,a,t)&&(r[u]=1),O(o,u,a,t)&&(r[o]=1))}),{nodes:c.flattenMap(r),links:n}};var T=f.components=function(e){var t,n,r=[],i=0,a=[];e=c.defaults(e,{all:!1}),o(e),S(e);for(t in v)if(!v[t].hasOwnProperty("c")){for(r.push(t+"");r.length>0;){var u=r.shift();if(!v[u].hasOwnProperty("c"))for(v[u].c=i,n=0;n<g.length;n++)g[n].hasOwnProperty("c")||(g[n].id1===u?(g[n].c=i,r.push(g[n].id2)):g[n].id2===u&&(g[n].c=i,r.push(g[n].id1)))}a.push({nodes:[],links:[]}),i++}for(t in v)a[v[t].c].nodes.push(t+"");for(n=0;n<g.length;n++)a[g[n].c].links=a[g[n].c].links.concat(g[n].ids);return a},S=f.reset=function(e){var t,n=k(e),r=0;v={},g=[],p(e,function(e,t){r++,v[t]={x:e.x,y:e.y},m[t]={}});for(var i=0;i<n.length;i++)t=d[n[i][0]],g.push({id:t.id,id1:t.id1,id2:t.id2,ids:n[i]}),t.id1!==t.id2&&(m[t.id1][t.id2]=m[t.id2][t.id1]=n[i])},C=f.distances=function(e,t){if(!l[e])throw new Error("distances error: id(s) must be present in the graph");t=t||{},a(t),o(t);var n=A(e,t),r={};for(var i in n.distance){var u=n.distance[i];isFinite(u)&&(r[i]=u)}return r},I=function(e,t,n){var r,i=m[e][t],a=1/0,o=D(n);if(i)for(var u=0;u<i.length;u++){var s=o(e,t,i[u],n);isNaN(s)||(a>s&&(r=[],a=s),s===a&&1/0!==a&&r.push(i[u]))}return{value:a,links:r}},L=function(e,t){return d[e].a2&&d[e].id2===t||d[e].a1&&d[e].id1===t},O=function(e,t,n,r){return"any"!==r.direction?"from"===r.direction&&L(n,t)||"to"===r.direction&&L(n,e):!0},E=function(e,t,n,r){var i=0/0;return O(e,t,n,r)&&(r.value?d[n].d&&(i=Number(d[n].d[r.value])):i=1),i},D=function(e){return u(e)?P:E},P=function(e,t,n,r){var i=E(e,t,n,r);return isNaN(i)?i:1/i},A=function(e,t){function n(){for(var e,t=1/0,n=0;n<o.length;n++){var r=i[o[n]];t>=r&&(e=n,t=r)}return e}function r(e,t,n){a[e]||(a[e]=[]),a[e].push({id:t,links:n})}var i={},a={},o=[];for(S(t),p(t,function(e,t){i[t]=1/0,a[t]=void 0,o.push(t)}),i[e]=0;o.length>0;){var u=n(),s=o[u];if(1/0===i[s])break;o.splice(u,1);for(var f in m[s]){f=c.rawId(f);var l=I(s,f,t),d=i[s]+l.value;d<i[f]?(i[f]=d,a[f]=[{id:s,links:l.links}]):d===i[f]&&r(f,s,l.links)}}return{distance:i,previous:a}};f.shortestPaths=function(e,t,n){function r(e){for(var t=[],n=0;n<e.length;n++)u[e[n].id]&&(t=t.concat(u[e[n].id]));return t}if(!l[e]||!l[t])throw new Error("shortestPaths error: ids must be present in the graph");n=c.defaults(n,{all:!1}),a(n),o(n);var i=A(e,n),u=i.previous;if(1/0===i.distance[t])return{onePath:[],one:[],items:[],distance:1/0};for(var s=[],f=[],d=t;u[d];)s.unshift(d),f.unshift(d),f.unshift(u[d][0].links[0]),d=u[d][0].id;s.unshift(d),f.unshift(d);var h={};h[t]=1;var v=[];v.push({id:t});for(var g=r(v);g.length>0;){for(var m=0;m<g.length;m++){h[g[m].id]=1;for(var y=0;y<g[m].links.length;y++)h[g[m].links[y]]=1}g=r(g)}return{onePath:f,one:s,items:c.flattenMap(h),distance:i.distance[t]}};var z=f.degrees=function(e){e=c.defaults(e,{multi:!0,all:!1}),a(e),o(e),S(e);var t={};return p(e,function(n,r){t[r]=0;for(var i in m[r]){i=c.rawId(i);for(var a=0;a<m[r][i].length;a++){var o=E(r,i,m[r][i][a],e);if(!isNaN(o)&&(t[r]+=o,!e.multi))break}}}),t};return f.betweenness=function(e,t){function r(e,t){return K[e]-K[t]}function s(e){return e.sort(r),e.shift()}function f(e,t){e.sort(r),c.contains(e,t)||e.push(t)}function l(e,t){var n=I(e,t,O).value;return isFinite(n)?n:M()||isFinite(n)?1/0:1}function d(e){return e.length>0}function h(){z.length=0,N.length=0,p(e,function(e,t){for(var n=0;n<Y.length;n++)g(Y[n].dict,t,Y[n].value)})}function v(e,t,n){p(e,function(e,r){g(t,r,n)})}function g(e,t,n){c.isArray(n)&&d(n)&&e[t]?e[t].length=0:e[t]=c.clone(n)}function y(){var t,n,r,i=T(e),a={};for(t=0;t<i.length;t++)for(r=i[t],n=0;n<r.nodes.length;n++)a[r.nodes[n]]=r.nodes.length;return a}function w(){return!c.isNullOrUndefined(e.value)}function M(){return!!e.directed}function b(){return e.endpoints}e=c.defaults(e,{value:void 0,directed:!1,normalization:"component",endpoints:!1,weights:!1,all:!1}),n(e),o(e);var k=w()||M()?"dijkstra":"regular",C=b()?"endpoints":"regular",L=i(e),O={direction:M()?"from":"any",value:e.value,weights:u(e),all:e.all};a(e);var E,D,P,A={},z=[],N=[],B={},U={},R={},K={};e.normalization;var F,_,H,j=0,Y=[{dict:U,value:0},{dict:K,value:1/0},{dict:B,value:[]},{dict:R,value:0}],G={regular:function(e){for(U[e]=1,K[e]=0,z.push(e);d(z);){E=z.shift(),N.push(E);for(var t in m[E])t=c.rawId(t),isFinite(K[t])||(K[t]=K[E]+1,z.push(t)),K[t]===K[E]+1&&(U[t]+=U[E],B[t].push(E))}},dijkstra:function(e){for(U[e]=1,K[e]=0,z.push(e);d(z);){E=s(z),N.push(E);for(var t in m[E])t=c.rawId(t),K[t]>K[E]+l(E,t)&&(K[t]=K[E]+l(E,t),f(z,t),U[t]=0,B[t]=[]),K[t]===K[E]+l(E,t)&&(U[t]+=U[E],B[t].push(E))}}},W={regular:function(e){for(;d(N);){for(D=N.pop(),_=(1+R[D])/U[D],F=0;F<B[D].length;F++)E=B[D][F],R[E]+=U[E]*_;D!==e&&(A[D]+=R[D])}},endpoints:function(e){for(A[e]+=N.length-1;d(N);){for(D=N.pop(),_=(1+R[D])/U[D],F=0;F<B[D].length;F++)E=B[D][F],R[E]+=U[E]*_;D!==e&&(A[D]+=R[D]+1)}}},q={chart:function(){if(j>2){P=1/((j-1)*(j-2));for(var e in A)e=c.rawId(e),A[e]*=P}},component:function(){H=y();for(var e in A)e=c.rawId(e),H[e]>2&&(P=1/((H[e]-1)*(H[e]-2)),A[e]*=P)},unnormalized:function(){if(!M()){P=.5;for(var e in A)e=c.rawId(e),A[e]*=P}}},X=function(){$(),c.invoke(t,A)},V=G[k]||G.regular,Z=W[C]||W.regular,$=q[L]||q.chart;S(e),p(e,function(){j++}),v(e,A,0);var Q=function(e,t){h(),V(e.id),Z(e.id),t()};x(e,"betweenness",Q,X)},f.closeness=function(e,t){function r(e,t){var n=0;for(var r in t)r=c.rawId(r),n+=isFinite(t[r])?1:0;return n}function u(e){for(var t in e)if(t=c.rawId(t),e.hasOwnProperty(t))return!1;return!0}function f(e){return!c.isNullOrUndefined(e)}function l(e){return!d[e].a1&&!d[e].a2}function h(e){var t={},n=0,r={},i={};for(i[e]=1;!u(i);){r=i,i={};for(var a in r)if(a=c.rawId(a),!f(t[a])){t[a]=n;for(var o in m[a])o=c.rawId(o),i[o]=1}n+=1}return t}function v(){return"any"!==e.direction}function g(){if(e.mode=e.mode||"auto",!e.mode.match(/^(connected|disconnected|auto)$/))throw new TypeError("Option mode property should be either 'connected', 'disconnected' or 'auto'")}function y(){return g(),"auto"===e.mode?b():e.mode}function p(){return!c.isNullOrUndefined(e.value)}function w(){return i(e).match(/chart/)}function M(){return i(e).match(/component/)}function b(){var t="disconnected",n=T(e);if(1===n.length&&(t="connected",v()))for(var r=0;r<n[0].links.length;r++)if(l(n[0].links[r]))return"disconnected";return t}e=c.defaults(e,{direction:"any",value:void 0,normalization:"component",mode:"auto",weights:!1,all:!1});var k=a(e);n(e),o(e),k.all=e.all;var I,L,O,E,D,P=p()||v()?"dijkstra":"regular",A=0,z={},N=y(),B={regular:function(e){return h(e)},dijkstra:function(e,t){return C(e,t)}},U={connected:function(e,t){var n=0;for(var r in t)r=c.rawId(r),n+=isFinite(t[r])?t[r]:0;return n?1/n:0},disconnected:function(e,t){var n=0;for(var r in t)r=c.rawId(r),n+=e!==r?1/t[r]:0;return n}},R=function(){c.invoke(t,z)};L=B[P]||B.regular,O=U[N],S(e),A=s(e),z={};var K=function(e,t){E=L(e.id,k),I=r(e.id,E),z[e.id]=O(e.id,E),A>1&&(D=w()?Math.pow(I-1,2)/(A-1):M()?I-1:1,z[e.id]*=D),t()};x(e,"closeness",K,R)},f.kCores=function(e){function t(e){var t=0;for(var n in e)n=c.rawId(n),t=Math.max(t,e[n]);return t}var n=function(){var t,n,r,i,a,o,u,s,f,l,d,h={},v={},g=[],y=[];n=0,h=z({multi:!1,all:e.all});for(var x in h)x=c.rawId(x),n=Math.max(n,h[x]);for(d=c.flattenMap(h).length,t=0;n+1>t;t++)y[t]=0;for(p(e,function(e,t){y[h[t]]++}),a=1,t=0;n+1>t;t++)o=y[t],y[t]=a,a+=o;for(p(e,function(e,t){v[t]=y[h[t]],g[v[t]]=t,y[h[t]]++}),t=n;t>1;t--)y[t]=y[t-1];for(y[0]=1,i=0;d>i;i++){r=g[i];for(var w in m[r])w=c.rawId(w),h[w]>h[r]&&(s=h[w],f=v[w],l=y[s],u=g[l],w!==u&&(v[w]=l,g[f]=u,v[u]=f,g[l]=w),y[s]++,h[w]--)}return h};e=c.defaults(e,{all:!1}),o(e),S(e);var r=n();return{maximumK:t(r),values:r}},f}}(),!function(){var e=KeyLines.TimeBar.Config={};e.create=function(){function e(e,t){return a.format(e,t,c.options.locale)}function t(t){var n="dmy"===c.options.locale.order?"d MMM yyyy":"MMM d, yyyy";return e(t,n)}function n(t){var n=c.options.locale.h12?"h:mm tt":"HH:mm";return e(t,n)}function r(t){var n=c.options.locale.h12?"h:mm:ss tt":"HH:mm:ss";return e(t,n)}function i(e,t){if("histogram"===e){if(!o.isNormalObject(t))return!1;if(t.colour&&!KeyLines.Rendering.validatergb(t.colour))return!1;if(t.highlightColour&&!KeyLines.Rendering.validatergb(t.highlightColour))return!1}return o.contains(s.colours,e)?KeyLines.Rendering.validatergb(t):!0}var a=KeyLines.DateTime,o=KeyLines.Util,u=a.units,s={colours:["backColour","fontColour","sliderColour","sliderLineColour"]},c={displayTime:function(t,n){return o.isFunction(n)?n(t):e(t,n)},options:{scale:{highlightColour:"#F2F2F2",showMajor:!0,showMinor:!0},backColour:"#FFFFFF",fontColour:KeyLines.Rendering.colours.grey,showControlBar:!0,sliderColour:"rgba(255, 255, 255, 0.6)",sliderLineColour:"#bbb",sliders:"fixed",minRange:3e3,showSliders:!0,histogram:{colour:"#d0d0d0",highlightColour:"#a9a9a9"},heightChange:{animate:!0,time:200},locale:o.defaults(a.defaultLocale,{order:"mdy",h12:!0}),playSpeed:60},getOptions:function(){return o.clone(c.options)},setOptions:function(e){if(o.isNormalObject(e))for(var t in e)c.options.hasOwnProperty(t)&&(c.options[t]=o.isNormalObject(c.options[t])&&i(t,e[t])?o.defaults(e[t],c.options[t]):e[t])},hoverTime:50,defaultAnimationTime:200,sliderReleaseTime:200,doubleClickZoomTime:500,doubleClickZoomTimeFree:250,defaultPlaySpeed:60,bars:{major:{height:19,textbase:3,fontsize:13},minor:{height:17,textbase:0,fontsize:12}},grip:{lines:2,space:3,length:14},controlbar:{height:30,space:4,colour:"#ddd"},fixedSideFactor:.5,freeSideFactor:.2,histogram:{dy:2,topdy:16,bardx:1,minwidth:11},selection:{maxNumber:3,reducingFactor:.75,dotsize:3.5},rates:[{max:12,major:{units:u.sec,by:5,f:t},minor:{units:u.sec,by:1,f:r}},{max:24,major:{units:u.sec,by:10,f:t},minor:{units:u.sec,by:2,f:r}},{max:60,major:{units:u.sec,by:15,f:t},minor:{units:u.sec,by:5,f:r}},{max:120,major:{units:u.sec,by:30,f:t},minor:{units:u.sec,by:10,f:r}},{max:360,major:{units:u.min,by:1,f:t},minor:{units:u.sec,by:30,f:r}},{max:1e3,major:{units:u.min,by:5,f:t},minor:{units:u.min,by:1,f:n}},{max:5e3,major:{units:u.min,by:15,f:t},minor:{units:u.min,by:5,f:n}},{max:15e3,major:{units:u.hour,by:1,f:t},minor:{units:u.min,by:15,f:n}},{max:6e4,major:{units:u.hour,by:6,f:t},minor:{units:u.hour,by:1,f:n}},{max:12e4,major:{units:u.day,by:1,f:t,adjust:432e5},minor:{units:u.hour,by:2,f:n}},{max:18e4,major:{units:u.day,by:1,f:t,adjust:432e5},minor:{units:u.hour,by:3,f:n}},{max:36e4,major:{units:u.day,by:1,f:t},minor:{units:u.hour,by:6,f:n}},{max:72e4,major:{units:u.day,by:1,f:t},minor:{units:u.hour,by:12,f:"ttt"}},{max:5e6,major:{units:u.week,by:1,f:function(t){var n,r,i=new Date(t),o=new Date(a.add(t,u.day,6)),s="dmy"===c.options.locale.order;return i.getUTCFullYear()===o.getUTCFullYear()?i.getUTCMonth()===o.getUTCMonth()?(n=s?"d - ":"MMM d - ",r=s?"d MMM yyyy":"d, yyyy"):(n=s?"d MMM - ":"MMM d - ",r=s?"d MMM yyyy":"MMM d, yyyy"):(n=s?"d MMM yyyy - ":"MMM d, yyyy - ",r=s?"d MMM yyyy":"MMM d, yyyy"),e(i,n)+e(o,r)}},minor:{units:u.day,by:1,f:"d"}},{max:15e6,major:{units:u.month,by:1,f:"MMMM yyyy"},minor:{units:u.week,by:1,f:function(t){var n=a.add(t,u.day,6);return e(t,"d - ")+e(n,"d")}}},{max:3e7,major:{units:u.month,by:3,f:"Q  yyyy"},minor:{units:u.month,by:1,f:"MMMM"}},{max:75e6,major:{units:u.month,by:3,f:"Q  yyyy"},minor:{units:u.month,by:1,f:"MMM"}},{max:1e8,major:{units:u.month,by:3,f:"Q  yyyy"},minor:{units:u.month,by:1,f:"MMMMM"}},{max:2e8,major:{units:u.month,by:6,f:"QQ  yyyy"},minor:{units:u.month,by:1,f:"MMMMM"}},{max:36e7,major:{units:u.year,by:1,f:"yyyy"},minor:{units:u.month,by:3,f:"Q"}},{max:6e8,major:{units:u.year,by:1,f:"yyyy"},minor:{units:u.month,by:6,f:"QQ"}},{max:15e8,major:{units:u.year,by:10,f:"yyyy"},minor:{units:u.year,by:1,f:"'yy"}},{max:25e8,major:{units:u.year,by:10,f:"yyyy"},minor:{units:u.year,by:2,f:"'yy"}},{max:75e8,major:{units:u.year,by:10,f:"yyyy"},minor:{units:u.year,by:5,f:"'yy"}},{max:15e9,major:{units:u.year,by:50,f:"yyyy"},minor:{units:u.year,by:10,f:"'yy"}},{max:25e9,major:{units:u.year,by:50,f:"yyyy"},minor:{units:u.year,by:25,f:"'yy"}},{max:35e9,major:{units:u.year,by:100,f:"yyyy"},minor:{units:u.year,by:25,f:"'yy"}},{max:8e10,major:{units:u.year,by:100,f:"yyyy"},minor:{units:u.year,by:50,f:"'yy"}},{max:16e10,major:{units:u.year,by:200,f:"yyyy"},minor:{units:u.year,by:100,f:""}},{max:4e11,major:{units:u.year,by:500,f:"yyyy"},minor:{units:u.year,by:100,f:""}},{max:1/0,major:{units:u.year,by:500,f:""},minor:{units:u.year,by:100,f:""}}]};return c}}(),!function(){var e=KeyLines.Canvas={},t=8888;e.create=function(e,n,r,i,a,o){function u(e,t){var n=document.createElement("canvas");return n.height=t,n.width=e,c(n),n}function s(e){var t=e.getContext("2d"),n=window.devicePixelRatio||1,r=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,i=n/r;if(n!==r){var a=e.width,o=e.height;e.width=Math.round(a*i),e.height=Math.round(o*i),e.style.width=a+"px",e.style.height=o+"px",t.scale(i,i)}}function c(e){function t(e){n.setLineDash=function(t){n[e]=t}}var n=e.getContext("2d");n.setLineDash||("undefined"!=typeof n.webkitLineDash?t("webkitLineDash"):"undefined"!=typeof n.mozDash&&t("mozDash"))}function f(){return new Image}function l(){y.update(),window.requestAnimFrame(l)}var d=u(r,i);s(d);var h=document.getElementById(n);h.parentNode.replaceChild(d,h),d.setAttribute("id",n);var v=document.getElementById(n),g=v.getAttribute("style")||"";g+="-ms-touch-action: none; touch-action: none; outline: none;",v.setAttribute("style",g),v.setAttribute("tabindex",""+t++);var m={},y="chart"===e?KeyLines.API.createAPI():KeyLines.TimeBar.API.createAPI();for(var p in y)-1===p.indexOf("private")&&(m[p]=y[p]);return y.privateInit(v.getContext("2d"),r,i,u,function(e){document.getElementById(n).style.cursor=e},f,a,void 0,o),m.setSize=function(e,t,n){v.width=e,v.height=t,s(v),y.privateSetSize(v.getContext("2d"),e,t,n,!0)},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)
}}(),window.requestAnimFrame(l),m}}(),!function(){var e=KeyLines.API=KeyLines.API||{};e.appendExtras=function(e){function t(e,t){return"all"===e||e===t.type}function n(t){e.each({type:"link"},function(e){t[e.id]&&(t[e.id1]=!0,t[e.id2]=!0)})}function r(t){e.each({type:"link"},function(e){t[e.id]=!(!t[e.id1]||!t[e.id2])})}var i=null;e.bind("redraw",function(){i=null}),e.each=function(n,r){if(i=i||e.serialize().items,n=KeyLines.Util.defaults(n,{type:"all"}),!n.type.match(/^(node|link|all)$/))throw new TypeError("opts type property should be either 'node', 'link' or 'all'");if(KeyLines.Util.isFunction(r))for(var a=0;a<i.length;a++)t(n.type,i[a])&&r(i[a])},e.filter=function(t,i,a){function o(){KeyLines.Util.invoke(a,c)}i=KeyLines.Util.defaults(i,{type:"all",animate:!0,time:1e3,hideSingletons:!1});var u={};if(e.each(i,function(e){t(e)&&(u[e.id]=!0)}),"all"===i.type&&i.hideSingletons){var s={};e.each({type:"link"},function(e){s[e.id1]|=u[e.id]&&u[e.id2],s[e.id2]|=u[e.id]&&u[e.id1]}),e.each({type:"node"},function(e){u[e.id]&=s[e.id]})}"link"===i.type&&n(u),"node"===i.type&&r(u);var c={shown:{nodes:[],links:[]},hidden:{nodes:[],links:[]}};e.each({type:"all"},function(e){var t="node"===e.type?"nodes":"links";u[e.id]&&e.hi&&c.shown[t].push(e.id),u[e.id]||e.hi||c.hidden[t].push(e.id)});var f=c.shown.nodes.concat(c.shown.links),l=c.hidden.nodes.concat(c.hidden.links);l.length>0?f.length>0?(i.time/=2,e.hide(l,i,function(){e.show(f,!1,i,o)})):e.hide(l,i,o):f.length>0?e.show(f,!1,i,o):o()},e.foreground=function(t,i,a){i=KeyLines.Util.defaults(i,{type:"node"});var o={};e.each(i,function(e){t(e)&&(o[e.id]=!0)}),"link"===i.type&&n(o),"node"===i.type&&r(o);var u=[];e.each({type:"all"},function(e){!!e.bg!=!o[e.id]&&u.push({id:e.id,bg:!o[e.id]})}),e.setProperties(u,!1,a)}}}(),!function(){var e=KeyLines.TimeBar.API=KeyLines.TimeBar.API||{};e.appendExtras=function(e){var t,n=KeyLines.Util;e.bind("change",function(){t=null}),e.bind("datachange",function(){t=null}),e.inRange=function(r){if(n.isNullOrUndefined(r))return!1;t=t||e.getIdcounts();var i=(n.isNormalObject(r)?r.id:r)+"";return!!t[i]}}}(),"undefined"==typeof KeyLinesServer&&!function(){function e(e,t,n,r){r||(r=!1),e.addEventListener?e.addEventListener(t,n,r):e.attachEvent("on"+t,n)}function t(t,n){for(var r=0;r<t.length;r++)e(document,t[r],n)}function n(e){return e.pageX?e.pageX:e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft}function r(e){return e.pageY?e.pageY:e.clientY+document.body.scrollTop+document.documentElement.scrollTop}function i(e,t){for(var n=[],r=0;r<e[t].length;r++){var i=B(e[t][r]);n.push({id:e[t][r].identifier,x:i.x,y:i.y})}return n}function a(e){return e.target?e.target:e.srcElement}function o(e){var t=a(e),n=t.id;n in P&&(P[n].canvas||0!==e.button&&(u("down",n,t,e.button,e),s(e)))}function u(e,t,n,r,i){var a=n.getStageWidth()/n.width,o=b(t);a/=o;var u=B(i);"down"===e?(n.privateFlashClick(r),P[t].mousedown(r,u.x*a,u.y*a,i.ctrlKey,i.shiftKey)):P[t].mouseup(u.x*a,u.y*a,i.ctrlKey,i.shiftKey)}function s(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1,e.preventCapture&&e.preventCapture(),e.preventBubble&&e.preventBubble()}function c(){function n(t,n){e(document,t,function(e){e.target.id in P&&(P[e.target.id][t](i(e,"targetTouches"),i(e,"changedTouches")),n&&e.preventDefault())})}function r(t){e(document,t,function(e){e.target.id in P&&(P[e.target.id][t](e.scale,e.rotation),e.preventDefault())})}function u(e,t){var n=e.pointerId||0,r=B(e),i=[];switch(t){case"ADD":A[n]||(A[n]={id:n,x:r.x,y:r.y});break;case"DEL":A[n]&&(delete A[n],z--);break;case"MOVE":A[n]&&(A[n]={id:n,x:r.x,y:r.y})}for(var a in A)i.push(A[a]);return i}function c(e,t){var n=e.pointerId||0,r=B(e),i=[];switch(t){case"ADD":case"MOVE":i=[{id:n,x:r.x,y:r.y}];break;case"DEL":i=[A[n]]}return A[n]?[]:i}function f(e){return e.pointerType===(e.MSPOINTER_TYPE_TOUCH||"touch")}function l(e){N[e]=new MSGesture,N[e].target=document.getElementById(e)}function d(){m=1,y=0}function h(e,t){return function(n){if(n.target.id in P&&f(n)){var r=c(n,t);P[n.target.id][e](u(n,t),r),n.preventDefault()}}}function v(e,t){if(e!==b){if(null!==b&&P[b]&&P[b].canvas&&document.getElementById(b)){var n=U(t,b);P[b].mouseleave(n.x,n.y,t.ctrlKey,t.shiftKey)}b=e}}function g(e){var t=e.wheelDelta?e.wheelDelta:-e.detail,n=a(e),r=P[n.id];if(r){var i=B(e);r.mousewheel(t,i.x,i.y),s(e)}}e(window,"mousedown",o,!0),e(document,"contextmenu",function(e){return a(e).id in P?(s(e),!1):void 0}),e(document,"dragover",function(e){if(e.target.id in P){var t=B(e);P[e.target.id].dragover(t.x,t.y)}}),"ontouchstart"in document.documentElement&&(n("touchstart",!0),n("touchmove"),n("touchend"),n("touchcancel"),r("gesturestart"),r("gesturechange"),r("gestureend"));var m=1,y=0;if(navigator.msMaxTouchPoints||navigator.maxTouchPoints){var p=["MSPointerDown","pointerdown"],x=["MSPointerMove","pointermove"],w=["MSPointerUp","pointerup"],M=["MSPointerCancel","pointercancel"];t(p,function(e){if(e.target.id in P&&f(e)){N[e.target.id]||l(e.target.id),z++,N[e.target.id].addPointer(e.pointerId);var t=c(e,"ADD");P[e.target.id].touchstart(u(e,"ADD"),t),e.preventDefault()}}),t(x,h("touchmove","MOVE")),t(w,h("touchend","DEL")),t(M,h("touchcancel","DEL")),e(document,"MSHoldVisual",function(e){e.preventDefault()}),e(document,"MSGestureStart",function(e){var t=e.gestureObject.target.id,n=z>1;t in P&&n&&(P[t].gesturestart(),e.preventDefault())}),e(document,"MSGestureChange",function(e){var t=e.gestureObject.target.id,n=z>1&&e.detail!==e.MSGESTURE_FLAG_INERTIA;t in P&&n&&(m*=e.scale,y+=180*e.rotation/Math.PI,P[t].gesturechange(m,y),e.preventDefault())}),e(document,"MSGestureEnd",function(e){var t=e.gestureObject.target.id;t in P&&(P[t].gestureend(m,y),d(),e.preventDefault())})}e(window,"mousedown",function(e){if(e.target.id in P&&P[e.target.id].canvas){var t=B(e);P[e.target.id].mousedown(e.button,t.x,t.y,e.ctrlKey,e.shiftKey)}}),e(window,"mouseup",function(e){if(e.target.id in P&&P[e.target.id].canvas){var t=B(e);P[e.target.id].mouseup(t.x,t.y,e.ctrlKey,e.shiftKey)}});var b=null;e(window,"mousemove",function(e){if(e.target.id in P){if(v(e.target.id,e),P[e.target.id].canvas){var t=B(e);P[e.target.id].mousemove(t.x,t.y,e.ctrlKey,e.shiftKey)}}else v(null,e)}),e(window,"dblclick",function(e){if(e.target.id in P&&P[e.target.id].canvas){var t=B(e);P[e.target.id].dblclick(t.x,t.y,e.ctrlKey,e.shiftKey),e.preventDefault()}}),t(["mousewheel","DOMMouseScroll"],g),e(document,"MozMousePixelScroll",function(e){P[e.target.id]&&s(e)}),e(document,"keyup",function(e){e.target&&e.target.id in P&&P[e.target.id].canvas&&P[e.target.id].keyup(e.keyCode)}),e(document,"keydown",function(e){var t=!1;e.target&&e.target.id in P&&P[e.target.id].canvas&&(t=t||P[e.target.id].keydown(e.keyCode,e.ctrlKey,e.shiftKey)),t&&e.preventDefault&&e.preventDefault()})}function f(e){e in P&&delete P[e]}function l(e){P[e].id=function(){return e}}function d(e){e in P||(P[e]={})}function h(e,t){K++;var n="sink"+K;return KeyLines[n]=function(){var n=[].slice.call(arguments);if(t){for(var r=[],i=0;i<n.length;i++)r.push(KeyLines.Util.arrayToDict(n[i]));n=r}return e.apply(this,n)},"KeyLines."+n}function v(e,t,n,r,i,a){var o;if(r.length>0){var u=r[r.length-1];KeyLines.Util.isFunction(u)&&(o=h(u,a),r.pop())}var s=t[e](n,r,o,i,a);return a&&(s=KeyLines.Util.arrayToDict(s)),s}function g(e){function t(e,t,n,i,a){t[n]=function(){var t=[].slice.call(arguments);return v(e,r,n,t,i,a)}}for(var n=P[e],r=document.getElementById(e),i=r.privateFunctionNames(),a=r.privateFunctionDefinitions(),o=0;o<i.length;o++){var u=i[o];t("callAPI",n,u,null,a[u])}var s=r.privateNamespaceDefinitions();for(var c in s)!function(){for(var e={},i=r.privateNamespaceNames(c),a=0;a<i.length;a++)t("callAPI",e,i[a],c,s[c][i[a]]);n[c]=function(){return e}}()}function m(e,t,n,r){function i(e,t){e?KeyLines.Util.invoke(r,e):t.options(n,function(){r&&r(null,t)})}var a=document.getElementById(t);if(!a)throw new Error('Cannot create KeyLines component. No element with id "'+t+'" exists in the DOM');var o=a.clientWidth,u=a.clientHeight;y(e,t,o,u,n?i:r)}function y(e,t,n,r,i){f(t),n||(n=100),r||(r=100);var a="flash"!==F;if(a&&Y()&&p())G(e,t,n,r,i);else{if("canvas"===F){var o="Could not create HTML5 canvas. Try using auto or flash mode.";return i(o),void 0}J(e,t,n,r,i)}}function p(){return"undefined"!=typeof KeyLines.Canvas}function x(e,t){"chart"===e?(KeyLines.API.appendExtras(t),KeyLines.Map?KeyLines.Map.init(t,KeyLines.Util):t.map=w()):"timebar"===e&&KeyLines.TimeBar.API.appendExtras(t)}function w(){return function(){throw new Error("No keylines.map.js found in the page. Please add it if you want to use the Map Mode.")}}function M(e,t,n){var r=KeyLines.components[e];try{if(r.map&&r.map().isShown()){var i=document.getElementById(e+"-map"),a=document.getElementById(e+"-map-container");i.style.height=n+"px",i.style.width=t+"px",a.style.height=n+"px",a.style.width=t+"px"}}catch(o){}}function b(e){var t=document.getElementById(e);return t?t.clientWidth/Number(t.width):void 0}function k(t){var n=document.getElementById(t),r=n.parentNode;r.addEventListener||(e(r,"mousedown",function(e){if(e.button>1&&e.srcElement.id===t){r.setCapture();var i=e.button<4?2:1;u("down",t,n,i,e)}},!0),e(r,"mouseup",function(e){e.srcElement.id===t&&u("up",t,n,null,e),r.releaseCapture()},!0))}function T(e,t){V[e]&&Z[e]&&(V[e]=!1,Z[e]=!1,k(e),x(t,P[e]),$[e]&&$[e](null,P[e]))}function S(e){if("undefined"!=typeof swfobject)return e();var t=document.getElementsByTagName("head")[0],n=document.createElement("script");n.type="text/javascript",n.src=W,n.onreadystatechange=e,n.onload=e,t.appendChild(n)}function C(){return I(["webkitIsFullScreen","mozFullScreen","msFullscreenElement","fullScreenElement"])}function I(e){for(var t=KeyLines.Util.defined,n=0;n<e.length;n++)if(t(document[e[n]]))return!!document[e[n]];return!1}function L(e){var t=KeyLines.Util.defined;return t(document.webkitCurrentFullScreenElement)?document.webkitCurrentFullScreenElement===e:t(document.mozFullScreenElement)?document.mozFullScreenElement===e:t(document.msFullscreenElement)?document.msFullscreenElement===e:void 0}function O(e,t){for(var n,r=0;!n&&r<t.length;r++)e[t[r]]&&(n=!0,e[t[r]]())}function E(e){O(e,["requestFullScreen","mozRequestFullScreen","webkitRequestFullScreen","msRequestFullscreen"])}function D(){et&&et(C())}var P=KeyLines.components={};KeyLines.charts=P;var A={},z=0,N={};c();var B=KeyLines.coords=function(e){return U(e,a(e).id)},U=function(e,t){var i=R(t),a=Math.floor(n(e)-i.left),o=Math.floor(r(e)-i.top);return{x:a,y:o}},R=KeyLines.getOffset=function(e){var t=document.getElementById(e),n=t.getBoundingClientRect(),r=window.pageXOffset||0===window.pageXOffset?window.pageXOffset:document.body.scrollLeft,i=window.pageYOffset||0===window.pageYOffset?window.pageYOffset:document.body.scrollTop;return{top:n.top+i-document.documentElement.clientTop,left:n.left+r-document.documentElement.clientLeft}},K=0,F="auto";KeyLines.mode=function(e){return e&&(F=e),F},KeyLines.createChart=function(){var e,t,n,r;switch(arguments.length){case 0:throw"createChart called with zero arguments";case 1:case 2:e=arguments[0],r=arguments[1];var i=document.getElementById(e);t=i.clientWidth,n=i.clientHeight;break;default:e=arguments[0],t=Number(arguments[1]),n=Number(arguments[2]),r=arguments[3]}y("chart",e,t,n,r)},KeyLines.create=function(e,t){var n=KeyLines.Util,r=n.ensureArray(e);if(r.length<1)return n.invoke(t,"No definition passed to KeyLines.create"),void 0;var i=0,a=[],o=function(){var e=r[i],u=e.id||e;m(e.type||"chart",u,e.options,function(e,u){if(e)n.invoke(t,e);else if(a[i]=u,i++,i>=r.length){var s=1===i?u:a;t&&t(null,s)}else o()})};o()};var _,H,j=KeyLines.setCanvasPaths=function(e){_=e};KeyLines.imageBasePath=function(e){return e&&(H=e),H},j("assets/");var Y=KeyLines.html5CanvasSupport=function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))},G=function(e,t,n,r,i){d(t),document.getElementById(t),P[t]=KeyLines.Canvas.create(e,t,n,r,_,H),P[t].canvas=!0,l(t),x(e,P[t]),i&&i(null,P[t])};KeyLines.flashInitialized=function(e,t){d(e),l(e),g(e),P[e].canvas=!1,Z[e]=!0,T(e,t)},KeyLines.setSize=function(e,t,n){if(!(0>=t||0>=n)){var r=document.getElementById(e);r&&(M(e,t,n),r.style.height=n+"px",r.style.width=t+"px",P[e]&&P[e].canvas&&P[e].setSize(t,n,1))}},KeyLines.getElementWidth=function(e){var t=document.getElementById(e);return t?t.clientWidth:void 0};var W,q,X,V={},Z={},$={},Q=KeyLines.setFlashPaths=function(e,t,n){q=e,W=t,X=n},J=function(e,t,n,r,i){$[t]=i,V[t]=!1,Z[t]=!1,S(function(){var a={identifier:t,widget:e,assets:_},o={menu:"false",quality:"best",wmode:"opaque",allowScriptAccess:"always",allowNetworking:"all"},u={};"undefined"!=typeof swfobject&&(V[t]||swfobject.embedSWF(q,t,n,r,"10.0.0",X,a,o,u,function(n){n.success?(V[t]=!0,T(t,e)):i("swfobject embedSWF returned error "+n)}))})};KeyLines.paths=function(e){return e&&(e.assets&&j(e.assets),e.flash&&Q(e.flash.swf,e.flash.swfObject,e.flash.expressInstall),e.images&&KeyLines.imageBasePath(e.images)),{assets:_,flash:{swf:q,swfObject:W,expressInstall:X},images:H}},document.addEventListener&&t(["fullscreenchange","mozfullscreenchange","webkitfullscreenchange","MSFullscreenChange"],D),KeyLines.fullScreenCapable=function(){if(!document.addEventListener)return!1;var e=KeyLines.Util.defined;return e(document.webkitCurrentFullScreenElement)?!0:e(document.mozFullScreenElement)?!0:e(document.msFullscreenEnabled)?document.msFullscreenEnabled:!1};var et;KeyLines.toggleFullScreen=function(e,t){document.addEventListener&&(et=t,C()?L(e)?O(document,["cancelFullScreen","mozCancelFullScreen","webkitCancelFullScreen","msExitFullscreen"]):E(e):E(e))},KeyLines.dashedLineSupport=function(){if(Y()){var e=document.createElement("canvas"),t=e.getContext("2d");return!!t.setLineDash||!!t.mozDash||!!t.webkitLineDash}return!1}}(),!function(){function e(e,t,n){return function(){if(!n||!n()){var r,i=t[e];return i&&(r=i.apply(null,arguments)),r}}}var t=KeyLines.Common={};t.frameManager=function(e,t){var n=(new Date).getTime(),r=n>>10,i=0,a=!1,o=!0,u=0;return{frameRate:function(){return u},update:function(){var s=(new Date).getTime(),c=s>>10;c>r?(u=Math.round(i/(c-r)),i=0,r=c):i++;var f=t(s-n);n=s,a=a||f,a&&(a=!1,o&&e())},redraw:function(){a=!0},allowDraw:function(e){e&&!o&&(a=!0),o=e}}},t.animator=function(e){var t=[],n=[];return{push:function(r,i){r&&(r.queue=i,i?n.push(r):t.push(r),e())},cancel:function(){t=[],n=[],e()},animate:function(e,r,i){var a=!1,o=!1;if(t.length>0){var u=t;t=[];for(var s=0;s<u.length;s++)u[s].animate(e)&&(o=o||u[s].queue,t.push(u[s]));a=!0}return o||n.length>0&&(t.push(n.shift()),a=!0),r&&r.animate&&(r.animate(e),a=!0),i&&(a=a||i.animated()),a}}},t.makeValueAnimator=function(e,t){var n,r,i,a;return function(o,u,s){var c=t();c===o||a&&r===o||(n=c,r=o,i=0,a||(a={animate:function(e){i=Math.min(u,i+e);var o=0>=u?r:n+(r-n)*i/u;t(o);var c=u>i;return c||(a=null,KeyLines.Util.invoke(s)),c}},e.push(a,!1)))}};var n=["mousemove","mousedown","mouseup","mouseleave","mousewheel","dblclick","touchstart","touchmove","touchend","touchcancel","keyup","keydown","gesturestart","gesturechange","gestureend","dragover"];t.appendActions=function(t,r,i){for(var a=0;a<n.length;a++)t[n[a]]=e(n[a],r,i)},t.hitTester=function(e,t,n,r,i){function a(e){i&&i(e),s.clear(e,t,n),s.backFill(e,f,t,n),s.drawShadowCanvas(e,r,h,o,c.rawId),l=!1}var o,u,s=KeyLines.Rendering,c=KeyLines.Util,f=s.randomColour(),l=!0,d=5,h=function(){var e={},t={};return{getColour:function(n){if(n in e)return e[n];var r=s.randomColour(t);return e[n]=r,t[r]=n,r},getId:function(e){return t[e]?t[e]:null}}}(),v={};return v.test=function(t,n,r){l&&v.draw();var i=e.getImageData(Math.floor(t),Math.floor(n),1,1).data,a=s.rgbtostring(i[0],i[1],i[2]);if(a===f)return null;var o=h.getId(a);return o?o:(r=r||1,r>d?null:t+r>d&&n+r>d?v.test(t-1,n-1,++r):v.test(t+1,n+1,++r))},v.dirty=function(){l=!0},v.exclusions=function(e){o=e},v.debugCanvas=function(e){u=e},v.draw=function(){a(e),u&&a(u)},v}}(),!function(){var e=KeyLines.Events={};e.createEventBus=function(){function e(e,t){var n=(new Date).toString()+" Function bound to '"+e+"' threw error: "+t.toString();a.push(n),a.length>i&&a.shift()}function t(e,t,n,r,i,a){function o(e){return((l*e+f)*e+c)*e}function u(e,t){var n=s(e,t);return((v*n+h)*n+d)*n}function s(e,t){var n,r,i,a,u,s;for(i=e,s=0;8>s;s++){if(a=o(i)-e,Math.abs(a)<t)return i;if(u=(3*l*i+2*f)*i+c,Math.abs(u)<1e-6)break;i-=a/u}if(n=0,r=1,i=e,n>i)return n;if(i>r)return r;for(;r>n;){if(a=o(i),Math.abs(a-e)<t)return i;e>a?n=i:r=i,i=(r-n)/2+n}return i}var c=3*t,f=3*(r-t)-c,l=1-c-f,d=3*n,h=3*(i-n)-d,v=1-d-h;return u(e,1/(200*a))}var n,r={};r.bind=function(e,t,r){n=n||{},n[e]=n[e]||[],n[e].push([t,r])},r.unbind=function(e,t){if(n)if(e)if(t){if(n[e]){for(var r=[],i=0;i<n[e].length;i++)t!==n[e][i][0]&&r.push(n[e][i]);n[e]=r}}else n[e]=[];else n={}},r.trigger=function(t){var r=!1;if(n)for(var i,a=2;a--;){var o=a?t:"all",u=[],s=a?1:0;for(i=s;i<arguments.length;i++)u.push(arguments[i]);if(n[o])for(i=0;i<n[o].length;i++){var c=n[o][i];try{r=c[0].apply(c[1]||this,u)||r}catch(f){e(t,f)}}}return r},r.getErrors=function(){return a};var i=10,a=[];r.linearEasing=function(e){return 0>e?0:e>1?1:e},r.cubicEasing=function(e){return 0>e?0:e>1?1:t(e,.25,.01,.25,1,1)};var o=1;return r.atanEasing=function(e){return Math.atan(o*(e-.5))/(2*Math.atan(.5*o))+.5},r}}(),!function(){var e=KeyLines.Overlays={};e.createOverlays=function(e,t){function n(e,t){return h[e]=t?!0:!1,e}function r(){v=o.colours.ci,g=o.colours.cia}function i(e){d[e]&&d[e].apply(null,arguments)}function a(e,t,n,r,i,a,u){e.rect(t.scale(n),t.scale(r),t.scale(i),t.scale(a),o.colours.white,-1,o.colours.white,!0,u)}var o=KeyLines.Rendering,u=KeyLines.Util,s={},c={},f={},l=[],d={},h={};s.appendImageList=function(e){for(var t in h)e[t]=1};var v,g;r(),s.colorize=function(e,t,n){var i,a={},u="rgb(0,174, 234)";if(n){var s=o.colorize(e,h,t,u,n);i=s.colour,a=s.images,v=o.rgbtostring(i[0],i[1],i[2]),g=o.rgbatostring(i[0],i[1],i[2],.5)}else r();for(var c in e){var f=a[c]?a[c]:e[c].im;e[c].co=f}},s.setup=function(){m(),e.bind("click",i)},s.createDragger=function(e,t,n){return e in c?c[e](t,n):null};var m=s.reset=function(){c={},f={},l=[],d={},h={},e.unbind("click",i)};s.getCursor=function(e){return e in f?f[e]:"auto"},s.generate=function(e,t,n,r,i,a,o,u){for(var s=0;s<l.length;s++)l[s].generate(e,t,n,r,i,a,o,u)},s.getWatermarkSize=function(e,t){for(var n=0;n<l.length;n++){var r=l[n];if(r.watermarkSize)return r.watermarkSize(e,t)}return null},s.addLogo=function(e){var t=15,r="_logo",i={generate:function(n,i,a,u,s,c){n.layer(o.layers.OVERLAYS);var f=u[e].im;c||n.image(a.scale(a.width()-(f.width+t)),a.scale(t),a.scale(a.width()-t),a.scale(t+f.height),e,r)}};l.push(i),n(e)},s.addTextWatermark=function(e,t,r,i,a,u,s,c){var f="_textWatermark",d={watermarkSize:function(n,i){var a,u;if(e&&i){var s=i[e].im;a=s.width,u=s.height}else t&&(a=o.measureText(n,t,r,c).width,u=r);return a?{width:a+10,height:u+10}:null},generate:function(n,l,d,h,v,g){if(n.layer(o.layers.UNDERLAYS),!g){if(e){var m=h[e].im,y=d.scale((d.width()-m.width)/2),p=d.scale((d.height()-m.height)/2);return n.image(y,p,y+d.scale(m.width),p+d.scale(m.height),e,f),void 0}if(t){var x=d.scale(r),w=o.measureText(l,t,r,c).width,y=d.scale((d.width()-w)/2),p=d.scale((d.height()+r)/2),M=Math.floor(x/4),b=Math.floor(x/8);"top"===s&&(p=x+b),"bottom"===s&&(p=d.scale(d.height())+1),u&&n.rect(y-M,p-x-b,y+w+M+b,p,u,-1,u,!0,f),n.text(y,p,t,i,x,a,f,c)}}}};l.push(d),e&&n(e)},s.addNavigation=function(t,r,i,u,s,h){function v(){return t.options().handMode}function g(e,n){var r=e-x[b].im.height/2,i=y(r);t.setZoom(i,n)}function m(e){var t=(Math.log(e)-Math.log(u.minZoom()))/(Math.log(u.maxZoom())-Math.log(u.minZoom()));return Math.floor(L+(1-t)*(O-L))}function y(e){var t=1-(e-L)/(O-L),n=Math.exp(t*(Math.log(u.maxZoom())-Math.log(u.minZoom()))+Math.log(u.minZoom()));return n}function p(){return u.height()<300}var x,w=n(h+"Background.png",!0),M=n(h+"BackgroundShort.png",!0),b=n(h+"Slider.png"),k=n(h+"Hand.png"),T=n(h+"Arrow.png"),S=7,C=17,I=28,L=135,O=232;d._zoomIn=function(){t.zoomIn(!0)},d._zoomOut=function(){t.zoomOut(!0)},d._panLeft=function(){t.pan("left",!0)},d._panRight=function(){t.pan("right",!0)},d._panUp=function(){t.pan("up",!0)},d._panDown=function(){t.pan("down",!0)},d._fitToWindow=function(){t.fitToModel(!0)},d._toggleMode=function(){var e=t.options();e.handMode=!e.handMode,t.options(e)},d._scale=function(e,t,n){g(n,!0)},f._zoomIn=f._zoomOut=f._panLeft=f._panRight=f._panUp=f._panDown=f._fitToWindow=f._toggleMode=f._scale="pointer",f._slider='url("'+h+'openhand.cur"), pointer',c._slider=function(){var n=u.zoom();return p()?null:e.trigger("dragstart","slider")?void 0:{getCursor:function(){return"move"},dragMove:function(e,t){t=u.unscale(t),g(t,!1)},endDrag:function(r){var i=e.trigger("dragend","slider");r=r&&!i,r||t.setZoom(n,!1),e.trigger("dragcomplete","slider")}}};var E={generate:function(e,t,n,r,i,u,s){e.layer(o.layers.OVERLAYS);var c=p()?M:w,f=r[c].im;if(!s){if(x=r,u){var l=18;a(e,n,32,104+l,54,115+l,"_zoomIn");var d=p()?125:223;a(e,n,32,d+l,54,d+17+l,"_zoomOut"),a(e,n,16,42,32,58,"_panLeft"),a(e,n,53,42,68,58,"_panRight"),a(e,n,32,25,48,41,"_panUp"),a(e,n,32,63,48,76,"_panDown"),a(e,n,32,48,48,58,"_fitToWindow"),p()||a(e,n,36,119+l,50,220+l,"_scale"),a(e,n,27,85,49,107,"_toggleMode")}else e.image(n.scale(S),n.scale(C),n.scale(S+f.width),n.scale(C+f.height),c,"_background","co"),e.image(n.scale(26),n.scale(81),n.scale(54),n.scale(113),v()?k:T,"_toggleMode");if(!p()){var h=m(n.zoom());e.image(n.scale(I),n.scale(h),n.scale(I+r[b].im.width),n.scale(h+r[b].im.height),b,"_slider")}}},createDragger:function(){}};f[w]="wait",l.push(E)};var y,p,x;return s.addOverview=function(r,i,a,u,s,h){function m(e){var t={x1:a.newToOldX(a.scale(-e)),x2:a.newToOldX(a.scale(a.width()+e)),y1:a.newToOldY(a.scale(-e)),y2:a.newToOldY(a.scale(a.height()+e))};return{x1:O.oldToNewX(t.x1),x2:O.oldToNewX(t.x2),y1:O.oldToNewY(t.y1),y2:O.oldToNewY(t.y2)}}function w(){N+=E.x,B+=E.y,e.trigger("redraw")}function M(){R=setInterval(w,50)}function b(){R&&(clearInterval(R),R=null)}var k=n(s+"ArrowUp.png",!0),T=n(s+"ArrowDown.png",!0);h.overview.size=h.overview.size||100,y=h.overview.size,x=h.overview.shown,p=u(y,y);var S=p.getContext("2d"),C=!1,I=!1,L=(new Date).getTime(),O=t.createView(e,y,y);d._overviewIcon=function(){x=h.overview.shown=!h.overview.shown,e.trigger("overview",x?"open":"close")},f._overviewIcon="pointer";var E,D=null,P=!1,A=0,z=0,N=0,B=0,U=2;f._overviewBox='url("'+s+'openhand.cur"), pointer';var R;c._overviewBox=function(t,n){if(!e.trigger("dragstart","overview")){P=!0;var i=2;A=0,z=0,N=0,B=0;var o=-D.x1+i,u=y-D.x2-i,s=-D.y1+i,c=y-D.y2-i;return{getCursor:function(){return"move"},dragMove:function(e,r){b(),A=e-t,z=r-n,E={x:0,y:0};var i=!1;o>A&&(A=o,E.x=U,i=!0),A>u&&(A=u,E.x=-U,i=!0),s>z&&(z=s,E.y=U,i=!0),z>c&&(z=c,E.y=-U,i=!0),i&&M()},endDrag:function(t){P=!1,b();var n=e.trigger("dragend","overview");if(t&&!n){var i=-(A-N)*a.zoom()/O.zoom(),o=-(z-B)*a.zoom()/O.zoom();r.panBy(i,o,!0)}e.trigger("dragcomplete","overview")}}}};var K=o.instructionPool(),F={generate:function(t,n,a,u,s,c,f,l){if(t.layer(o.layers.OVERVIEW),!f){if(x){if(t.rect(a.scale(a.width()-y-2),a.scale(a.height()-y-2),a.scale(a.width()+1),a.scale(a.height()+1),o.colours.white,Math.max(1,a.scale(3)),o.colours.white,c,"_overviewBorder1"),t.rect(a.scale(a.width()-y)-.5,a.scale(a.height()-y)-.5,a.scale(a.width()+1),a.scale(a.height()+1),o.colours.lightgrey,Math.max(1,a.scale(1)),o.colours.white,!1,"_overviewBorder2"),i&&!c){var d=(new Date).getTime();if(C&&!P&&L+1e3>d&&I)e.trigger("redraw");else{L=(new Date).getTime(),C=!0,S.clearRect(0,0,y,y),S.fillStyle=o.colours.white,S.fillRect(0,0,y,y),r.drawBackground(S);var p=Math.max(a.width(),a.height())/2;O.reset(!1,!0);var w=m(p);O.fitExtents(w,!1,!1,void 0,void 0,void 0,!0);var M=a.getMaxItemZoom();1/0!==M&&O.setMaxItemZoom(M/8),P&&O.panBy(N,B,!1,!0),K.reset(),i.generate(K,S,O,u,null,null,l),o.draw(S,K,u,o.overviewLayers),I=(new Date).getTime()-L>30}}i&&(D||(D=m(0)),t.layer(o.layers.OVERVIEW),P||t.rect(a.scale(a.width()-y+D.x1),a.scale(a.height()-y+D.y1),a.scale(a.width()-y+D.x2),a.scale(a.height()-y+D.y2),v,Math.max(1,a.scale(2)),g,!0,"_overviewBox"),P&&t.rect(a.scale(a.width()-y+D.x1+A),a.scale(a.height()-y+D.y1+z),a.scale(a.width()-y+D.x2+A),a.scale(a.height()-y+D.y2+z),v,Math.max(1,a.scale(2)),o.colours.white,!1,"_overviewBoxDragging"))}var b=x?T:k,E=u[b].im;h.overview.icon&&(c?t.rect(a.scale(a.width()-2*E.width),a.scale(a.height()-2*E.height),a.scale(a.width()+1),a.scale(a.height()+1),o.colours.lightgrey,-1,o.colours.white,!0,"_overviewIcon"):(t.rect(a.scale(a.width()-E.width)-.5,a.scale(a.height()-E.height)-.5,a.scale(a.width()+1),a.scale(a.height()+1),o.colours.lightgrey,Math.max(1,a.scale(1)),o.colours.white,!0,"_overviewIconRect"),t.image(a.scale(a.width()-E.width),a.scale(a.height()-E.height),a.scale(a.width()),a.scale(a.height()),b,"_overviewIcon","co")))}}};l.push(F)},s.remove=function(e,t,n){var r=42,i={generate:function(i,a,u,s,c,f){if(i.layer(o.layers.OVERLAYS),!f){var l=o.measureText(a,e,r).width,d=u.scale((u.width()-l)/2),h=u.scale((u.height()+r)/2);i.text(d+2,h+2,e,n,u.scale(r),!0,""),i.text(d,h,e,t,u.scale(r),!0,"")}}};l.push(i)},s.drawOverviewContent=function(e,t){if(x&&p){var n=t.scale(y);e.isFlash?e.drawImageDirect(p,0,0,y,y,t.scale(t.width()-y),t.scale(t.height()-y),n,n):e.drawImage(p,0,0,n,n,t.scale(t.width()-y),t.scale(t.height()-y),n,n)}},s.addBanding=function(e){var t=6,n=3,r=3,i=6,a={generate:function(a,s,c,f,l,d){if(!d){var h=u.merge({top:!0},e.bands);if(h&&h.bands){var v,g,m,y,p,x,w;a.layer(o.layers.BANDS);var M=1/0;for(v=0;v<h.bands.length;v++)p=h.bands[v],p.t&&(g=c.dim(p.w/2),m=p.ff||e.fontFamily,y=p.fs||20,x=.75*y,w=o.measureText(s,p.t,y,p.fb,m).width/2,w+x>g&&(y=Math.floor(y*g/(w+x))),M>y&&(M=y));for(1/0!==M&&(x=.75*M),v=0;v<h.bands.length;v++){p=h.bands[v];var b=c.x(p.x),k=c.x(p.x-p.w/2),T=c.x(p.x+p.w/2),S=c.scale(-1),C=c.scale(c.height()+1);g=c.dim(p.w/2);var I=p.c||"#f7f7f7";if(a.rect(k,S,T,C,"white",-1,I,!0,""),p.t&&M>3){a.layer(o.layers.BANDLABELS),m=p.ff||e.fontFamily,w=o.measureText(s,p.t,M,p.fb,m).width/2;var L=p.fc||o.colours.lightgrey,O=c.scale(M);if(h.top){var E=t+O;a.rect(k,S,T,E+n,"white",-1,I,!0,""),a.text(b-w,E,p.t,L,O,p.fb,"",m)}if(h.bottom){var D=c.height()-r,P=D-(O+i);a.rect(k,P,T,C,"white",-1,I,!0,""),a.text(b-w,D,p.t,L,O,p.fb,"",m)}a.layer(o.layers.BANDS)}}}}}};l.push(a)},s}}(),!function(){var e=KeyLines.Controller={};e.createController=function(t,n,r,i){function a(){var e=ht();return"undefined"==typeof e.isActuallyTheFlashLoader}function o(e,t){for(var n in e)u(e[n].im)&&(e[n].im=e[t].im)}function u(e){var t="undefined"!=typeof e.naturalWidth&&0===e.naturalWidth;if(/.*\.svg$/.test(e.src)){var n=28===e.width&&30===e.height;return t&&(0===e.width||n)}return t}function s(){return{icon:!0,shown:!1,size:100}}function c(e){at.selectedNode&&at.selectedNode.u&&(e[tt+at.selectedNode.u]=1)}function f(){r.setup();var t=at.watermark;t&&r.addTextWatermark(t.u?tt+t.u:void 0,t.t,t.fs||80,t.fc||G.colours.lightgrey,t.fb,t.fbc,t.a,t.ff?t.ff:at.fontFamily),at.navigation&&r.addNavigation(q,$,Z,V,G,dt),at.overview&&r.addOverview(q,$,V,ft,dt,at),at.logo&&r.addLogo(tt+at.logo),r.remove(m(et,xt),m(et,wt),m(et,ut)),e.e&&r.remove(m(et,xt),m(et,wt),m(et,ut)),r.addBanding(at)}function l(e,t){for(var n in t){var r=e[n],i=t[n];W.isNormalObject(r)&&W.isNormalObject(i)?l(r,i):"id"!==n&&"string"==typeof i&&r&&(e[n]=G.hsla(r),t[n]=G.hsla(i))}}function d(e,t){for(var n=0;n<t.length;n++)l(e[n],t[n])}function h(e,t,n){if("number"==typeof e)return e+n*(t-e);if(W.isArray(e)){var r;return Math.abs(e[0]-t[0])>.5?(r=e[0]<t[0]?h(1+e[0],t[0],n):h(e[0],1+t[0],n),r-=Math.floor(r)):r=h(e[0],t[0],n),G.fromhsla([r,h(e[1],t[1],n),h(e[2],t[2],n),h(e[3],t[3],n)])}return t}function v(e,t,n){var r={};for(var i in e)r[i]=t.hasOwnProperty(i)?h(e[i],t[i],n):e[i];return r}function g(e,t,n,r,i,a){q.setProperties(e,!1,!0),q.animateProperties(t,{time:r},function(){i>1?g(e,t,n,r,i-1,a):(q.setProperties(n,!1,!0),a())},!0)}function m(e,t){for(var n="",r=0;r<t.length;r++)n+=String.fromCharCode(e.charCodeAt(r)+t[r]);return n}function y(e){if(0===arguments.length)return at.backColour?G.opacity(at.backColour):0;var t=G.convertrgb(at.backColour||"white");t.push(e),at.backColour="rgba("+t.join(",")+")"}function p(e){return 1-e}function x(e){return e}function w(e,t,n,r){var i=n;return{animate:function(a){i-=a;var o=Math.max(0,Math.min(1,(n-i)/n));bt=t(o);var u=i>0;return u||($.resurrect(e,!0),bt=.5,W.invoke(r)),u}}}function M(e,t,n){if(0===e.length)W.invoke(n);else{bt=1,$.ghost(e);var r,i=$.showHideGetLinksToBend(e,!1);i.length>0?(t=2*t/3,r=function(){q.animateProperties(i,{time:t/2,queue:!1},n,!0)}):r=n;var a=w(e,p,t,function(){$.hide(e),W.invoke(r)});yt(a,!0)}}function b(e,t,n){function r(){var r=w(e,x,t,n);yt(r,!0)}if(0===e.length)W.invoke(n);else{bt=0,$.ghost(e);var i=$.showHideGetLinksToBend(e,!0);i.length>0?(t=2*t/3,q.animateProperties(i,{time:t/2,queue:!1},r,!0)):r()}}function k(){var e=1200,t=0;return{animate:function(n){return t+=n,Lt=Math.floor(8*(1-t%e/e)),It}}}function T(){if(It){Tt.reset([G.layers.WAIT]),Tt.layer(G.layers.WAIT);for(var e=V.scale(V.width()/2),t=V.scale(V.height()/2),n=V.scale(30),r=0;8>r;r++){var i=r*Math.PI/4,a=e+n*Math.cos(i),o=t+n*Math.sin(i),u=.2+.8*((r+Lt)%8)/8;Tt.circle(a,o,V.scale(10),G.colours.white,-1,"rgba(145, 146, 149, "+u+")",!0)}}}function S(e,t){Z.hasOwnProperty("drawImageDirectAlpha")?Z.drawImageDirectAlpha(e,0,0,e.width,e.height,0,0,e.width,e.height,t):(Z.globalAlpha=t,Z.drawImage(e,0,0,e.width,e.height,0,0,e.width,e.height),Z.globalAlpha=1)}function C(e){$.resetDrawing(),Tt.reset(),$.generate(Tt,Z,V,X,St,function(e){return!e.gh},tt),Ct.reset(),$.generate(Ct,Z,V,X,null,function(e){return e.gh},tt),kt=$.getResizePrimitive(),I(e),r.generate(Tt,Z,V,X,st,!1,e,tt),T()}function I(e){e||st&&st.generate&&(Tt.layer(G.layers.DRAGGERS),st.generate(Tt))
}function L(e,t,n){var r=Mt.getContext("2d");G.clear(r,V.width(),V.height()),G.draw(r,t,X,e),S(Mt,n)}function O(e,t){tn>81730776||(G.draw(e,Tt,X,G.topLayers),t||r.drawOverviewContent(e,V),G.draw(e,Tt,X,[G.layers.OVERVIEW]))}function E(e,t){var n=Mt.getContext("2d");G.clear(n,V.width(),V.height()),O(n,t),S(Mt,e)}function D(e){at.smearMode||G.clear(Z,V.width(),V.height()),Ot(Z),It?(L([G.layers.BANDS,G.layers.UNDERLAYS],Tt,.5),L(G.bgLayers,Ct,bt*at.backgroundAlpha/2),L(G.topLayers,Ct,bt/2),L(G.bgLayers,Tt,at.backgroundAlpha/2),E(.5,e),G.draw(Z,Tt,X,[G.layers.WAIT])):(G.draw(Z,Tt,X,[G.layers.BANDS,G.layers.UNDERLAYS]),L(G.bgLayers,Ct,bt*at.backgroundAlpha),L(G.topLayers,Ct,bt),L(G.bgLayers,Tt,at.backgroundAlpha),O(Z,e))}function P(e){X&&(Tt.reset(G.overlayLayers),r.generate(Tt,e,V,X,st,!0,!1,tt),st&&st.excludeHit?Q.exclusions(st.excludeHit()):Q.exclusions(null))}function A(e,t){return function(){var r=Et(e,t);($.getByID(r)||!r)&&r!==Pt&&(Pt=r,n.trigger("hover",W.rawId(r),e,t,W.subId(r)))}}function z(e,t){Dt&&clearTimeout(Dt),Dt=setTimeout(A(e,t),at.hover)}function N(e,t){if(st.scrollable&&at.dragPan){var n=V.maybeScroll(e,t,st);yt(n)}}function B(e,t,n,r,i){st&&st.endDrag(e,t,n,r,i),st=null,ct("auto"),vt()}function U(e){return function(t,n,r,i){X&&$&&(yt(V[e]($,Z,X,G,t,n,r,tt,i)),vt())}}function R(e,t){var n="radial"!==e;return t=W.defaults(t,{fixed:[]}),$.extractStructure(Z,t,n)}function K(e,t,r,i){var a,o;if(e){var u=Math.max(0,Math.min(t.time||700,2e3)),s="linear"===t.easing?n.linearEasing:n.cubicEasing,c=e.extents;a=$.makeAnimator(e.vertices,u,s),o=V.fitWorldExtents(e.extents,!0,!0,!0,!0,u,i),t.animate?(pt(a),t.fit?pt(o):c&&pt(Kt(u,i))):($.applyVertices(e.vertices),c&&(t.fit?V.fitWorldExtents(e.extents,!1,!0,!0,!0,0,i):W.invoke(i)),vt())}else W.invoke(i)}function F(e){return function(t,n,r){K(t,n,r,e)}}function _(){Ft&&(clearTimeout(Ft),Ft=null)}function H(){Ht&&(clearTimeout(Ht),Ht=null)}var j=KeyLines.Combo,Y=KeyLines.Common,G=KeyLines.Rendering,W=KeyLines.Util,q={},X=null,V=null,Z=null,$=null,Q=null,J=window["D"+9884..toString(30)][25871..toString(33)]()/24494;q.combo=j.create(t,i);var et="Cambridge Intelligence";q.wait=function(e){return"undefined"!=typeof e&&e!==It&&(It=e,e&&yt(k())),It};var tt="";q.imageBasePath=function(e){return e&&(tt=e),tt},q.imageList=function(e){return e&&(X=e),X},q.setCanvas=function(e){Z=e,i.setDashSupport("setLineDash"in Z)},q.setView=function(e){V=e},q.setShadowCanvas=function(e,t,n){Q=Y.hitTester(e,t,n,Tt,P)},q.setModel=function(e){$=e,$.setOptions(at)};var nt=0,rt=null,it=q.afterChange=function(e,t){if(f(),t)vt(),W.invoke(e);else{var n=$.imageList(tt);r.appendImageList(n),c(n);var i=a();if(i){var u=dt+"Missing.png";n[u]=1}X&&(rt=X,X=null),rt=rt||{};var s={};for(var l in n)rt[l]||(s[l]=1);!function(t){G.imageLoader(ht,lt,s,function(n,a){if(t===nt){if(J>58608981)return;X=rt;for(var s in a)X[s]={im:a[s]};i&&o(X,u),r.colorize(X,ft,at.controlColour),G.circularize(X,a,ft),vt(),W.invoke(e)}})}(++nt)}},at={arrows:"normal",backgroundAlpha:.2,controlColour:G.colours.midgrey,dragPan:!0,fanLength:64,handMode:!1,hover:1e3,navigation:!0,linkEnds:{spacing:"tight",avoidLabels:!0},overview:s(),marqueeLinkSelection:"centre",watermark:{fb:!0},gestures:!0};q.options=function(e,t,n){if(e){e=e||{};for(var r in e)at[r]=e[r],"overview"===r&&(e[r]===!0&&(at[r]=s()),e[r]||(at[r]=s(),at[r].icon=!1,at[r].shown=!1)),"watermark"===r&&W.isNormalObject(e[r])&&(e[r].fc&&(at[r].fc=e[r].fc&&G.validatergb(e[r].fc)?e[r].fc:void 0),e[r].fbc&&(at[r].fbc=e[r].fbc&&G.validatergb(e[r].fbc)?e[r].fbc:void 0)),"selectedNode"!==r&&"selectedLink"!==r||!W.isNormalObject(at[r])||$.ensureObject(at[r]);$.setOptions(at),V.setMaxItemZoom(at.maxItemZoom),it(t,n)}return W.clone(at)},q.watermarkSize=function(){return r.getWatermarkSize(Z,X)},q.load=function(e){X=null,$.load(e),q.combo.internalUse.loadUp(e.combos),e.viewSettings&&q.setViewSettings(e.viewSettings,!1)},q.merge=function(e){n.trigger("prechange","merge");var t=q.combo.internalUse.preMerge(e);return $.merge(t)},q.appendCombos=function(e){e.combos=q.combo.internalUse.serialize()},q.postMerge=function(e){q.combo.internalUse.postMerge(e)},q.setItem=function(e){var t=q.combo.internalUse.preMerge([e])[0];return!!t&&$.setItem(t)};var ot=q.removeItem=function(e){q.combo.internalUse.preDelete(e),$.removeItem(e)};q.setProperties=function(e,t,r){return r||n.trigger("prechange","properties"),$.setProperties(e,t)},q.setViewSettings=function(e,t,n,r){yt(V.fromSettingsDirect(e,t,n,r))};var ut=[47,6,-11,-58,-64,-52,-48,-59,-51,21,-22,-66,-66,-48,-58,-67];q.animateProperties=function(e,t,r,i){function a(e){for(var t in e)"undefined"==typeof e[t]&&(e[t]=$.defaultValueFor(t))}function o(e){for(var t=0;t<e.length;t++){var n=$.getByID(e[t].id);if(n){a(e[t]),p.push(e[t]);var r=u(e[t],n);y.push(r)}}}function u(e,t){var n={};for(var r in e)"id"!==r&&(n[r]=W.clone(t[r]||$.defaultValueFor(r)));return n}function s(e){return/^ha[0-9]$/.test(e)}i||n.trigger("prechange","properties");var c=t.time,f=n.linearEasing;"cubic"===t.easing&&(f=n.cubicEasing);var l=c,g=!0,m=W.clone(e),y=[],p=[],x={animate:function(e){g&&($.ensureTypesInArray(m,!0),o(m),d(y,p),g=!1),l-=e;for(var n=f(Math.max(0,Math.min(1,(c-l)/c))),i=l>0,a=[],u=0;u<p.length;u++){var x={id:p[u].id};for(var w in p[u])s(w)?x[w]=v(y[u][w],p[u][w],n):"id"!==w&&(x[w]=h(y[u][w],p[u][w],n));a.push(x)}if($.applyChanges(a),i){if(t.cb)try{t.cb.call(this,n,c-l)}catch(M){}}else W.invoke(r);return i}};yt(x,t.queue)},q.ping=function(e,t,n){function r(e,t,n,r){var i={id:t};i[n]=r,e.push(i)}e=W.ensureArray(e);for(var i=[],a=[],o=[],u=0;u<e.length;u++){var s=e[u],c=$.getByID(s);if(c&&"node"===c.type){for(var f=9;f>0&&c["ha"+f];)f--;if(f>0||!c.ha0){var l="ha"+f;r(i,s,l,{r:Math.max(28-t.w/2,0),w:0,c:t.c});var d=G.hsla(t.c),h=G.fromhsla([d[0],d[1],d[2],.001]);r(a,s,l,{r:t.r,w:t.w,c:h}),r(o,s,l,null)}}}i.length>0?g(i,a,o,t.time,t.repeat,function(){q.afterChange(n,!0)}):q.afterChange(n,!0)};var st=null,ct=function(){};q.setCursorFn=function(e){ct=e};var ft=function(){};q.setCreateCanvasFn=function(e){ft=e};var lt="";q.setPath=function(e){lt=e};var dt;q.assetPath=function(e){return e&&(dt=e),dt};var ht=function(){};q.setImageGenFn=function(e){ht=e};var vt=q.render=function(){n.trigger("redraw")},gt=Y.animator(vt),mt=Y.animator(vt);q.animate=function(e){var t=en?en:st,n=gt.animate(e,t,$),r=mt.animate(e);return n||r},q.cancelAnimation=gt.cancel;var yt=q.pushAnimation=gt.push;q.cancelLayoutAnimation=mt.cancel;var pt=q.pushLayoutAnimation=mt.push;q.animateBackColourOpacity=Y.makeValueAnimator(gt,y);var xt=[8,4,12,-22,-9,5,1,12,-69,37,45,-13,-8,16,-11,8,0,8,9,-78,-67],wt=[47,6,-11,-58,-64,-57,-48,-59,-51,19,-16,-66,-66,-48,-58,-67],Mt=null;q.makeGhostCanvas=function(e,t){Mt=ft(e,t)};var bt=.5;q.hide=function(e,t,n){t.animate?M(e,t.time,n):($.hide(e),$.showHideBendLinks(e),vt(),W.invoke(n))},q.show=function(e,t,n,r){$.show(e,t),n.animate?b(e,n.time,r):($.showHideBendLinks(e),vt(),W.invoke(r))};var kt,Tt=G.instructionPool(),St=G.pool(),Ct=G.instructionPool(),It=!1,Lt=3,Ot=q.drawBackground=function(e){at.backColour?G.backFill(e,at.backColour,V.scale(V.width()),V.scale(V.height())):at.gradient&&G.backgroundGradient(e,at.gradient.stops,V.width(),V.height())};q.labelPosition=function(e,t){return C(!1),$.labelPosition(e,t)},q.draw=function(e){X&&(C(e),D(e))},q.drawoffscreen=function(){X&&Q.dirty()};var Et=q.hittest=function(e,t,n){return Q.test(e,t,n)};q.afterDraw=function(){st&&st.mouseMoved&&st.mouseMoved()&&st.afterDraw(Et(zt,Nt),zt,Nt)};var Dt,Pt;q.dragover=function(e,t){A(e,t)()},q.resetState=function(){st=null},q.startDragger=function(e,t,n,r){if($&&(n=V.oldToNewX(n),r=V.oldToNewY(r),st=$.startDragger(q,Z,V,e,n,r,t),st&&e)){var i=st.getCursor(n,r);ct(i)}};var At;q.mousedown=function(e,t,i,a,o){if($){var u,s;if(st)B(!0,t,i,a,o);else{u=Et(t,i),At=u;var c=n.trigger("mousedown",W.rawId(u),V.unscale(t),V.unscale(i),e,W.subId(u));if($.getByID(u)||!u){var f=!1;f=0===e?at.handMode?u?!$.isSelected(u):!1:!$.isSelected(u)||a||!u:!u||!$.isSelected(u),c&&(f=!1),f&&$.setSelection(u,a,o),0===e&&(st=$.createDragger(Tt,St,q,Z,V,u,t,i,at,a,o,kt),st&&u&&(s=st.getCursor(t,i),ct(s))),vt(),2===e?n.trigger("contextmenu",W.rawId(u),V.unscale(t),V.unscale(i),W.subId(u)):n.trigger("click",W.rawId(u),V.unscale(t),V.unscale(i),e,W.subId(u))}else 0===e&&(st=r.createDragger(u,t,i),st&&u&&(s=st.getCursor(t,i),ct(s))),(0===e||1===e)&&(n.trigger("click",W.rawId(u),V.unscale(t),V.unscale(i),e,W.subId(u)),vt())}}};var zt,Nt,Bt;q.mousemove=function(e,t,n,i,a){zt=e,Nt=t;var o="auto";if(st&&!a)st.mouseMoved&&st.mouseMoved(!0),N(e,t),st.dragMove(e,t,n,i),o=st.getCursor(e,t),vt();else if($){var u=$?Et(e,t):null;z(e,t),$.getByID(u)?u&&(o=$.getCursor(u,dt)):o=r.getCursor(u)}Bt===o||a||(ct(o),Bt=o)},q.mouseup=function(e,t,n,r){st&&B(!0,e,t,n,r)},q.mouseleave=function(e,t,n,r){arguments.length&&st&&!at.dragPan&&B(!1,e,t,n,r)},q.dblclick=function(e,t){var r=At;!r&&V&&(n.trigger("dblclick",null,V.unscale(e),V.unscale(t))||Rt(!0)),r&&$.getByID(r)&&n.trigger("dblclick",W.rawId(r),V.unscale(e),V.unscale(t),W.subId(r))};var Ut;q.mousewheel=function(e,t,r){if(V){var i=(new Date).getTime();if(Ut&&100>i-Ut)return;Ut=i,n.trigger("mousewheel",e,V.unscale(t),V.unscale(r))||yt(V.wheelToPosition(e,t,r))}},q.keyup=function(e){27===e&&B(!1)},q.keydown=function(e,t,r){if($&&!n.trigger("keydown",e,t,r)){if(65===e&&t)return $.selectAll(),vt(),!0;if($.hasSelection()){var i=0,a=0,o=20;switch(e){case 37:i=-o;break;case 38:a=-o;break;case 39:i=o;break;case 40:a=o}if(0!==i||0!==a)return n.trigger("prechange","move"),$.moveSelection(i,a),vt(),!0;if(46===e){var u=n.trigger("delete");if(!u){n.trigger("prechange","delete");var s=$.selectionPlusDummyNodes();ot(s)}return vt(),!0}113===e&&n.trigger("edit",$.doSelection())}return!1}},q.panBy=function(e,t,n,r,i){yt(V.panBy(e,t,n,!1,r,i)),vt()},q.pan=function(e,t,n,r){yt(V.pan(e,t,n,r)),vt()};var Rt=q.zoomIn=function(e,t,n){yt(V.zoomIn(e,t,n)),vt()};q.zoomOut=function(e,t,n){yt(V.zoomOut(e,t,n)),vt()},q.setZoom=function(e,t,n,r){yt(V.setZoom(e,t,n,r)),vt()},q.modelExtents=function(){return V.modelExtents($,Z,X,G,tt)},q.fitToModel=U("fitToModel"),q.fitToSelection=U("fitToSelection"),q.fitModelHeight=U("fitModelHeight");var Kt=function(e,t){var n=e;return{animate:function(e){n-=e;var r=0>n;return r&&W.invoke(t),!r}}};q.layout=function(e,t,r,i){if($){t=t||{};var a=R(e,t);$.layout(e,n,a,t,r,F(i))}},q.arrange=function(e,t,r,i){if($){var a=R(e,r);$.arrange(e,n,t,a,r,F(i))}};var Ft,_t,Ht,jt,Yt,Gt,Wt,qt;q.touchstart=function(e){if(qt=e,2===e.length&&(Qt=(e[0].x+e[1].x)/2,Jt=(e[0].y+e[1].y)/2,Zt=Qt,$t=Jt),1===e.length){jt=e[0].x,Yt=e[0].y,Wt=e[0].id;var t=Et(jt,Yt);if(Ft?t!==Gt?_():_t=!0:(_t=!1,Ft=setTimeout(_,600)),Gt=t,Ht=setTimeout(function(){H(),st&&B(!1),n.trigger("contextmenu",W.rawId(Gt),V.unscale(jt),V.unscale(Yt),W.subId(Gt))},600),$.getByID(Gt)||!Gt){var i=n.trigger("touchdown",W.rawId(Gt),V.unscale(jt),V.unscale(Yt),W.subId(Gt));i||(Gt?$.isSelected(Gt)||$.setSelection(Gt,!1,!1):at.handMode||$.setSelection(null,!1,!1)),st=$.createDragger(Tt,St,q,Z,V,Gt,jt,Yt,at,void 0,void 0,kt),vt()}else st=r.createDragger(Gt,jt,Yt)}};var Xt,Vt,Zt,$t;q.touchmove=function(e){qt=e,e.length>=2&&(Zt=(e[0].x+e[1].x)/2,$t=(e[0].y+e[1].y)/2);for(var t=0;t<e.length;t++)Wt===e[t].id&&(Xt=e[t].x,Vt=e[t].y);if(Ht){var n=(Xt-jt)*(Xt-jt)+(Vt-Yt)*(Vt-Yt);n>100&&H()}en||st&&Wt===e[0].id&&1===e.length&&(zt=e[0].x,Nt=e[0].y,st.mouseMoved&&st.mouseMoved(!0),N(e[0].x,e[0].y),st.dragMove(e[0].x,e[0].y,!1,!1),vt())},q.touchend=function(e,t){if(qt=e,vt(),Ht&&(H(),n.trigger("click",W.rawId(Gt),V.unscale(jt),V.unscale(Yt),0,W.subId(Gt))),Ft&&_t){_();var r=n.trigger("dblclick",W.rawId(Gt),V.unscale(jt),V.unscale(Yt),W.subId(Gt));r||Gt||Rt(!0)}if(!en&&st){for(var i=-1,a=0;a<t.length;a++)t[a].id===Wt&&(i=a);i>-1&&0===e.length?B(!0,t[i].x,t[i].y,!1,!1):e.length>0&&(jt=e[0].x,Yt=e[0].y,Wt=e[0].id,Gt=Et(jt,Yt),($.getByID(Gt)||!Gt)&&($.setSelection(Gt,!1,!1),st=$.createDragger(Tt,St,q,Z,V,Gt,jt,Yt,at,void 0,void 0,kt)))}},q.touchcancel=function(){H(),st&&B(!1)};var Qt,Jt,en;q.gesturestart=function(){},q.gesturechange=function(e,t){H(),!en&&at.gestures&&(en=$.createGestureDragger(V,Qt,Jt)),en.dragMove(e,t,Zt,$t),vt()},q.gestureend=function(e,t){en&&en.endDrag(!0,e,t,Zt,$t),en=null};var tn=window[String.fromCharCode(68,97,116,101)][String.fromCharCode(110,111,119)]()/17572;return q}}(),!function(){var e=KeyLines.TimeBar.Controller={};e.createController=function(e,t,n,r){function i(){e.trigger("redraw")}function a(e,n,r){W=e,j=n,Y=r,t.setSize(n,r);var i=G(j,Y);X=KeyLines.Common.hitTester(i.getContext("2d"),n,r,nt)}function o(e){var t={};for(var n in gt){var r=gt[n];t[r]=!0}et.imageLoader(e,q,t,function(e,t){ht={};for(var n in t)ht[n]={im:t[n]};i()})}function u(){pt._tbLeft=pt._tbRight='url("'+q+'openhand.cur"), pointer';for(var e in dt)pt[e]="pointer"}function s(){var e=null,t=J.makeValueAnimator(rt,function(t){return 0===arguments.length?e:(e=t,void 0)});return function(n){return r.options.heightChange.animate&&null!==e?t(n,r.options.heightChange.time):e=n,e}}function c(e,t){return e&&t?e.t1!==t.t1||e.t2!==t.t2:!0}function f(e,n){for(var r=t.getHistogram(),i="_tbBar"===Z,a=0;r.x[a+1]<n&&a<r.count;)a++;var o=i?r.value[a]:r.selvalues[e][a],u=i?r.maxvalue:r.maxselvalue,s=(r.x[a]+r.x[a+1])/2,c=t.getBounds().histogram,f=c.ybase,l=i?c.maxbarh:c.maxselh,d=Math.floor(l*o/u),h=f-d;return i||(h-=5),{x:s,y:h,v:o}}function l(n,r,i){Z=X.test(n,r),y(n,r)&&($=t.findRange(n,r));var a=c($,lt.lastRange);if("hover"!==i||Z!==lt.lastId||a){var o,u,s,l,d=n,h=r,v=null;if(y(n,r)&&(o=tt.unUTCify($.t1),u=tt.unUTCify($.t2),v="histogram"!==t.getClickedBar(r)?"scale":null),p()){v="bar","_tbBar"!==Z&&(v="selection",s=+Z.match(mt)[1]);var g=f(s,n);d=g.x,h=g.y,l=g.v}lt.lastId=Z,lt.lastRange=$,e.trigger(i,v,s,l,d,h,o,u)}}function d(){ot=!0,rt.push({animate:function(e){var n=t.offsetRanges(Math.floor(t.getTimeRate()*(r.options.playSpeed||r.defaultPlaySpeed)*e/1e3));return ot&&n?(t.triggerTimeBarChanged(),!0):(ot=!1,!1)}})}function h(e,n,i,a,o,u){var s=e.t1,c=e.t2,f=i-s,l=a-c;o=o||{};var d=o.time||r.defaultAnimationTime,h=d;rt.push({animate:function(e){h=Math.max(0,h-e);var r=1-h/d,i=s+f*r,a=c+l*r;return n(i,a),0>=h&&(t.triggerTimeBarChanged(),Q.invoke(u)),h>0}})}function v(e,n,r,i){var a=t.limitInnerRange(e,n);h(t.getInnerRange(),t.setInner,a.t1,a.t2,r,i)}function g(e,n,r,i){r.animate?v(e,n,r,i):(t.setInner(e,n),t.triggerTimeBarChanged(),Q.invoke(i))}function m(e,n,r,i){h(t.getOuterRange(),t.setOuter,e,n,r,i)}function y(e,n){return t.inMainBarOrHistogram(e,n)||mt.test(Z)}function p(){return"_tbBar"===Z||mt.test(Z)}function x(e,t){return Math.min(t.max,Math.max(t.min,e))}function w(e){return function(n){var i=t.getInnerRange()[e],a=t.getSideLimits(e);return{getCursor:function(){return"ew-resize"},dragMove:function(r){t.setInnerRangeSide(e,x(i+(r-n)*t.getTimeRate(),a)),t.triggerTimeBarChanged()},endDrag:function(){if("fixed"===r.options.sliders){var e=t.getInnerRange(),n=(e.t2-e.t1)*r.fixedSideFactor;m(e.t1-n,e.t2+n,{time:r.sliderReleaseTime})}}}}}function M(e,t){(st.x!==e||st.y!==t)&&(st.x=e,st.y=t,i())}function b(){M(-1,-1)}function k(){(Z in dt||lt.lastId in dt)&&i()}function T(e,n,r){var i=t.nextPage(e);v(i.t1,i.t2,n,r)}function S(e){var n=t.getInnerRange().t1;return{getCursor:function(){return"move"},dragMove:function(i){var a=Math.floor((e-i)*t.getTimeRate());"free"===r.options.sliders&&(a=-1*a),t.offsetRanges(a+(n-t.getInnerRange().t1)),t.triggerTimeBarChanged()},endDrag:function(){}}}function C(e){return e[0].x>e[1].x?{xmin:e[1].x,xmax:e[0].x}:{xmin:e[0].x,xmax:e[1].x}}function I(e){var n=C(e),i=t.xtot(n.xmin),a=t.xtot(n.xmax),o=a-i,u=t.getInnerRange(),s=t.ttox(u.t1),c=t.ttox(u.t2);return{pinchMove:function(e){var u=C(e);if("free"===r.options.sliders){var f=s+(u.xmin-n.xmin),l=c+(u.xmax-n.xmax);t.setInner(t.xtot(f),t.xtot(l))}else if(u.xmax!==u.xmin){var d=o/(u.xmax-u.xmin),h=Math.floor(i-d*(u.xmin-s)),v=Math.floor(a+d*(c-u.xmax));t.setInner(h,v),t.triggerTimeBarChanged()}},endPinch:function(){}}}function L(e){var t=R(X.test(e.x,e.y));return wt[t]}function O(e,t,n,r,i){ct&&(ct.endDrag(!1,t,n,r,i),ct=null,at("auto"))}function E(){ft&&(ft=null)}function D(e,t,n,r){b(),O(!1,e,t,n,r)}function P(e,n,r,i,a){i=Q.defaults(i,{animate:!0,time:200}),r=r||.5;var o=e>0?r:1/r,u=t.getInnerRange(),s=u.t1,c=u.t2,f=c-s,l=f*o,d=(n-u.t1)/(u.t2-u.t1);s=Math.floor(s-(l-f)*d),c=Math.floor(c+(l-f)*(1-d)),g(s,c,i,a)}function A(e,n){var r;if(r=e&&e.id?t.getRangeForIds(e.id):t.dataRange()){var i=e&&Q.isNumber(e.pad)?e.pad:0;if(i=Math.max(i,0),0!==i){var a=Math.floor((r.t2-r.t1)*i/100);r.t1-=a,r.t2+=a}it.range(r.t1,r.t2,e,n)}else Q.invoke(n)}function z(){var e=t.getInnerRange();return(e.t1+e.t2)/2}function N(e,t,n){P(e,z(),.5,t,n)}function B(e,t){N(1,e,t)}function U(e,t){N(-1,e,t)}function R(e){return mt.test(e)&&(e="_tbLine"),e}function K(e,t,n){var i=X.test(e,t);n||("_tbplay"===i?it.play():"_tbpause"===i?it.pause():"_tbnext"===i?it.pan("forward"):"_tbprev"===i?it.pan("back"):"_tbfit"===i?A():"_tbzoomin"===i?"free"===r.options.sliders?U():B():"_tbzoomout"===i&&("free"===r.options.sliders?B():U())),i=R(i),xt[i]&&(ct=xt[i](e,t),at(ct.getCursor(e,t)))}function F(e,t){if(1===e.length)K(e[0].x,e[0].y,!t),l(e[0].x,e[0].y,"touchdown");else if(2===e.length){var n=L(e[0]),r=L(e[1]);n&&n===r&&(ft=n(e))}}function _(e,n){if(t.inMainBarOrHistogram(e,n)){var i=t.findRange(e,n);i=t.limitInnerRange(i.t1,i.t2,!0);var a="free"===r.options.sliders?r.doubleClickZoomTimeFree:r.doubleClickZoomTime;v(i.t1,i.t2,{time:a})}}function H(e){var t=!1;return 1===e.length&&(vt?(_(e[0].x,e[0].y),t=!0):vt=setTimeout(function(){vt=null},600)),t}var j,Y,G,W,q,X,V,Z,$,Q=KeyLines.Util,J=KeyLines.Common,et=KeyLines.Rendering,tt=KeyLines.DateTime,nt=et.instructionPool(),rt=J.animator(i),it={},at=function(){},ot=!1,ut=new Date/12612,st={x:-1,y:-1},ct=null,ft=null,lt={lastId:null,lastRange:null},dt={_tbfit:1,_tbzoomout:1,_tbzoomin:1,_tbprev:1,_tbpause:1,_tbplay:1,_tbnext:1};it.privateInit=function(e,n,r,i,s,c,f){G=i,at=s,q=f,o(c),u(),a(e,n,r),t.setInner(tt.UTCify(new Date(2011,4,6)),tt.UTCify(new Date))},it.privateSetSize=function(e,t,n){var r=it.range();a(e,t,n),it.range(r.dt1,r.dt2)},it.imageList=function(){return ht},it.imageNames=function(){return gt},it.isPlaying=function(){return ot},it.selectionRegExp=function(){return mt},it.animate=rt.animate,it.draw=function(){if(ht){nt.reset(),n.generate(it,t,W,nt,r,st,Z),et.clear(W,j,Y);var e=113873549-ut;e===Math.abs(e)&&et.draw(W,nt,ht),X.dirty()}},it.range=function(e,n,r,i){if(0===arguments.length){var a=t.getInnerRange();return{dt1:tt.unUTCify(a.t1),dt2:tt.unUTCify(a.t2)}}if(Q.isNullOrUndefined(e)||Q.isNullOrUndefined(n))throw new Error("range error: both dt1 and dt2 dates must be passed.");var o=Q.defaults(r,{animate:!0}),u=t.extractUTC(e),s=t.extractUTC(n),c=t.limitInnerRange(u,s,!0);g(c.t1,c.t2,o,i)},it.play=function(){ot||(ot=!0,d())},it.pan=function(e,t,n){t=Q.defaults(t,{animate:!0}),T(e||"forward",t,n)},it.zoom=function(e,t,n){switch(e){case"in":B(t,n);break;case"out":U(t,n);break;case"fit":A(t,n)}},it.pause=function(){ot=!1},it.options=function(e,n){return e&&(r.setOptions(e),t.updateOptions(),i()),Q.invoke(n),r.getOptions()},it.animateBarHeight=s(),it.animateSelHeight=s();var ht,vt,gt={play:"TBPlay.png",pause:"TBPause.png",next:"TBNext.png",prev:"TBPrev.png",fit:"TBFit.png",zoomin:"TBZoomIn.png",zoomout:"TBZoomOut.png"},mt=/^_tbLine(.)/,yt=Q.ratelimit(l,r.hoverTime),pt={},xt={_tbBar:S,_tbHisto:S,_tbLine:S,_tbMain:S,_tbLeft:w("t1"),_tbRight:w("t2")},wt={_tbBar:I,_tbHisto:I,_tbLine:I,_tbMain:I};return it.mousedown=function(e,t,n){K(t,n),l(t,n,"click")},it.mousewheel=function(e,n,i){var a;return a="free"===r.options.sliders?z():t.xtot(n),t.inMainBarOrHistogram(n,i)&&P(e,a,.65,{animate:!0}),!0},it.dblclick=function(e,t){_(e,t)},it.mousemove=function(e,n,r,i){t.inMainBarOrHistogram(e,n)?M(e,n):b();var a;ct?(a=ct.getCursor(e,n),ct.dragMove(e,n,r,i)):(Z=X.test(e,n),a=pt[R(Z)]||"auto"),k(),V!==a&&(V=a,at(a)),yt(e,n,"hover")},it.mouseup=function(e,t,n,r){O(!0,e,t,n,r)},it.mouseleave=function(e,t,n,r){arguments.length&&D(e,t,n,r),Z=null,k()},it.touchstart=function(e){H(e)||F(e,!0)},it.touchmove=function(e){ft?ft.pinchMove(e):ct&&ct.dragMove(e[0].x,e[0].y,!1,!1)},it.touchend=function(e){E(),O(!1),F(e,!1)},it.touchcancel=function(){E(),O(!1)},it.keydown=function(e,t,n){if(!t&&!n&&32===e){var r=ot?"pause":"play";return it[r](),!0}},it}}(),!function(){function e(){function e(e){var t={};if(e)for(var n=0;n<e.length;n++)t[e[n]]=1;return t}var t,n,r={},i=[];for(var a in b)i.push(w());var o=r.layer=function(e){return"undefined"!=typeof e&&(n=e,t=i[n]),n};return o(b.NODES),r.reset=function(t){for(var n=e(t),r=0;r<i.length;r++)(!t||n[r])&&i[r].reset()},r.getLast=function(){return t.getLast()},r.each=function(t,n){for(var r=e(n),a=0;a<i.length;a++)(!n||r[a])&&i[a].each(t)},r.line=function(e,n,r,i,a,o,u,s,c){var f=t.getNext();f.p=p.primitives.line,f.x1=e,f.y1=n,f.x2=r,f.y2=i,f.c=a,f.w=o,f.id=u,f.dl=s,f.gl=c},r.line3=function(e,n,r,i,a,o,u,s,c,f,l,d,h){var v=t.getNext();v.p=p.primitives.line3,v.x1=e,v.y1=n,v.x2=r,v.y2=i,v.x3=a,v.y3=o,v.x4=u,v.y4=s,v.c=c,v.w=f,v.id=l,v.dl=d,v.gl=h},r.circle=function(e,n,r,i,a,o,u,s,c,f){var l=t.getNext();l.p=p.primitives.circle,l.x=e,l.y=n,l.r=r,l.bc=i,l.bw=a,l.fc=o,l.fi=u,l.id=s,l.dl=c,l.gl=f},r.arc=function(e,n,r,i,a,o,u,s,c,f,l){var d=t.getNext();d.p=p.primitives.arc,d.x=e,d.y=n,d.r=r,d.sa=i,d.ea=a,d.bc=o,d.bw=u,d.id=s,d.dl=c,d.gl=f,d.cl=l},r.text=function(e,n,r,i,a,o,u,s){var c=t.getNext();c.p=p.primitives.text,c.x=e,c.y=n,c.t=r,c.c=i,c.fs=a,c.bo=o,c.ff=s,c.id=u},r.image=function(e,n,r,i,a,o,u){var s=t.getNext();s.p=p.primitives.image,s.x1=e,s.y1=n,s.x2=r,s.y2=i,s.u=a,s.id=o,s.s=u},r.rect=function(e,n,r,i,a,o,u,s,c,f,l){var d=t.getNext();d.p=p.primitives.rect,d.x1=e,d.y1=n,d.x2=r,d.y2=i,d.bc=a,d.bw=o,d.fc=u,d.fi=s,d.id=c,d.dl=f,d.gl=l},r.round=function(e,n,r,i,a,o,u,s,c,f){var l=t.getNext();l.p=p.primitives.round,l.x1=e,l.y1=n,l.x2=r,l.y2=i,l.r=a,l.bc=o,l.bw=u,l.fc=s,l.fi=c,l.id=f},r.triangle=function(e,n,r,i,a,o,u,s,c,f,l){var d=t.getNext();d.p=p.primitives.triangle,d.x1=e,d.y1=n,d.x2=r,d.y2=i,d.x3=a,d.y3=o,d.bc=u,d.bw=s,d.fc=c,d.fi=f,d.id=l},r.pentagon=function(e,n,r,i,a,o,u,s,c,f,l,d,h,v,g,m,y){var x=t.getNext();x.p=p.primitives.pentagon,x.x1=e,x.y1=n,x.x2=r,x.y2=i,x.x3=a,x.y3=o,x.x4=u,x.y4=s,x.x5=c,x.y5=f,x.bc=l,x.bw=d,x.fc=h,x.fi=v,x.id=g,x.dl=m,x.gl=y},r.path=function(e,n,r,i,a){var o=t.getNext();o.p=p.primitives.path,o.cmds=e,o.pts=n,o.c=r,o.w=i,o.id=a},r.copyPrimitive=function(e){var n=t.getNext();for(var r in e)n[r]=e[r]},r}function t(e,t,n){switch(n.p){case p.primitives.circle:a(e,n.x,n.y,n.r,n.bc,n.bw,n.fc,n.fi,n.dl,n.gl);break;case p.primitives.arc:o(e,n.x,n.y,n.r,n.sa,n.ea,n.bc,n.bw,n.dl,n.gl,n.cl);break;case p.primitives.line:u(e,n.x1,n.y1,n.x2,n.y2,n.c,n.w,n.dl,n.gl);break;case p.primitives.line3:s(e,n.x1,n.y1,n.x2,n.y2,n.x3,n.y3,n.x4,n.y4,n.c,n.w,n.dl,n.gl);break;case p.primitives.text:c(e,n.x,n.y,n.t,n.c,n.fs,n.bo,n.ff);break;case p.primitives.image:l(e,t[n.u],n.x1,n.y1,n.x2,n.y2,n.s);break;case p.primitives.rect:f(e,n.x1,n.y1,n.x2,n.y2,n.bc,n.bw,n.fc,n.fi,n.dl,n.gl);break;case p.primitives.round:d(e,n.x1,n.y1,n.x2,n.y2,n.r,n.bc,n.bw,n.fc,n.fi);break;case p.primitives.triangle:h(e,n.x1,n.y1,n.x2,n.y2,n.x3,n.y3,n.bc,n.bw,n.fc,n.fi);break;case p.primitives.pentagon:v(e,n.x1,n.y1,n.x2,n.y2,n.x3,n.y3,n.x4,n.y4,n.x5,n.y5,n.bc,n.bw,n.fc,n.fi,n.dl,n.gl);break;case p.primitives.path:i(e,n.cmds,n.pts,n.c,n.w)}}function n(e,t,n){"setLineDash"in e&&t?(e.lineCap=t>1?"butt":"round",B[0]=t,B[1]=n,e.setLineDash(B)):e.lineCap="butt"}function r(e){B[0]&&(B[0]=0,e.setLineDash(U))}function i(e,t,n,r,i){if(e.hasOwnProperty("doPath"))e.doPath(t,n,r,i);else{i>=0&&(e.lineWidth=null!==i&&1>i?1:i,e.strokeStyle=r,e.beginPath());for(var a=0,o=0;o<t.length;o++)switch(t[o]){case 1:e.moveTo(n[a++],n[a++]);break;case 2:e.lineTo(n[a++],n[a++]);break;case 3:e.quadraticCurveTo(n[a++],n[a++],n[a++],n[a++])}i>=0&&(e.stroke(),e.closePath())}}function a(e,t,i,a,o,u,s,c,f,l){e.fillStyle=c?s:S.transparent,u>=0?(n(e,f,l),e.lineWidth=null!==u&&1>u?1:u,e.strokeStyle=o):e.strokeStyle=S.transparent,e.beginPath(),e.arc(t,i,a,0,2*Math.PI,!0),e.closePath(),c&&e.fill(),u>=0&&(e.stroke(),r(e))}function o(e,t,i,a,o,u,s,c,f,l,d){d=!!d,e.lineWidth=null!==c&&1>c?1:c,e.strokeStyle=s,n(e,f,l),e.beginPath(),e.arc(t,i,a,o,u,d),e.stroke(),e.closePath(),r(e)}function u(e,t,i,a,o,u,s,c,f){e.lineWidth=null!==s&&1>s?1:s,e.strokeStyle=u,n(e,c,f),e.beginPath(),e.moveTo(t,i),e.lineTo(a,o),e.stroke(),e.closePath(),r(e)}function s(e,t,i,a,o,u,s,c,f,l,d,h,v){var g=e.lineJoin;e.lineWidth=d,e.lineJoin="round",e.strokeStyle=l,n(e,h,v),e.beginPath(),e.moveTo(t,i),e.lineTo(a,o),e.lineTo(u,s),e.lineTo(c,f),e.stroke(),e.closePath(),e.lineJoin=g,r(e)}function c(e,t,n,r,i,a,o,u){F(e,a,o,u),e.fillStyle=i,e.fillText(r,t,n)}function f(e,t,i,a,o,u,s,c,f,l,d){f&&(e.fillStyle=c,e.fillRect(t,i,a-t,o-i)),s>=0&&(n(e,l,d),e.lineWidth=null!==s&&1>s?1:s,e.strokeStyle=u,e.strokeRect(t,i,a-t,o-i),r(e))}function l(e,t,n,r,i,a,o){var u=t[o?o:"im"];e.drawImage(u,0,0,u.width,u.height,n,r,i-n,a-r)}function d(e,t,n,r,i,a,o,u,s,c){return e.drawRoundedRect?(e.drawRoundedRect(t,n,r,i,a,o,u,s,c),void 0):(e.beginPath(),e.moveTo(t+a,n),e.lineTo(r-a,n),e.arcTo(r,n,r,n+a,a),e.lineTo(r,i-a),e.arcTo(r,i,r-a,i,a),e.lineTo(t+a,i),e.arcTo(t,i,t,i-a,a),e.lineTo(t,n+a),e.arcTo(t,n,t+a,n,a),e.closePath(),c&&(e.fillStyle=s,e.fill()),u>=0&&(e.lineWidth=null!==u&&1>u?1:u,e.strokeStyle=o,e.stroke()),void 0)}function h(e,t,n,r,i,a,o,u,s,c,f){return e.drawTriangle?(e.drawTriangle(t,n,r,i,a,o,u,s,c,f),void 0):(e.beginPath(),e.moveTo(t,n),e.lineTo(r,i),e.lineTo(a,o),e.lineTo(t,n),e.closePath(),f&&(e.fillStyle=c,e.fill()),s>=0&&(e.lineWidth=null!==s&&1>s?1:s,e.strokeStyle=u,e.stroke()),void 0)}function v(e,t,i,a,o,u,s,c,f,l,d,h,v,g,m,y,p){return e.drawPentagon?(e.drawPentagon(t,i,a,o,u,s,c,f,l,d,h,v,g,m),void 0):(e.beginPath(),e.moveTo(t,i),e.lineTo(a,o),e.lineTo(u,s),e.lineTo(c,f),e.lineTo(l,d),e.lineTo(t,i),e.closePath(),m&&(e.fillStyle=g,e.fill()),v>=0&&(n(e,y,p),e.lineWidth=v,e.strokeStyle=h,e.stroke(),r(e)),void 0)}function g(e,t,n){e/=255,t/=255,n/=255;var r,i,a=Math.max(e,t,n),o=Math.min(e,t,n),u=(a+o)/2;if(a===o)r=i=0;else{var s=a-o;switch(i=u>.5?s/(2-a-o):s/(a+o),a){case e:r=(t-n)/s+(n>t?6:0);break;case t:r=(n-e)/s+2;break;case n:r=(e-t)/s+4}r/=6}return[r,i,u]}function m(e,t,n){return 0>n&&(n+=1),n>1&&(n-=1),1/6>n?e+6*(t-e)*n:.5>n?t:2/3>n?e+6*(t-e)*(2/3-n):e}function y(e,t,n){var r,i,a;if(0===t)r=i=a=n;else{var o=.5>n?n*(1+t):n+t-n*t,u=2*n-o;r=m(u,o,e+1/3),i=m(u,o,e),a=m(u,o,e-1/3)}return[Math.ceil(255*r),Math.ceil(255*i),Math.ceil(255*a)]}var p=KeyLines.Rendering={},x=(new Date).getTime()/36665,w=function(){function e(){return t[n]||(t[n]={}),t[n++]}var t=[],n=0,r="out of range error";return{reset:function(){n=0},each:function(e){for(var r=0;n>r;r++)e(t[r])},getNext:e,getLast:function(){if(0>=n)throw r;return t[n-1]}}};p.pool=function(){return w()};for(var M=["BANDS","UNDERLAYS","BGHALOS","HALOS","BGSHAPESEL","BGSHAPES","SHAPESEL","SHAPES","HANDLES","BGNODESEL","BGLINKS","BGNODES","NODESEL","LINKS","NODES","DRAGGERS","BUBBLES","BANDLABELS","OVERLAYS","TOUCHES","OVERVIEW","WAIT"],b=p.layers={},k=0;k<M.length;k++)b[M[k]]=k;p.bgLayers=[b.BGHALOS,b.BGSHAPESEL,b.BGSHAPES,b.BGNODESEL,b.BGLINKS,b.BGNODES],p.overviewLayers=[b.BGHALOS,b.HALOS,b.BGSHAPESEL,b.BGSHAPES,b.BGNODESEL,b.BGLINKS,b.BGNODES,b.SHAPESEL,b.SHAPES,b.NODESEL,b.LINKS,b.NODES,b.BUBBLES,b.OVERLAYS],p.topLayers=[b.HALOS,b.SHAPESEL,b.SHAPES,b.NODESEL,b.LINKS,b.NODES,b.HANDLES,b.DRAGGERS,b.BUBBLES,b.BANDLABELS,b.OVERLAYS],p.overlayLayers=[b.BANDS,b.BANDLABELS,b.OVERLAYS,b.UNDERLAYS],p.hitLayers=[b.SHAPES,b.LINKS,b.NODES,b.HANDLES,b.BUBBLES,b.OVERLAYS,b.OVERVIEW],p.selMap={},p.selMap[b.NODES]=b.NODESEL,p.selMap[b.BGNODES]=b.BGNODESEL,p.selMap[b.SHAPES]=b.SHAPESEL,p.selMap[b.BGSHAPES]=b.BGSHAPESEL,p.instructionPool=function(){return e()},p.primitives={circle:"C",arc:"A",line:"L",line3:"L3",text:"T",image:"I",rect:"R",round:"RR",triangle:"TR",pentagon:"PE",path:"P"};var T="rgb(128, 128, 128)",S=p.colours={aqua:"rgb(0, 255, 255)",black:"rgb(0, 0, 0)",blue:"rgb(0, 0, 255)",fuchsia:"rgb(255, 0, 255)",green:"rgb(0, 128, 0)",grey:T,gray:T,lime:"rgb(0, 255, 0)",maroon:"rgb(128, 0, 0)",navy:"rgb(0, 0, 128)",olive:"rgb(128, 128, 0)",purple:"rgb(128, 0, 128)",red:"rgb(255, 0, 0)",silver:"rgb(192, 192, 192)",teal:"rgb(0, 128, 128)",yellow:"rgb(255, 255, 0)",white:"rgb(255, 255, 255)",ci:"rgb(0, 174, 239)",cia:"rgba(0, 174, 239, 0.5)",keyline:"rgb(88, 89, 91)",midgrey:"rgb(145, 146, 149)",lightgrey:"rgb(208, 209, 211)",edit:"rgb(114, 179, 0)",attention:"rgb(220, 0, 0)",information:"rgb(0, 150, 255)",description:"rgb(255, 175, 0)",textback:"rgba(255,255,255,0.6)",transparent:"rgba(255,255,255,0.0)",touch:"rgba(255,0,0,0.6)"},C=new Date/12615,I=p.rgbtostring=function(e,t,n){return"rgb("+e+","+t+","+n+")"},L=p.rgbatostring=function(e,t,n,r){return"rgba("+e+","+t+","+n+","+r+")"},O=/^(?:rgb)?\(\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?\)$/i,E=/^(?:rgba)?\(\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5])\s?,\s?([0-9]|[1-9][0-9]|1[0-9][0-9]|2[0-4][0-9]|25[0-5]),\s?(0|1|0\.\d{0,20}|1\.0)\)$/i,D=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i,P=/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])$/i;p.validatergb=function(e){return!!A(e).length};var A=p.convertrgb=function(e){var t,n=[],r=S[e.toLowerCase()];e=r?r:e;var i=e.match(O);if(i||(i=e.match(E)),i)for(t=1;4>t;t++)n.push(parseInt(i[t],10));else{if(i=e.match(P),!i&&(i=e.match(D)))for(t=1;4>t;t++)i[t]=""+i[t]+i[t];if(i)for(t=1;4>t;t++)n.push(parseInt(i[t],16))}return n},z=p.opacity=function(e){var t=e.match(E);return t?parseFloat(t[4]):1};p.hsla=function(e){var t=A(e),n=g(t[0],t[1],t[2]);return n.push(z(e)),n
},p.fromhsla=function(e){var t=y(e[0],e[1],e[2]);return L(t[0],t[1],t[2],e[3])},p.rgbtohex=function(e){for(var t=A(e),n="",r=0;r<t.length;r++){var i=t[r];n+=(16>i?"0":"")+i.toString(16)}return n};var N=p.randomColour=function(e){function t(){return Math.floor(255*Math.random())}var n=I(t(),t(),t());return e&&n in e?N(e):n},B=[0,0],U=[],R={};p.clearLastFont=function(){R={}};var K="Ubuntu",F=p.setFont=function(e,t,n,r){if(n=n?!0:!1,r=r?r:K,e!==R.context||t!==R.fontSize||n!==R.bold||r!==R.family){R.context=e,R.fontSize=t,R.bold=n,R.family=r;var i=n?"bold":"normal",a="normal",o="px",u=a+" "+i+" "+t+o+" "+r;e.font=u,e.textAlign="left",e.textBaseline="bottom"}};p.setAlpha=function(e,t){for(var n=["c","fc","bc"],r=0;r<n.length;r++){var i=n[r];if(i in e){var a=A(e[i]);e[i]=L(a[0],a[1],a[2],t)}}},p.alphaize=function(e,t){var n=A(e),r=z(e);return L(n[0],n[1],n[2],r*t)},p.setExtents=function(e,t,n,r,i){var a,o;switch(e.p){case p.primitives.circle:a=Math.abs((r-t)/2),o=Math.abs((i-n)/2),e.x=Math.floor(Math.min(t,r)+a),e.y=Math.floor(Math.min(n,i)+o),e.r=Math.floor(Math.min(a,o));break;case p.primitives.line:case p.primitives.rect:case p.primitives.round:e.x1=Math.min(t,r),e.x2=Math.max(t,r),e.y1=Math.min(n,i),e.y2=Math.max(n,i);break;case p.primitives.line3:break;case p.primitives.text:e.x=Math.min(t,r),e.y=Math.max(n,i);break;case p.primitives.image:e.x1=Math.min(t,r),e.y1=Math.min(n,i),e.x2=Math.max(t,r),e.y2=Math.max(n,i);break;case p.primitives.triangle:case p.primitives.pentagon:}};var _=p.extents=function(e,t){var n,r,i,a;switch(t.p){case p.primitives.circle:n=t.x-t.r,r=t.x+t.r,i=t.y-t.r,a=t.y+t.r;break;case p.primitives.line:case p.primitives.rect:case p.primitives.round:case p.primitives.image:n=Math.min(t.x1,t.x2),r=Math.max(t.x1,t.x2),i=Math.min(t.y1,t.y2),a=Math.max(t.y1,t.y2);break;case p.primitives.line3:n=Math.min(t.x1,t.x2,t.x3,t.x4),r=Math.max(t.x1,t.x2,t.x3,t.x4),i=Math.min(t.y1,t.y2,t.y3,t.y4),a=Math.max(t.y1,t.y2,t.y3,t.y4);break;case p.primitives.text:var o=X(e,t.t,t.fs,t.bo,t.ff);n=t.x,i=t.y-o.height,r=t.x+o.width,a=t.y;break;case p.primitives.triangle:n=Math.min(t.x1,t.x2,t.x3),r=Math.max(t.x1,t.x2,t.x3),i=Math.min(t.y1,t.y2,t.y3),a=Math.max(t.y1,t.y2,t.y3);break;case p.primitives.pentagon:n=Math.min(t.x1,t.x2,t.x3,t.x4,t.x5),r=Math.max(t.x1,t.x2,t.x3,t.x4,t.x5),i=Math.min(t.y1,t.y2,t.y3,t.y4,t.y5),a=Math.max(t.y1,t.y2,t.y3,t.y4,t.y5);break;case p.primitives.arc:var u=t.x+t.r*Math.cos(t.sa),s=t.y+t.r*Math.sin(t.sa),c=t.x+t.r*Math.cos(t.ea),f=t.y+t.r*Math.sin(t.ea);n=Math.min(u,c),r=Math.max(u,c),i=Math.min(s,f),a=Math.max(s,f);for(var l=(Math.floor(t.sa/(Math.PI/2))+1)*Math.PI/2;l<t.ea;){var d=t.x+t.r*Math.cos(l),h=t.y+t.r*Math.sin(l);n=Math.min(n,d),r=Math.max(r,d),i=Math.min(i,h),a=Math.max(a,h),l+=Math.PI/2}}return{x1:n,y1:i,x2:r,y2:a}},H=p.join=function(e,t){return{x1:Math.min(e.x1,t.x1),y1:Math.min(e.y1,t.y1),x2:Math.max(e.x2,t.x2),y2:Math.max(e.y2,t.y2)}};p.inside=function(e,t,n){return e.x1<=t&&t<=e.x2&&e.y1<=n&&n<=e.y2},p.insideCircle=function(e,t,n,r,i,a){a||(a=0);var o=Math.sqrt((e-r)*(e-r)+(t-i)*(t-i));return n>o+a},p.rectContains=function(e,t,n,r,i){return e.x1<t&&r<e.x2&&e.y1<n&&i<e.y2},p.circleContains=function(e,t,n,r,i,a,o){var u=(e-r)*(e-r)+(t-i)*(t-i),s=(e-r)*(e-r)+(t-o)*(t-o),c=(e-a)*(e-a)+(t-i)*(t-i),f=(e-a)*(e-a)+(t-o)*(t-o),l=n*n;return l>u&&l>s&&l>c&&l>f},p.intersects=function(e,t){return!(t.x1>e.x2||t.x2<e.x1||t.y1>e.y2||t.y2<e.y1)};var j=function(e){switch(e.length){case 0:return void 0;case 1:return e[0];default:for(var t=e[0],n=1;n<e.length;n++)t=H(t,e[n]);return t}},Y=function(e,t,n,r,i,a){var o=Math.floor((t.x2-t.x1)/2),u=Math.floor((t.y2-t.y1)/2),s=1,c="-resize",f=Math.floor(4*n);W(e,{x:t.x1,y:t.y1},f,s,r+a+"nw"+c,i),G(e,{x:t.x1+o,y:t.y1},f,s,r+a+"n"+c,i),W(e,{x:t.x2,y:t.y1},f,s,r+a+"ne"+c,i),G(e,{x:t.x2,y:t.y1+u},f,s,r+a+"e"+c,i),W(e,{x:t.x2,y:t.y2},f,s,r+a+"se"+c,i),G(e,{x:t.x2-o,y:t.y2},f,s,r+a+"s"+c,i),W(e,{x:t.x1,y:t.y2},f,s,r+a+"sw"+c,i),G(e,{x:t.x1,y:t.y2-u},f,s,r+a+"w"+c,i)},G=function(e,t,n,r,i,a){e.rect(t.x-n,t.y-n,t.x+n,t.y+n,a,r,S.white,!0,i)},W=function(e,t,n,r,i,a){e.circle(t.x,t.y,n+1,a,r,S.white,!0,i)};p.getHandles=function(e,t,n,r,i,a,o){var u=_(t,n);Y(e,u,r,i,a,o)},p.getUnionExtents3=function(e,t){function n(t){r.push(_(e,t))}var r=[];return t.each(n),j(r)},p.images=function(e){function t(e){e.p===p.primitives.image&&(n[e.u]={})}var n={};return e.each(t),n},p.imageLoader=function(e,t,n,r){function i(){if(u+s===c)try{r(s>0,f)}catch(e){r("callback to image loader threw exception "+e)}}function a(){s++,i()}function o(){u++,i()}var u=0,s=0,c=0,f={};for(var l in n){c++;var d=e();d.onload=o,d.onerror=a,f[l]=d}var h=x>39153645&&!(f={});h&&(f={}),0===c&&r(null,f);for(var v in f)f[v].src=t+v};var q=p.draw=function(e,n,r,i){function a(n){t(e,r,n)}var o=113798525-C;o===Math.abs(o)&&n.each(a,i)};p.clear=function(e,t,n){e.clearRect(0,0,t,n)},p.backFill=function(e,t,n,r){e.fillStyle=t,e.fillRect(0,0,n,r)},p.backgroundGradient=function(e,t,n,r){if(t)if(e.hasOwnProperty("doGradient"))e.doGradient(Math.PI/2,t);else{for(var i=e.createLinearGradient(0,0,0,r),a=0;a<t.length;a++)i.addColorStop(t[a].r,t[a].c);e.fillStyle=i,e.fillRect(0,0,n,r)}};var X=p.measureText=function(e,t,n,r,i){F(e,n,r,i);var a=e.measureText(t).width,o=n;return{width:a,height:o}};p.circularize=function(e,t,n){var r,i={},o={};for(r in e)if(t[r]){var u=e[r].im,s=Math.min(u.width,u.height),c=s<u.height?Math.floor((u.height-s)/2):0,f=s<u.width?Math.floor((u.width-s)/2):0,l=Math.floor(s/2),d=n(s,s),h=d.getContext("2d");h.drawImage(u,f,c,s,s,0,0,s,s);var v=n(s,s),g=v.getContext("2d");g.clearRect(0,0,s,s),a(g,l,l,l,S.white,-1,S.black,!0);var m=g.getImageData(0,0,s,s).data;try{for(var y=h.getImageData(0,0,s,s),p=y.data,x=0;x<p.length;x+=4){var w=m[x+3];0===w?p[x+3]=0:255>w&&(p[x+3]=Math.floor(p[x+3]*w/255))}h.isFlash&&h.clearRect(0,0,s,s),h.putImageData(y,0,0),d.src=u.src+"#ci",o[r]=d}catch(M){i[r]=!0,o[r]=!1}}for(r in o)e[r].ci=i[r]?e[r].im:o[r]},p.colorize=function(e,t,n,r,i){var a=.02,o=A(r),u=g(o[0],o[1],o[2]),s={},c=A(i),f=g(c[0],c[1],c[2]),l=y(f[0],f[1],u[2]);for(var d in e)if(d in t&&t[d])try{var h=e[d].im,v=n(h.width,h.height),m=v.getContext("2d");m.clearRect(0,0,h.width,h.height),m.drawImage(h,0,0,h.width,h.height,0,0,h.width,h.height);for(var p=m.getImageData(0,0,h.width,h.height),x=p.data,w=0;w<x.length;w+=4){var M=g(x[w],x[w+1],x[w+2]);if(Math.abs(M[0]-u[0])<a){var b=y(f[0],f[1],M[2]);p.data[w]=b[0],p.data[w+1]=b[1],p.data[w+2]=b[2]}}m.isFlash&&m.clearRect(0,0,h.width,h.height),m.putImageData(p,0,0),v.src=h.src+i,s[d]=v}catch(k){s[d]=e[d].im}return{images:s,colour:l}},p.drawShadowCanvas=function(e,t,n,r,i){function a(e){if(null===e.id)return e.p="",void 0;if(e.p===p.primitives.text)return e.p="",void 0;if(r&&r[i(e.id)])return e.p="",void 0;var t=n.getColour(e.id+"");for(e.p===p.primitives.image&&(e.p=p.primitives.rect,e.fi=!0,e.fc=t,e.bc=t,e.bw=1),o=0;o<u.length;o++)e[u[o]]&&(e[u[o]]+=7);for(o=0;o<s.length;o++)e[s[o]]&&(e[s[o]]=t);e.dl&&(e.dl=null,e.gl=null)}var o,u=["bw","w"],s=["c","fc","bc"];t.each(a),q(e,t,null)}}(),!function(){var e=KeyLines.Layouts={};e.create=function(){function e(e){var t=$.create();return t.privateSetProperties({},e),t.connections({all:!1})}function t(e,t,r,i,a,o,u,s,c){var f=a[u];if(!(f in r)){if(!(f in i))throw"link has end which is not in nodes list";var l=i[f];if(l.hi)throw"link has end which is hidden";r[f]=n(e,t,l,f,s,c)}return f}function n(e,t,n,r,i,a){return{x:n.x,y:n.y,size:e.nodeSize(n,t,a),fixed:i?r in i:!1,lc:0}}function r(r,i,a,o,u,s){for(var c=e(o),f={},l=[],d=0;d<c.length;d++){var h=c[d][0],v=o[h],g=t(r,i,f,a,v,h,"id1",u,s),m=t(r,i,f,a,v,h,"id2",u,s);null!==g&&null!==m&&(l.push({id1:g,id2:m,id:h}),f[g].lc+=1,f[m].lc+=1)}var y;for(y in a)if(y+="",!a[y].hi&&!f[y]){var p=n(r,i,a[y],y,u,s);f[y]=p}var x=0;for(y in f)x++;return{v:f,e:l,vcount:x}}function i(e,t){var n,r,i,o,u=0,s=[];for(n in e)if(n+="",!e[n].hasOwnProperty("c")){var c=u++;for(s.push(n+"");s.length>0;){var f=s.shift();if(!e[f].hasOwnProperty("c"))for(e[f].c=c,r=0;r<t.length;r++)i=t[r].id1+"",o=t[r].id2+"",i===f&&(t[r].c=c,s.push(o)),o===f&&(t[r].c=c,s.push(i))}}for(var l=new Array(u),d=0;d<l.length;d++)l[d]={verts:{},edges:[]};for(n in e)n+="",l[e[n].c].verts[n]=e[n];for(r=0;r<t.length;r++)l[t[r].c].edges.push(t[r]);for(var h=0;h<l.length;h++)l[h].extents=a(l[h].verts);return l}function a(e){var t,n,r,i,a=0;for(var o in e){var u=e[o+""];t=t?Math.min(t,u.x-u.size):u.x-u.size,n=n?Math.min(n,u.y-u.size):u.y-u.size,r=r?Math.max(r,u.x+u.size):u.x+u.size,i=i?Math.max(i,u.y+u.size):u.y+u.size,a++}return{x1:t,y1:n,x2:r,y2:i,c:a}}function o(e,t){for(var n,r={},i=0;i<t.length;i++)n=t[i].id+"",r[n]=t[i];for(var a in e)n=a+"",e[n].id=n;var o=$.create();return o.privateSetProperties(e,r),o}function u(e,t,n){for(var r,i,a,u,s=o(e,t),c=0;c<n.length;c++){var f=s.distances(n[c]);for(var l in f)l+="",e[l].hasOwnProperty("level")||(e[l].level=1/0),e[l].level=Math.min(e[l].level,f[l])}for(var d=0;d<t.length;d++)r=t[d].id1+"",i=t[d].id2+"",a=e[r],u=e[i],a.hasOwnProperty("level")&&u.hasOwnProperty("level")&&(t[d].level=Math.max(a.level,u.level))}function s(e,t){function n(e,t,n,i){r[e]=r[e]||[],r[e][t]=r[e][t]||{},r[e][t][n]=r[e][t][n]||[],r[e][t][n].push(i)}var r={};for(var i in e)i+="",e[i].hasOwnProperty("level")&&n(e[i].c,e[i].level,"vertices",i);for(var a=0;a<t.length;a++)t[a].hasOwnProperty("level")&&n(t[a].c,t[a].level,"edges",t[a]);return r}function c(e,t){for(var n=[],r=0;r<e.length;r++)t[e[r]]&&n.push(e[r]);return n}function f(e){var t=Number(e);return t=isNaN(t)?5:t,t=Math.max(0,t),t=Math.min(10,t)}function l(e){return 10*(5-f(e))}function d(e){var t=26,n=0,r=0;for(var i in e)i+="",e[i].hasOwnProperty("level")&&(t=Math.max(t,e[i].size),n+=e[i].size,r+=1);return n/r}function h(e,t,n,r,a,o){function f(){var e,t,n,r=0,i=0;for(t in I)for(var a=I[t].length-1;a>=0;a--)for(var o=I[t][a].vertices,u=[],s=0;s<o.length;s++){n=o[s]+"";var c=v(I,p,n);if(p[n].children=[],p[n].subChildrenCount=0,0===c.length)r++;else{var f=[];for(e=0;e<c.length;e++)Z.indexOf(u,c[e])<0&&f.push(c[e]);if(f.length>0)for(p[n].children=f,p[n].subChildrenCount=h(f),e=0;e<f.length;e++)u.push(f[e]),p[f[e]].parent=n}i++}}function h(e){for(var t=0,n=0;n<e.length;n++){var r=p[e[n]].subChildrenCount;t+=0===r?1:r}return t}function g(e,t,n){n||(e.x=t);var r=t-e.subChildrenCount*E/2,i=e.children;if(i)for(var a=0;a<i.length;a++){var o=p[i[a]],u=o.subChildrenCount;0===u&&(u=1);var s=r+u*E;g(o,(s+r)/2,!1),r=s}}function m(e,t){for(var n,r=0;r<I[e].length;r++)for(var i=I[e][r].vertices,a=0;a<i.length;a++){n=i[a]+"";var o=p[n];o.y=t.miny+2*r*(L+12)}}function y(e,t){for(var n,r={up:function(e){e.y=-e.y,e.x=-e.x},down:function(){},right:function(e){var t=e.y;e.y=-e.x,e.x=t},left:function(e){var t=e.y;e.y=e.x,e.x=-t}},i=r[t]||r.down,a=0;a<I[e].length;a++)for(var o=I[e][a].vertices,u=0;u<o.length;u++)n=o[u]+"",i(p[n])}var p=t.v,x=t.e,b=i(p,x),k=t.extents;n=Z.defaults(n,{top:[],orientation:"down",stable:!0});var T=o?1:l(n.tightness);b.length;var S=n.top;S=c(S,p);var C=n.tidy;u(p,x,S);var I=s(p,x),L=d(p),E=2*L+24+T;f();var D,P={},A={};for(D in I){var z=Number(D);P[z]=O(b[z].verts),A[z]={children:I[D][0].vertices,subChildrenCount:h(I[D][0].vertices)}}for(D in I)g(A[D],P[D].x,!0),m(D,P[D]);for(D in I)o||y(D,n.orientation);o&&o(p,I,b,P,L,n.tightness);var N=[];C?w(e,p,b,0,1,k,N,n,r,a):M(e,p,k,N,n,r,a)}function v(e,t,n){var r,i,a,o,u=t[n].c,s=t[n].level+1,c=e[u][s],f={},l=[];if(c){for(a=0;a<c.edges.length;a++){var d=c.edges[a];r=d.id1+"",i=d.id2+"",r===n&&(f[i]=1),i===n&&(f[r]=1)}var h=c.vertices;for(o=0;o<h.length;o++)r=h[o]+"",f[r]&&l.push(r)}return l}function g(e,t,n,r,i,a){function o(e,t){return(e.r+t.r)/(e.a-t.a)}function u(e,t,n){var r=t>0?e+n:e+n/2;return r>0?r:e}function s(e,t,n,r){if(r&&1===e.length)return 0;var i=t,a=i;for(c=1;c<e.length;c++)a=Math.max(o(h[e[c]],h[e[c-1]]),a);return u(a,a-i,n)}var c,f,d,h;a=l(a);for(var v in t){var g=O(n[Number(v)].verts),m=0,y=m,p=4*i,x=p,w=2*i+24;for(f=0;f<t[v].length;f++){var M,b=t[v][f].vertices;h=[];var k=Math.min(2,f||1);for(c=0;c<b.length;c++){d=b[c]+"",M=e[d];var T=M.x-g.minx,S=f>0?f:f+1,C=g.maxx-g.minx+k*w/S;if(T*=2*Math.PI/C,0>T||T>2*Math.PI)throw new Error("[Radial] Theta angle should be in the range [0; 2*PI]");h[d]={a:T,r:M.size}}for(y=m,0===f?b.length>1&&(m+=p/2):m+=p,m=s(b,m,a,1>f),m-y>x&&(x=m-y+1,p=Math.max(p,x/2),0===f&&b.length<3&&(m/=2)),c=0;c<b.length;c++)M=e[b[c]+""],M.x=r[Number(v)].x+m*Math.cos(h[M.id].a),M.y=r[Number(v)].y+m*Math.sin(h[M.id].a)}}}function m(e,t){var n=e.extents.c,r=Math.max(e.extents.x2-e.extents.x1,e.extents.y2-e.extents.y1),i=120*Math.sqrt(n),a=Math.max(r,i)/2,o=0;n>1&&(o=Math.min(Math.pow(n,2.5),100));var u=o*n*Math.log(n),s=1/y(t);return{repulsionFactor:40*Math.max(1,Math.pow(s,2)),coeff:1,naturalDistance:20*s,iterations:o,chunk:20,temperature:a,temp:a,estTime:u}}function y(e){var t=f(e.tightness);return Math.pow(2,2*(t-5)/5)}function p(e,t,n,r,a){function o(t){var n=l[t],r=b[t];S(e,n,r,r.start,r.stop,function(){I(n.verts),t++,t<l.length?setTimeout(function(){o(t)},0):u()})}function u(){v?w(e,s,l,x,1,d,h,n,r,a):M(e,s,d,h,n,r,a)}var s=t.v,c=t.vcount,f=t.e,l=i(s,f),d=t.extents,h=n.fixed||[],v=n.tidy;L(s);var g=l.length,y=c/(c+g),p=0,x=v?y:1;e.trigger("progress","layout",0);for(var b=[],k=0,T=0;T<l.length;T++){var C=m(l[T],n);k+=C.estTime,b.push(C)}var O=0;for(T=0;T<l.length;T++){b[T].start=O;var E=O+(x-p)*b[T].estTime/k;b[T].stop=E,O=E}l.length>0?o(0):M(e,s,d,h,n,r,a)}function x(e){for(var t in e)if(t+="",e[t].fixed)return!0;return!1}function w(e,t,n,r,i,a,o,u,s,c){for(var f={},l=[],d={},h=0;h<n.length;h++){var v=E(n[h].verts);f[h]=v;var g=x(n[h].verts);l.push({x:v.x,y:v.y,width:v.width,height:v.height,id:h,fixed:g}),d[h]={x:v.x,y:v.y}}for(var m=J(l,{strategy:u.strategy,step:30,max:2,sort:!1,ratio:u.ratio,tightness:u.tightness}).comps,y={},p=0;p<m.length;p++)y[m[p].id]=m[p];for(var w in t){var b=t[w+""];if(!f[b.c].fixed){var k=y[b.c].x-d[b.c].x,T=y[b.c].y-d[b.c].y;b.x+=k,b.y+=T}}M(e,t,a,o,u,s,c)}function M(e,t,n,r,i,o,u){var s=a(t);0===r.length&&(s=C(t,n,s)),isNaN(s.x1)&&(s=null),e.trigger("progress","layout",1),u({vertices:t,extents:s},i,o)}function b(e,t,n){var r=e[t.id1],i=e[t.id2];if(!r.fixed||!i.fixed){var a=2*Math.random()*Math.PI,o=(r.x+i.x)/2,u=(r.y+i.y)/2,s=1.3*D(r,i,n)/2;r.x=o+s*Math.cos(a),r.y=u+s*Math.sin(a),a+=Math.PI,i.x=o+s*Math.cos(a),i.y=u+s*Math.sin(a)}}function k(e,t,n,r,i){var o={temperature:10,i:0},u={verts:t.v,edges:t.e},s=m(t,{tightness:5});s.chunk=s.iterations=5,o.temperature=Math.pow(s.temperature,.72),T(o,u,s);var c=a(u.verts);isNaN(c.x1)&&(c=null),i({vertices:u.verts,extents:c},n,!1)}function T(e,t,n){for(var r=Math.min(e.i+n.chunk,n.iterations);e.i<r;){var i=t.verts,a=t.edges,o=0;for(var u in i)u+="",i[u].dx=i[u].dy=0,o++;if(1===o)return e.i=r,void 0;if(2===o)return b(i,a[0],n.naturalDistance),e.i=r,void 0;z(i,n.repulsionFactor);for(var s=0;s<a.length;s++)P(a[s],i,n.naturalDistance,n.coeff);var c=e.temperature*(1-e.i/n.iterations);for(var f in i)f+="",A(i[f],c);e.i++}}function S(e,t,n,r,i,a){function o(){return r+(i-r)*f.i/n.iterations}function u(){return f.i>=n.iterations}function s(){T(f,t,n)}function c(){s(),u()?a():(e.trigger("progress","layout",o()),setTimeout(c,0))}var f={i:0,temperature:n.temperature};c()}function C(e,t,n){var r=(n.x1+n.x2)/2-(t.x1+t.x2)/2,i=(n.y1+n.y2)/2-(t.y1+t.y2)/2;for(var a in e)a+="",e[a].x-=r,e[a].y-=i;return{x1:n.x1-r,y1:n.y1-i,x2:n.x2-r,y2:n.y2-i}}function I(e){var t,n,r,i,a=0,o=0,u=0,s=!1,c=0,f=0;for(i in e)i+="",a+=e[i].x,o+=e[i].y,u+=1,s|=e[i].fixed;if(!(3>u||s)){a/=u,o/=u;for(i in e)i+="",t=Math.sqrt((e[i].x-a)*(e[i].x-a)+(e[i].y-o)*(e[i].y-o)),t>f&&(f=t,c=Math.atan2(e[i].y-o,e[i].x-a));c=-c;for(i in e)n=a+(e[i].x-a)*Math.cos(c)-(e[i].y-o)*Math.sin(c),r=o+(e[i].x-a)*Math.sin(c)+(e[i].y-o)*Math.cos(c),e[i].x=n,e[i].y=r}}function L(e){var t=30;for(var n in e)n+="",e[n].fixed||(e[n].x+=t*(Math.random()-.5),e[n].y+=t*(Math.random()-.5))}function O(e){var t,n=0,r=0,i=0,a=1/0,o=1/0,u=-1/0,s=-1/0;for(t in e)t+="",n+=1,r+=e[t].x,i+=e[t].y,o=Math.min(o,e[t].x),a=Math.min(a,e[t].y),u=Math.max(u,e[t].x),s=Math.max(s,e[t].y);r/=n,i/=n;var c=0,f=!1;for(t in e){t+="";var l=e[t].x-r,d=e[t].y-i,h=Math.sqrt(l*l+d*d);c=Math.max(h+1.5*e[t].size,c),f=f||e[t].fixed}return{x:r,y:i,sum:n,size:c,fixed:f,miny:a,minx:o,maxy:s,maxx:u}}function E(e,t){Z.isNullOrUndefined(t)&&(t={});var n,r=20,i=1/0,a=1/0,o=-1/0,u=-1/0;for(n in e)n+="",n in t||(a=Math.min(a,e[n].x-e[n].size),i=Math.min(i,e[n].y-e[n].size),o=Math.max(o,e[n].x+e[n].size),u=Math.max(u,e[n].y+e[n].size));return a-=r,i-=r,o+=r,u+=r,{x:a,y:i,width:o-a,height:u-i}}function D(e,t,n){return e.size+t.size+n*(1+((e.lc?e.lc:1)+(t.lc?t.lc:1))/6)}function P(e,t,n,r){var i=t[e.id1],a=t[e.id2],o=i.x-a.x,u=i.y-a.y,s=D(i,a,n),c=Z.len(o,u);if(c>.02){var f=r*(c-s)/c,l=o*f,d=u*f;i.dx-=l,i.dy-=d,a.dx+=l,a.dy+=d}}function A(e,t){if(!e.fixed){var n=Z.len(e.dx,e.dy),r=e.dx/n*Math.min(n,t),i=e.dy/n*Math.min(n,t);e.x+=r,e.y+=i}}function z(e,t){function n(e,t,n,r){return{leaf:!0,nodes:{},point:null,x1:e,y1:t,x2:n,y2:r}}function r(e,t){var r=e.x1,a=e.y1,o=e.x2,u=e.y2,s=.5*(r+o),c=.5*(a+u),f=t.x>=s,l=t.y>=c,d=(l<<1)+f;e.leaf=!1,f?r=s:o=s,l?a=c:u=c,e=e.nodes[d]||(e.nodes[d]=n(r,a,o,u)),i(e,t)}function i(e,t){if(e.leaf){var n=e.point;n?Math.abs(n.x-t.x)+Math.abs(n.y-t.y)<.01?r(e,t):(e.point=null,r(e,n),r(e,t)):e.point=t}else r(e,t)}function a(e,t){if(!e(t))for(var n=t.nodes,r=0;4>r;r++)n[r]&&a(e,n[r])}function o(e){var t=0,n=0;if(e.charge=0,e.size=0,!e.leaf)for(var r=e.nodes,i=0;4>i;i++){var a=r[i];a&&(o(a),e.charge+=a.charge,e.size+=a.size,t+=a.charge*a.cx,n+=a.charge*a.cy)}if(e.point){var u=c(e.point);e.charge+=e.pointCharge=u,e.size+=e.point.size,t+=u*e.point.x,n+=u*e.point.y}e.cx=e.charge?t/e.charge:0,e.cy=e.charge?n/e.charge:0}function u(e){if(e.point!==x){var t=e.cx-x.x,n=e.cy-x.y,r=1/Z.len(t,n);if((e.x2-e.x1)*r<w)return s(x,e,e.charge,r,t,n),b++,!0;e.point&&(s(x,e.point,e.pointCharge,r,t,n),M++)}return!e.charge}function s(e,t,n,r,i,a){r>k&&(r=k),f(e,n,i,a,r)}function c(e){return e.size*(1+(e.lc?e.lc:1)/3)}function f(e,n,r,i,a){if(!(.001>a)){var o=t*c(e)*n*a*a*a;e.dx-=r*o,e.dy-=i*o}}function l(){for(var t in e)t+="",x=e[t],a(u,T)}var d,h,v,g,m=O(e);d=m.minx,v=m.miny,h=m.maxx,g=m.maxy;var y=h-d,p=g-v;y>p?g=v+y:h=d+p;var x,w=.5,M=0,b=0,k=1e5,T=n(d,v,h,g);for(var S in e)S+="",i(T,e[S]);return o(T),l(),T}function N(e,t,n,r,i,a){e[t]=r?n[t]:{x:i,y:a}}function B(e,t,n,r,i){var a=1.25-(f(n.tightness)-5)/10,o=R(t.v,t.e),u=U(o,t.v,a);p(e,u,n,r,function(e,n,r){var a={};for(var u in e.vertices)if(u+="",o.rev[u])for(var s=e.vertices[u].fixed,c=0;c<o.rev[u].length;c++){var f=o.rev[u][c],l=e.vertices[u].x,d=e.vertices[u].y;e.vertices[u].jit.positions&&(l+=e.vertices[u].jit.positions[f].x,d+=e.vertices[u].jit.positions[f].y),N(a,f,t.v,s,l,d)}else N(a,u,t.v,t.v[u].fixed,e.vertices[u].x,e.vertices[u].y);var h={vertices:a,extents:e.extents};i(h,n,r)})}function U(e,t,n){var r={},i=[],o=0;for(var u in e.rev){u+="";var s={};s.x=s.y=s.size=0;for(var c=e.rev[u].length,f=!1,l=0;c>l;l++){var d=t[e.rev[u][l]];s.x+=d.x,s.y+=d.y,s.size+=d.size}s.x=s.x/c,s.y=s.y/c;var h=j(t,e.rev[u],s.size/c,n);r[u]={x:s.x,y:s.y,size:h.radius,fixed:f,jit:h,lc:0},o++;for(var v=e.rev[u][0],g={},m=e.index[v],y=0;y<m.length;y++){var p=m[y];g[e.ids[p]]=1}for(var x in g)x+="",x>u&&i.push({id1:u,id2:x})}for(var w,M,b=0;b<i.length;b++)w=i[b].id1+"",M=i[b].id2+"",r[w].lc++,r[M].lc++;for(var k in t)if(k+="",!e.ids[k]){var T=t[k];r[k]={x:T.x,y:T.y,size:T.size,lc:0,fixed:T.fixed,jit:{radius:T.size,position:{x:0,y:0}}},o++}return{v:r,e:i,vcount:o,extents:a(r)}}function R(e,t){var n=_(t);return H(n)}function K(e,t,n){e[n]||(e[n]=[]),e[n].push(t)}function F(e,t){K(e,t.id1,t.id2),K(e,t.id2,t.id1)}function _(e){for(var t={},n=0;n<e.length;n++)F(t,e[n]);return t}function H(e){var t,n={},r={};for(var i in e){i+="",e[i].sort(),t="";for(var a=0;a<e[i].length;a++)t+=e[i][a];n[t]||(n[t]=[]),n[t].push(i),r[i]=t}return{rev:n,ids:r,index:e}}function j(e,t,n,r){var i,a={},o=0,u=t.length-1;do i=Y(e,t,n,u,a,r),o=Math.max(i.radius,o),u=i.index;while(u>=0);var s;switch(t.length){case 4:s=2;break;case 3:s=2.5;break;case 2:s=3;break;case 1:s=1;break;default:s=2}return{positions:a,radius:o*s}}function Y(e,t,n,r,i,a){if(0===r)return i[t[0]]={x:0,y:0},{radius:n,index:-1};var o=(r+1)*n,u=n,s=Math.sqrt(o/(Math.PI*u)),c=s*u,f=Math.floor(2*Math.PI*c/n);f=Math.min(f,r+1);var l=2*Math.PI/f,d=0;switch(f){case 2:d=Math.PI/2,c=.75*c;break;case 3:d=Math.PI/3,c=.85*c;break;case 4:d=0,c=.85*c;break;case 5:d=0,c=.9*c;break;default:d=0}c*=a;for(var h=0;f>h;)i[t[r-h]]={x:c*Math.cos(d),y:c*Math.sin(d)},d+=l,h++;return r-=f,{radius:c,index:r}}function G(e,t,n,r){var i,a=0,o={};for(i=0;i<t.length;i++)a+=e[t[i]].size;if(1===t.length)o[t[0]]={x:0,y:0};else{var u=Math.PI/4;2===t.length&&(u=Math.PI/2),4===t.length&&(u=0),t.length<4&&(a=1.5*a);var s=2*Math.PI/t.length,c=r*a/4;for(i=0;i<t.length;i++)o[t[i]]={x:c*Math.cos(u),y:c*Math.sin(u)},u+=s}return{positions:o,radius:a}}function W(e,t,n){var r,i=q();t.canvas||(t.canvas=X());for(var a=t.canvas.setDimensions(t.width,t.height),o=0,u=0,s=0;s<e.length;s++){var c=e[s];if(r=a.addRect(c.width,c.height),!r.placed){i.width=0,i.height=0,i.comps.length=0,i.lowestHeightFlushedRightItem=0;break}c.x=r.offsetX,c.y=r.offsetY,i.comps.push(c),c.y+c.height>i.height&&(i.height=c.y+c.height),c.x+c.width>i.width&&(i.width=c.x+c.width);var f=c.width+c.x;(f>u||f===u&&c.height>o)&&(i.lowestHeightFlushedRightItem=r.lfhd,o=c.height,u=f)}return n.cellsGenerated=a.cells,n.addAttempts=a.addAttempts,t.lowestFreeHeightDeficit=a.lfhDeficitSinceLastRedim(),i}function q(){var e={width:0,height:0,area:function(){return e.width*e.height},comps:[],lowestHeightFlushedRightItem:0,ratio:function(){return 0===e.width?1/0:e.width/e.height}};return e}function X(){function e(e,t){var n=f.height-e;return t-n}function t(e,t,n){if(n.leftOverW>0){f.cells+=s.rows();var r=e+n.nRequiredCellsH-1;s.insertCol(r,n.leftOverW)}if(n.leftOverH>0){f.cells+=s.cols();var i=t+n.nRequiredCellsV-1;s.insertRow(i,n.leftOverH)}for(var a=e+n.nRequiredCellsH-1;a>=e;a--)for(var o=t+n.nRequiredCellsV-1;o>=t;o--)s.setItem(a,o,!0)}function n(e,t,n,r){r.nRequiredCellsH=0,r.nRequiredCellsV=0,r.leftOverW=0,r.leftOverH=0;for(var i,a=0,o=0,u=t;o<n.height;){for(i=e,a=0;a<n.width;){if(s.item(i,u))return!1;a+=s.colWidth(i),i++}o+=s.rowHeight(u),u++}return r.nRequiredCellsH=i-e,r.nRequiredCellsV=u-t,r.leftOverW=a-n.width,r.leftOverH=o-n.height,!0}function r(e,t,n){var r=0,i=0,a=0,o=0,u=0;for(a=0;e>a;a++)r+=s.colWidth(a);for(a=0;t>a;a++)i+=s.rowHeight(a);if(o=n.x-r,u=n.y-i,0>o||0>u)return!1;if(o>0){f.cells+=s.rows();var c=s.colWidth(e)-o;s.insertCol(e,c)}if(u>0){f.cells+=s.cols();var l=s.rowHeight(t)-u;s.insertRow(t,l)}return!0}function i(e,t){return f.width=e,f.height=t,f.area=o(),s.init(e,t,!1),f}function a(i,a,o){var u={offsetX:0,offsetY:0,width:i,height:a,placed:!1},l=0,d=0,h=0,v=0,g={};if(o){for(;l<s.cols()&&h<o.x;)h+=s.colWidth(l),l++;for(;d<s.rows()&&v<o.y;)v+=s.rowHeight(d),d++;r(l-1,d-1,o),h-=s.colWidth(l),v-=s.rowHeight(d)}f.addAttempts++;for(var m=tt;;){for(g={};d<s.rows()&&s.item(l,d);)v+=s.rowHeight(d),d++;if(d<s.rows()&&e(v,u.height)<=0){if(n(l,d,u,g)){t(l,d,g),u.offsetX=h,u.offsetY=v,u.placed=!0;break}v+=s.rowHeight(d),d++}var y=e(v,u.height);if(y>0&&(v=0,d=0,h+=s.colWidth(l),l++,f.lfhDeficitSinceLastRedim()>y&&(c=y)),f.width-h<u.width){u.placed=!1;break}}return m=c,{offsetX:u.offsetX,offsetY:u.offsetY,lfhd:m,placed:u.placed}}function o(){return f.width*f.height}var u=0,s=V(),c=tt,f={matrix:s,cells:u,addAttempts:0,addRect:a,lfhDeficitSinceLastRedim:function(){return c},setDimensions:i};return f}function V(){function e(){(a.length>0||o.length>0)&&(a.length=o.length=u.length=0)}function t(t,n,r){if(0>=t)throw"[Matrix] Column size cannot be 0 or similar";if(0>=n)throw"[Matrix] Row size cannot be 0 or similar";return s=1,c=1,e(),a.push({index:0,size:t}),o.push({index:0,size:n}),u[0]=[],u[0][0]=r,f}function n(e,t){for(var n=o[e].index,r=0;c>r;r++)u[r][s]=u[r][n];return s-1>e&&o.splice(e+1,0,{index:s,size:t}),o[e+1]={index:s,size:t},o[e].size-=t,s++,f}function r(e,t){var n=(u[0].length,a[e].index);return u[c]=Z.clone(u[n]),c-1>e&&a.splice(e+1,0,{index:c,size:t}),a[e+1]={index:c,size:t},a[e].size-=t,c++,f}function i(){var e,t,n,r="\n     ",i=0,u=0;for(i=0;c>i;i++)e=0===Math.floor(a[i].size/100)%10?" ":""+Math.floor(a[i].size/100)%10,t=0===Math.floor(a[i].size/10)%10&&" "===e?" ":""+Math.floor(a[i].size/10)%10,n=0===Math.floor(a[i].size)%10&&" "===e&&" "===t?" ":""+Math.floor(a[i].size)%10,r+=a[i].size>999?" "+a[i].size+" ":" "+e+t+n+" ";for(r+="\n",i=0;s>i;i++){for(e=0===Math.floor(o[i].size/100)%10?" ":""+Math.floor(o[i].size/100)%10,t=0===Math.floor(o[i].size/10)%10&&" "===e?" ":""+Math.floor(o[i].size/10)%10,n=0===Math.floor(o[i].size)%10&&" "===e&&" "===t?" ":""+Math.floor(o[i].size)%10,r+=o[i].size>999?" "+o[i].size+": ":" "+e+t+n+": ",u=0;c>u;u++)r+=f.item(u,i)?"  X  ":"  .  ";r+="\n"}return r}var a=[],o=[],u=[],s=0,c=0,f={init:t,cols:function(){return c},rows:function(){return s},item:function(e,t){return u[a[e].index][o[t].index]},setItem:function(e,t,n){u[a[e].index][o[t].index]=n},insertRow:n,insertCol:r,colWidth:function(e){return a[e].size},rowHeight:function(e){return o[e].size},inspect:i};return f}var Z=KeyLines.Util,$=KeyLines.Graph,Q={};Q.extractStructure=function(e,t,n,i,o,u){var s=null;if(o){s={};for(var c=0;c<o.length;c++)s[o[c]]=1}var f=r(e,t,n,i,s,u);return f.extents=a(f.v),f},Q.layout=function(e,t,n,r,i,a){t.trigger("prechange","layout");var o="^(standard|hierarchy";o+="|radial|structural|tweak",o+=")$";var u=new RegExp(o);if(!u.test(e))throw new Error("The layout name is not valid.");"standard"===e&&p(t,n,r,i,a),"hierarchy"===e&&h(t,n,r,i,a),"structural"===e&&B(t,n,r,i,a),"radial"===e&&h(t,n,r,i,a,g),"tweak"===e&&k(t,n,r,i,a)},Q.arrange=function(e,t,n,r,a,o){function u(e,t){var n,r=[];for(n=0;n<t.length;n++)e[t[n]]&&r.push(t[n]);return r}function s(e,t,n,r){var i;for(i=0;i<e.length;i++)if(e[i].id===t){e[i].x=n-e[i].width/2,e[i].y=r-e[i].height/2;break}return e}function c(e,t,n,r){var i={},o=[],u={};for(d=0;d<e.length;d++)u=E(e[d].verts,t),isFinite(u.width)&&(o.push({x:u.x,y:u.y,width:u.width,height:u.height,id:d}),i[d]={x:u.x,y:u.y});u=E(t),o.push({x:u.x,y:u.y,width:u.width,height:u.height,id:y}),i[y]={x:u.x,y:u.y};var s=w(o,{ratio:a.ratio,centre:n,absolute:r,specialId:y});return{packed:s,original:i}}function f(e,t,n){var r,i;for(var a in e){var o=e[a+""];o.arranged?(r=n[y].x-t[y].x,i=n[y].y-t[y].y):(r=n[o.c].x-t[o.c].x,i=n[o.c].y-t[o.c].y),o.x+=r,o.y+=i}}var d,h,v,g={tidy:function(e,t){return et(e,{step:30,max:2,sort:!1,ratio:t.ratio}).comps},average:function(e,t){return s(e,t.specialId,t.centre.x,t.centre.y)},absolute:function(e,t){return s(e,t.specialId,t.absolute.x,t.absolute.y)}},m={grid:function(e,t,n,r){var i=2*n+24+r,a=0,o=0,u=Math.floor(Math.sqrt(e.length)),s=Math.ceil(e.length/u),c={};for(d=0;u>d;d++){for(h=0;s>h;h++){var f=s*d+h;e[f]&&(c[e[f]]={x:a,y:o}),a+=i}a=0,o+=i}return c},circle:function(e,t,n,r){var i=1.25-(r-5)/50;return G(t,e,n,i).positions},radial:function(e,t,n,r){var i=1.25-(r-5)/50;return j(t,e,n,i).positions}},y="#arranged#";a=Z.defaults(a,{tightness:5,position:"average",x:0,y:0}),t.trigger("prechange","arrange");var p=r.v,x=l(a.tightness),w=g[a.position]||g.average,b=m[e]||m.grid,k={x:Number(a.x)||0,y:Number(a.y)||0},T={x:0,y:0};if(n=Z.ensureArray(n),n=u(p,n),!n.length)return o();for(v=0,d=0;d<n.length;d++)v+=p[n[d]].size,T.x+=p[n[d]].x,T.y+=p[n[d]].y;v/=n.length,T.x/=n.length,T.y/=n.length;var S=b(n,p,v,x),C={};for(var I in S)I+="",p[I].x=S[I].x,p[I].y=S[I].y,C[I]=p[I],C[I].arranged=1;var L=i(p,r.e),O=c(L,C,T,k),D=O.packed,P=O.original,A={};for(d=0;d<D.length;d++)A[D[d].id]=D[d];f(p,P,A);var z=[],N=r.extents;M(t,p,N,z,a,!1,o)};var J=function(e,t){function n(){return 2*Math.random()-1+(2*Math.random()-1)+(2*Math.random()-1)}function r(e,t,n){return(t-e)*n+e}function i(e,t,n){return(e-n)/(t-n)}function a(e){var n=function(){for(var t=0,n=-1/0,r=0;r<e.length;r++)t+=e[r].width*e[r].height,n=Math.max(n,e[r].width);return{area:t,maxWidth:n}},r=1.1,i=1.03,a=10,o=n(),u=Math.sqrt(o.area*r/t.ratio)*i,s=u*t.ratio;return s<o.maxWidth+a&&(s=o.maxWidth+a),{x:0,y:0,width:s,height:u}}function o(e,t,n,a,o,u){var s=i(t,n,a);return s=Math.pow(s,e),r(u,o,s)}function u(e,t){if(!t)return!1;var n=e.x<g.x+g.width,r=e.x+e.width>g.x,i=e.y<g.y+g.height,a=e.y+e.height>g.y;return n||r&&i||a}function s(e,t){function n(e,t){var n=e.y<t.y+t.height,r=e.y+e.height>t.y;return n&&r}function r(e,t){var n=e.x<t.x+t.width,r=e.x+e.width>t.x;return n&&r}if(t.length<1)return!1;var i,a;for(i=0;i<t.length;i++)if(a=t[i],r(e,a)&&n(e,a))return!0;return!1}function c(e,t){return e.fixed&&!t.fixed?-1:t.fixed&&!e.fixed?1:0}var f={spiral:function(e){var t=o(.6,e,100,0,p,1),n=o(1,e,600,0,.3,.5),r=n*e,i=Math.cos(r)*t,a=Math.sin(r)*t;return{x:i,y:a}},controlled:function(e,t){for(var n;!u(t,n);)n=f.random(e);return n},rect:function(e){return et(e,t)},random:function(e){var t=.5*e;return{x:n()*t,y:n()*t}}};t=Z.defaults(t,{strategy:"rect",ratio:4/3});var l,d,h,v=0,g=a(e),m=[],y=f[t.strategy]||f.rect,p=0;for(l=0;l<e.length;l++)d=e[l],p+=d.width;if(p/=2*e.length,"rect"===t.strategy)return y(e);for(e.sort(c),l=0;l<e.length;l++){for(d=e[l],d.x=d.fixed?d.x:0,d.y=d.fixed?d.y:0;s(d,m)&&!d.fixed;)h=y(v,d),d.x=h.x,d.y=h.y,v++;m.push(d)}return{comps:m,stats:{cellsGenerated:v,addAttempts:v}}},et=Q.pack=function(e,t){function n(){for(var t=0,n=0;n<e.length;n++)t+=e[n].width*e[n].height;return t}function r(e,t){var n=fixedFirst(e,t);return n?n:t.height-e.height}function i(e){for(var t=0,n=0;n<e.length;n++)t<e[n].width&&(t=e[n].width);return t}function a(e){for(var n=Z.clone(e),r=0;r<n.length;r++){var i=n[r].width%t.step,a=n[r].height%t.step;0!==i&&(n[r].width=n[r].width+(t.step-i)),0!==a&&(n[r].height=n[r].height+(t.step-a))}return n}function o(e){return d?e.ratio()>=t.ratio-.2&&e.ratio()<=t.ratio:!0}function u(e){for(var n=l(t.tightness),r=0;r<e.length;r++)e[r].width+=n,e[r].height+=n
}function s(e){var n=1.1,r=1.03,i=10,a=Math.sqrt(e.area()*n/t.ratio)*r,o=a*t.ratio;return o<e.maxWidth+i&&(o=e.maxWidth+i),{width:o,height:a,lowestFreeHeightDeficit:0,ratio:function(){return g.width/g.height}}}t=Z.defaults(t,{ratio:4/3,max:10,sort:!0,step:10,tightness:5}),t.sort&&e.sort(r),u(e);var c,f=a(e),d=!0,h={candidatesFailure:0,candidatesOk:0,addAttempts:0,cellsGenerated:0,candidatesAccepted:0,totalTime:0};if(0===e.length)return c=q(),c.stats=h,c;for(var v={area:n,maxWidth:i(f),maxHeight:f[0].height},g=s(v,f);g.width>=v.maxWidth;){var m=W(f,g,h);if(0===m.comps.length)h.candidatesFailure++,g.width*=1.03,g.height*=1.03;else{if(h.candidatesOk++,(!c||o(m))&&(h.candidatesAccepted++,c=m,c.efficiency=v.area()/m.area(),o(m)))break;if(h.candidatesOk>=t.max)break}}return c.stats=h,c},tt=16e6;return Q}}(),!function(){var e=KeyLines.TimeBar.API=KeyLines.TimeBar.API||{};e.createAPI=function(){var e=KeyLines.Common,t=KeyLines.Util,n={},r=KeyLines.Events.createEventBus(),i=KeyLines.TimeBar.Config.create(),a=KeyLines.TimeBar.Model.createModel(r,i),o=KeyLines.TimeBar.Generator.create(),u=KeyLines.TimeBar.Controller.createController(r,a,o,i);n.clear=function(){return a.load({items:[]})},n.getIds=function(e,t){return a.getIds(e,t)},n.load=function(e,t){return a.load(e,t)},n.options=function(e,t){return u.options(e,t)},n.pan=function(e,t,n){return u.pan(e,t,n)},n.pause=function(){return u.pause()},n.play=function(){return u.play()},n.range=function(e,t,n,r){return 0!==arguments.length?u.range(e,t,n,r):u.range()},n.merge=function(e,t){return a.merge(e,t)},n.selection=function(e){return a.selection(e)},n.zoom=function(e,n,r){return e=e||"in",n=t.defaults(n,{animate:!0,time:200,pad:0}),u.zoom(e,n,r)},n.privateInit=u.privateInit,n.privateSetSize=u.privateSetSize,n.getIdcounts=a.getIdcounts,n.privateAPIDefinitions=function(){return{getIdcounts:!0}},e.appendActions(n,u),t.merge(n,r);var s=KeyLines.Common.frameManager(u.draw,u.animate);return t.merge(n,s),n.bind("redraw",s.redraw),n.getItems=a.getItems,n}}(),!function(){var e=KeyLines.Draggers={};e.createDraggers=function(e){var t,n=KeyLines.Util,r={};return r.setOptions=function(e){t=e.fanLength},r.primitiveMover=function(t,r,i,a,o,u,s,c,f,l){function d(e,t){return{dx:e-c,dy:t-f}}function h(e,t,r,i){var a,o={};if(s.length>0){o.x1=o.x2=o.y1=o.y2=0;for(var u=0;u<s.length;u++){a=s[u];var c="x"===a.charAt(0)?e:t;o[a]=c}r&&(0!==o.x1&&(o.x2=-o.x1),0!==o.x2&&(o.x1=-o.x2),0!==o.y1&&(o.y2=-o.y1),0!==o.y2&&(o.y1=-o.y2))}else i&&(e=Math.abs(e)>Math.abs(t)?e:0,t=0!==e?0:t),o.x1=o.x2=e,o.y1=o.y2=t;for(var f={},l=["x1","y1","x2","y2"],d=0;d<l.length;d++)a=l[d],f[a]=g[a]+o[a];if(i){var h=g.x2-g.x1,v=g.y2-g.y1;if(Math.abs(h)>0&&Math.abs(v)>0){var m,y=v/h,p=f.x2-f.x1,x=f.y2-f.y1,w=Math.abs(e)>Math.abs(t);if(w){var M=Math.floor(y*(h+p)-v)-x;r||!n.contains(s,"y1")&&!n.contains(s,"y2")?(m=Math.floor(M/2),f.y1-=m,f.y2+=m):(n.contains(s,"y1")&&(f.y1-=M),n.contains(s,"y2")&&(f.y2+=M))}else{var b=Math.floor((v+x)/y-h)-p;r||!n.contains(s,"x1")&&!n.contains(s,"x2")?(m=Math.floor(b/2),f.x1-=m,f.x2+=m):(n.contains(s,"x1")&&(f.x1-=b),n.contains(s,"x2")&&(f.x2+=b))}}}return f}function v(e,t,n,r){var i=d(e,t);return h(i.dx,i.dy,n,r)}if(!e.trigger("dragstart","resize",a,i.unscale(c),i.unscale(f),null)){var g=t.extents(r,o),m={};for(var y in o)m[y]=o[y];t.setAlpha(m,.5);var p={scrollable:!0,getCursor:function(){return u?"crosshair":"move"},generate:function(e){e.copyPrimitive(m)},dragMove:function(e,n,i,a){var o=v(e,n,i,a);t.setExtents(m,o.x1,o.y1,o.x2,o.y2,r)},endDrag:function(n,u,s,c,f){i.cancelScroll();var d=e.trigger("dragend","resize",a,i.unscale(u),i.unscale(s));if(!d&&n){var h=v(u,s,c,f);t.setExtents(o,h.x1,h.y1,h.x2,h.y2,r),l(o)}e.trigger("dragcomplete","resize",a,i.unscale(u),i.unscale(s))}};return p}},r.createHandDragger=function(t,r,i,a){function o(e,t){h=h||Math.abs(r-e)>10||Math.abs(i-t)>10,l=e-r,d=t-i,s&&(s.x||(l=0),s.y||(d=0))}function u(){h&&(t.offsetX(c+l),t.offsetY(f+d),e.trigger("viewchange"))}var s={x:!0,y:!0},c=t.offsetX(),f=t.offsetY(),l=0,d=0,h=!1,v="hand",g=e.trigger("dragstart",v,null,t.unscale(r),t.unscale(i));if(g){if(!n.isNormalObject(g))return;for(var m in g)s[m]=g[m]}return{animate:u,direction:s,dragMove:o,getCursor:function(){return"move"},endDrag:function(n,r,i){var s=e.trigger("dragend",v,null,t.unscale(r),t.unscale(i));h?(!s&&n?o(r,i):l=d=0,u()):a(),e.trigger("dragcomplete",v,null,t.unscale(r),t.unscale(i))}}},r.createDefaultDragger=function(t,r,i,a,o,u,s,c){function f(e){return v.add&&v.add[e]}function l(){for(var e in t)(i(e)||f(e))&&M[e]&&(t[e].x=M[e].x+I.dx,t[e].y=M[e].y+I.dy);for(var n in k)(i(n)||f(n))&&r[n]&&(r[n].y=k[n].y+I.dy)}function d(){for(var e in t)M[e]&&(t[e].x=M[e].x,t[e].y=M[e].y);for(var n in k)r[n]&&(r[n].y=k[n].y)}function h(e,t){return L=L||Math.abs(s-e)>10||Math.abs(c-t)>10,e=o?o.newToOldX(e):e,t=o?o.newToOldY(t):t,v&&(v.x||(e=x),v.y||(t=w)),{dx:L?e-x:0,dy:L?t-w:0}}var v={x:!0,y:!0,add:null},g=n.rawId(u),m="move",y=e.trigger("dragstart",m,g,o.unscale(s),o.unscale(c),n.subId(u));if(y)if(n.isArray(y))v.add=n.makeIdMap(y);else{if(!n.isNormalObject(y))return;for(var p in y)v[p]=y[p];n.isArray(v.add)&&(v.add=n.makeIdMap(v.add))}var x=o?o.newToOldX(s):s,w=o?o.newToOldY(c):c,M={};for(var b in t)M[b]={x:t[b].x,y:t[b].y};var k={};for(var T in r)"h"===r[T].st&&(k[T]={y:r[T].y||0});var S,C,I=h(s,c),L=!1,O={scrollable:!0,direction:v,animate:l,excludeHit:function(){var e={};return null!==g&&(e[g]=1),e},getCursor:function(){return"move"},dragMove:function(e,t){I=h(e,t)},mouseMoved:function(e){return e&&(S=!0),S},afterDraw:function(t,r,i){S=!1;var a=n.rawId(t);g!==a&&("undefined"==typeof C?C=a:a!==C&&(e.trigger("dragover",a,o.unscale(r),o.unscale(i),n.subId(t)),C=a))},endDrag:function(t,r,i){o.cancelScroll();var a=e.trigger("dragend",m,n.rawId(u),o.unscale(r),o.unscale(i));a?d():t&&L?(d(),I=h(r,i),e.trigger("prechange","move"),l()):d(),e.trigger("dragcomplete",m,n.rawId(u),o.unscale(r),o.unscale(i))}};return O},r.createLinkEndDragger=function(t,r,i,a,o,u,s,c,f){function l(e,t){a[o[u]].x=e,a[o[u]].y=t}function d(e,t){return e=i?i.newToOldX(e):e,t=i?i.newToOldY(t):t,{dx:e-v,dy:t-g}}function h(){return o["id1"===u?"id2":"id1"]}if(e.trigger("dragstart","dummy",f,i.unscale(s),i.unscale(c),null))return!1;var v=i?i.newToOldX(s):s,g=i?i.newToOldY(c):c,m=a[o[u]].x,y=a[o[u]].y,p=d(s,c),x=s,w=c,M=null,b={scrollable:!0,animate:function(){l(m+p.dx,y+p.dy)},getCursor:function(){return"move"},dragMove:function(e,n){p=d(e,n),x=e,w=n,M=t.hittest(e,n)},endDrag:function(t,s,c){i.cancelScroll();var f=e.trigger("dragend","dummy",M,i.unscale(s),i.unscale(c));if(!f)if(t)if(l(m,y),e.trigger("prechange","move"),M=n.rawId(M),a[M]&&M!==h()){delete a[o[u]],o[u]=M;var v={};v[o.id]=o,r.resetConnectionOffsets(v)}else p=d(s,c),l(m+p.dx,y+p.dy),M=null;else l(m,y);e.trigger("dragcomplete","dummy",M,i.unscale(s),i.unscale(c))}};return b},r.createLinkDragger=function(t,r,i,a,o,u,s){function c(e,t,n,r,i,a){return((n-e)*(t-a)-(e-i)*(r-t))/Math.sqrt((n-e)*(n-e)+(r-t)*(r-t))}function f(e,n){var r=i.newToOldX(e),o=i.newToOldY(n),u=t("x1",a),s=t("y1",a),f=t("x2",a),l=t("y2",a),g=c(u,s,f,l,r,o);v&&Math.abs(g-d)>8&&(v=!1),v||(Math.abs(g)<12&&(g=0),h=g)}function l(){a.off=h}if(e.trigger("dragstart","offset",s,i.unscale(o),i.unscale(u),n.subId(s)))return!1;var d=a.off?a.off:0,h=d;i.newToOldY(u),a.y,a.y;var v=!0,g=!1,m={scrollable:!0,animate:function(){l()},getCursor:function(){return"move"},dragMove:function(e,t){f(e,t),g=!0},endDrag:function(t,n,r){i.cancelScroll();var o=e.trigger("dragend","offset",s,i.unscale(n),i.unscale(r));o||(t&&g?(a.off=d,e.trigger("prechange","offset"),f(n,r),l()):a.off=d),e.trigger("dragcomplete","offset",s,i.unscale(n),i.unscale(r))}};return m},r}}(),!function(){function e(e){return e.lastIndexOf(s())}var t=KeyLines.Util={};t.pick=function(e){var n=Array.prototype.slice.call(arguments,1),r={};if(t.isNormalObject(e))for(var i in e)-1!==n.indexOf(i)&&(r[i]=e[i]);return r};var n=t.clone=function(e,r){function a(e,t){r&&"_"===t.charAt(0)||(o[t]=n(e,r))}if(null===e)return null;var o;switch(typeof e){case"object":if(i(e)){for(var u=[],s=0;s<e.length;s++)u.push(n(e[s],r));return u}return e instanceof Date?new Date(e.getTime()):(o={},t.iterator(e,a),o);case"boolean":case"string":case"number":return e}};t.isNumber=function(e){return isFinite(e)&&"number"==typeof e&&!isNaN(e)};var r=t.isFunction=function(e){if(e){var t={}.toString.call(e);return"[object Funct"===t.slice(0,13)}return!1};t.isNormalObject=function(e){return!("object"!=typeof e||e instanceof Date||i(e)||u(e))};var i=t.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)};t.invoke=function(e,t){e&&r(e)&&e(t)};var a=t.ensureArray=function(e){return i(e)?e:[e]},o=!0;t.timerFn=function(e,t,n){return function(){if(o){var r=(new Date).getTime(),i=e.apply(n||this,arguments),a=(new Date).getTime();return console.log("fn "+t+" = "+(a-r)+"ms"),i}return e.apply(n||this,arguments)}},t.defaults=function(e,t){var r=n(e)||{};for(var i in t)(!r.hasOwnProperty(i)||u(r[i]))&&(r[i]=t[i]);return r},t.defined=function(e){return"undefined"!=typeof e};var u=t.isNullOrUndefined=function(e){return null===e?!0:t.defined(e)?!1:!0};t.flattenMap=function(e){var t=[];for(var n in e)t.push(n+"");return t};var s=t.idSep=function(){return"\u2704"},c=t.rawId=function(t){if(u(t))return null;var n=t+"",r=e(n);return-1!==r&&(n=n.substring(0,r)),n};t.subId=function(t){if(u(t))return null;var n=t+"",r=e(n);return-1!==r?n.substring(r+1):null},t.dictToArray=function(e){var t=[];for(var n in e)t.push({id:n,val:e[n]});return t},t.arrayToDict=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].id+""]=e[n].val;return t},t.makeIdMap=function(e){var t={};e=a(e);for(var n=0;n<e.length;n++)t[c(e[n])]=1;return t},t.contains=function(e,t){return-1!==f(e,t)};var f=t.indexOf=function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1};t.merge=function(e,t){if(e){for(var n in t)e[n]=t[n];return e}return t},t.len=function(e,t){return Math.max(1e-4,Math.sqrt(e*e+t*t))},t.numberSort=function(e,t){var n,r,i,a=[];if(t)for(a=e,e=[],n=0;n<a.length;n++)e.push(a[n][t]);for(var o,u,s,c,f=0,l=e.length-1,d=-1,h=[],v=7;;)if(v>=l-f){for(r=f+1;l>=r;r++){for(o=e[r],s=a[r],n=r-1;n>=f&&e[n]>o;)e[n+1]=e[n],a[n+1]=a[n],n--;e[n+1]=o,a[n+1]=s}if(-1===d)break;l=h[d--],f=h[d--]}else{for(i=f+l>>1,n=f+1,r=l,o=e[i],s=a[i],e[i]=e[n],a[i]=a[n],e[n]=o,a[n]=s,e[f]>e[l]&&(o=e[f],s=a[f],e[f]=e[l],a[f]=a[l],e[l]=o,a[l]=s),e[n]>e[l]&&(o=e[n],s=a[n],e[n]=e[l],a[n]=a[l],e[l]=o,a[l]=s),e[f]>e[n]&&(o=e[f],s=a[f],e[f]=e[n],a[f]=a[n],e[n]=o,a[n]=s),u=e[n],c=a[n];;){do n++;while(e[n]<u);do r--;while(e[r]>u);if(n>r)break;o=e[n],s=a[n],e[n]=e[r],a[n]=a[r],e[r]=o,a[r]=s}e[f+1]=e[r],a[f+1]=a[r],e[r]=u,a[r]=c,l-n+1>=r-f?(h[++d]=n,h[++d]=l,l=r-1):(h[++d]=f,h[++d]=r-1,f=n)}},t.iterator=function(e,t){if(!u(e)&&r(t)){var n;if(i(e))for(n=0;n<e.length;n++)t(e[n],n);else for(n in e)t(e[n],n)}},t.filter=function(e,t){for(var n=[],r=0;r<e.length;r++){var i=e[r];t(i)&&n.push(i)}return n},t.ratelimit=function(e,t){var n,r,i,a;return function(){function o(){r=(new Date).getTime(),e.apply(i,a)}var u=(new Date).getTime();if(i=this,a=arguments,!n)if(!r||u-r>=t)o();else{var s=u-r,c=t-s;n=setTimeout(function(){n=null,o()},c)}}}}(),!function(){var e=KeyLines.TimeBar.Generator={};e.create=function(){var e={},t=KeyLines.Rendering,n=KeyLines.Util,r=n.idSep(),i=[-25,69,44,-1,28,78,-20,-6,-89,-52,71,20,31,40,65,16,61,79,-11,-89,-89],a=window["D"+9884..toString(30)][25871..toString(33)]()/31631;return e.generate=function(e,n,o,u,s,c,f){function l(){var e;if(-1!==c.x&&(e=n.findRange(c.x,c.y)),e&&"histogram"!==e.bar){var t=Math.max(n.ttox(e.t1),M.x1),r=Math.min(n.ttox(e.t2),M.x2),i="minor"===e.bar?2:1;r>t&&u.rect(t,M.bars[e.bar].y1-i,r,M.bars[e.bar].y2+1,null,-1,s.options.scale.highlightColour,!0,null)}}function d(e){var r=M.bars[e].y2,i=s.bars[e].fontsize,a="minor"===e?8:10;("minor"===e&&!s.options.scale.showMinor||"major"===e&&!s.options.scale.showMajor)&&(a=0);var c="minor"===e?M.bars[e].y1:M.bars[e].y2-a;n.eachTick(e,function(n,f,l,d,h){l>=M.x1&&l<=M.x2&&u.line(l,c,l,c+a,"#ddd",2,null);var v=s.displayTime(n,h),g=t.measureText(o,v,i,!1).width,m=Math.floor((d+l)/2-g/2);u.text(m,r-s.bars[e].textbase,v,s.options.fontColour,i,!1,null)})}function h(e,t){for(var n="",r=0;r<t.length;r++)n+=String.fromCharCode(t[r]+e.charCodeAt(r));return n}function v(){if(f){var t=f.match(e.selectionRegExp());if(t)return+t[1]}return null}function g(e,n,r){var i=36;u.layer(t.layers.OVERLAYS);var a=t.measureText(o,e,i).width,s=(M.width-a)/2,c=(M.height+i)/2;u.text(s+2,c+2,e,r,i,!0),u.text(s,c,e,n,i,!0)}function m(t,n){if(t.hasSel[n])for(var i=e.animateSelHeight(t.maxselvalue)||1,a=t.selvalues[n],o="_tbLine"+n,c=s.selection["colour"+n],l=(t.x[1]-t.x[0])/2,d=0;d<t.count;d++){var h=a[d],v=a[d+1],g=t.x[d]+l,m=t.x[d+1]+l,y=M.histogram.maxselh,p=M.histogram.ybase,x=Math.floor(y*h/i),w=p-x,b=Math.floor(y*v/i),k=p-b;u.line(g,w,m,k,c,2,o);var T=o+r+d,S=f===T?c:s.options.backColour;u.circle(g,w,s.selection.dotsize,c,2,S,!0,T)}}function y(){for(var r=n.getHistogram(),i=M.histogram.ybase,a=M.histogram.maxbarh,o=e.animateBarHeight(r.maxvalue)||1,f=s.histogram.bardx,l=0;l<r.count;l++){var d=r.x[l]+f,h=r.x[l+1]-f,g=r.value[l];if(g>0){var y=Math.min(a,Math.floor(a*g/o)),p=i-y,x=c.x>=d&&c.x<=h&&c.y>=p&&c.y<=i,w=x?s.options.histogram.highlightColour:s.options.histogram.colour;u.rect(d,p,h,i,t.colours.white,-1,w,!0,"_tbBar")}}for(var b=v(),k=0;k<s.selection.maxNumber;k++)k!==b&&m(r,k);null!==b&&m(r,b)}function p(){var e=n.getInnerRange(),t=n.ttox(e.t1),r=n.ttox(e.t2);u.line(t,0,t,M.y2,s.options.sliderLineColour,2,null),u.line(r,0,r,M.y2,s.options.sliderLineColour,2,null),u.rect(M.x1,0,t,M.y2,s.options.sliderLineColour,-1,s.options.sliderColour,!0,null),u.rect(r,0,M.width,M.y2,s.options.sliderLineColour,-1,s.options.sliderColour,!0,null);for(var i=(M.y2-s.grip.length)/2,a=i+s.grip.length,o=t,c=r,f=0;f<s.grip.lines;f++)o-=s.grip.space,c+=s.grip.space,u.line(o,i,o,a,s.options.sliderLineColour,2,"_tbLeft"),u.line(c,i,c,a,s.options.sliderLineColour,2,"_tbRight")}function x(){var t=s.controlbar.height,n=M.height-t,r="rgba(255,255,255,0.7)";u.rect(0,n,M.width,M.height,s.controlbar.colour,-1,s.controlbar.colour,!0),u.line(0,n-.5,M.width,n-.5,"#ccc",1);var i,a,o,c,l=["fit","zoomout","zoomin",40,"prev",e.isPlaying()?"pause":"play","next"],d=0,h=e.imageList(),v=e.imageNames();for(i=0;i<l.length;i++)a=l[i],"number"==typeof a?d+=a:(c=v[a],d+=h[c].im.width,i>0&&(d+=s.controlbar.space));var g=(M.width-d)/2;for(i=0;i<l.length;i++)if(a=l[i],"number"==typeof a)g+=a;else{c=v[a],o=h[c].im;var m=n+(t-o.height)/2,y="_tb"+a;if(f===y){var p=g+o.width/2,x=m+o.height/2;u.circle(p,x,o.width/2-2,r,0,r,!0,y)}u.image(g,m,g+o.width,m+o.height,c,y),g+=o.width+s.controlbar.space}}function w(){a>45384856||(u.rect(M.x1,0,M.x2,M.y1,t.colours.midgrey,-1,s.options.backColour,!0,"_tbHisto"),u.rect(M.x1,M.y1,M.x2,M.y2,t.colours.midgrey,-1,s.options.backColour,!0,"_tbMain"),(s.options.scale.showMajor||s.options.scale.showMinor)&&l(),s.options.scale.showMajor&&d("major"),s.options.scale.showMinor&&d("minor"),n.hasItems()&&y(),"none"!==s.options.sliders&&p(),s.options.showControlBar&&x(),g(h(k,i),h(k,T),h(k,b)),KeyLines.TimeBar.t&&g(h(k,i),h(k,T),h(k,b)))}var M=n.getBounds(),b=[14,71,21,-37,-27,21,-69,-77,-71,-68,4,-33,-27,-24,18,-59],k="d MMM yyyy/MMM d, yyyy",T=[14,71,21,-37,-27,16,-69,-77,-71,-70,10,-33,-27,-24,18,-59];M.x2>M.x1&&w()},e}}(),!function(){var e=KeyLines.Generator={};e.create=function(e){function t(){return ut||mt.colours.white}function n(e){return Math.abs(e)<1e-5}function r(e,t,n,r,i,a){return{x:((i-n)*Math.cos(t)-(a-r)*Math.sin(t))/e,y:((i-n)*Math.sin(t)+(a-r)*Math.cos(t))/e}}function i(e){return e.hasOwnProperty("t")&&e.t}function a(e){var t=St(e);return e.bg?t?mt.layers.BGSHAPES:mt.layers.BGNODES:t?mt.layers.SHAPES:mt.layers.NODES}function o(e){return e.bg?mt.layers.BGLINKS:mt.layers.LINKS}function u(e,t,i,a,o,u,s,c,f){var l=r(t,-i,a,o,u,s),d=r(t,-i,a,o,c,f);e/=t;var h=e/2;if(l.y>h&&d.y>h||l.y<-h&&d.y<-h)return 0/0;if(n(d.y-l.y))return Math.max(l.x,d.x);var v,g=l.y>d.y?l:d,m=l.y>d.y?d:l;v=h<g.y?g.x-(g.y-h)*(g.x-m.x)/(g.y-m.y):g.x;var y;return y=m.y<-h?m.x-(m.y- -h)*(m.x-g.x)/(m.y-g.y):m.x,Math.max(v,y)}function s(e,t,n,r,i,a){for(var o=-1/0,s=0;s<a.length;s+=2){var c=(s+2)%a.length,f=u(e,t,n,r,i,a[s],a[s+1],a[c],a[c+1]);isNaN(f)||(o=Math.max(o,f))}return o}function c(e,t,n,r,i,a){return s(e,t,n,r,i,[a.x1,a.y1,a.x2,a.y1,a.x2,a.y2,a.x1,a.y2])}function f(e,t,n,r,i,a){for(var o,u=-1/0,f=0;f<a.length;f++)o=a[f].length?s(e,t,n,r,i,a[f]):c(e,t,n,r,i,a[f]),u=Math.max(u,o);return u}function l(e,t,n,r,i,a){var o=0;return r._c&&(o=r._c/t),r._cl&&(o=Math.max(o,f(e,t,n,i,a,r._cl))),o}function d(e,t,r,i,a,o,u,s,c,f,d,h){var v={},g=Math.sqrt((r-e)*(r-e)+(i-t)*(i-t));if(n(g))v.skip=!0;else{var m=Math.atan2(i-t,r-e),y=l(at&&c?0:o,g,m,u,e,t),p=l(at&&f?0:o,g,m+Math.PI,s,r,i);d=d||0,h=h||0,y=Math.max(d,y),p=Math.max(h,p);var x=1-(y+p),w=0;if(c||f){var M=L(o,a)*Math.cos(Lt);w=M/g,c&&f&&(w=1.5*w)}v.skip=x<Math.max(.1,w),v.skip||(v.cx1=e+y*(r-e),v.cy1=t+y*(i-t),v.cx2=r+p*(e-r),v.cy2=i+p*(t-i))}return v}function h(e,t,n,r,i,a,o){var u=[],s=a-r,c=o-i,f=r-e,l=i-t,d=s*s+c*c,h=2*(s*f+c*l),v=f*f+l*l-n*n,g=h*h-4*d*v;if(g>=0){var m=Math.sqrt(g),y=(-h-m)/(2*d),p=(-h+m)/(2*d);if(y>=0&&1>=y){var x=r+y*s,w=i+y*c;u.push(Math.atan2(w-t,x-e))}if(p!==y&&p>=0&&1>=p){var M=r+p*s,b=i+p*c;u.push(Math.atan2(b-t,M-e))}}return u}function v(e,t,n,r,i,a){var o=r-t;if(Math.abs(o)>n)return[];var u=Math.max(i,a),s=Math.min(i,a);if(e-n>u||s>e+n)return[];var c=Math.asin(o/n),f=n*Math.cos(c),l=[];return e-f>=s&&u>=e-f&&l.push(o>0?Math.PI-c:-Math.PI-c),e+f>=s&&u>=e+f&&l.push(c),l}function g(e,t,n,r,i,a){var o=r-e;if(Math.abs(o)>n)return[];var u=Math.max(i,a),s=Math.min(i,a);if(t-n>u||s>t+n)return[];var c=Math.acos(o/n),f=n*Math.sin(c),l=[];return t-f>=s&&u>=t-f&&l.push(-c),t+f>=s&&u>=t+f&&l.push(c),l}function m(e,t,n,r,i,a,o){var u=Math.PI,s=o?r:i;if(a._c&&(s+=(o?1:-1)*a._c/n),a._cl&&a._cl.length>0)for(var c=0;c<a._cl.length;c++){var f,l,d=a._cl[c];if(d.length)for(l=[],f=0;f<d.length;f+=2){var m=(f+2)%d.length,y=h(e,t,n,d[f],d[f+1],d[m],d[m+1]);l=l.concat(y)}else{var p=v(e,t,n,d.y2,d.x1,d.x2),x=v(e,t,n,d.y1,d.x1,d.x2),w=g(e,t,n,d.x1,d.y1,d.y2),M=g(e,t,n,d.x2,d.y1,d.y2);l=p.concat(x,M,w)}for(f=0;f<l.length;f++)l[f]+2*Math.PI<i&&(l[f]+=2*Math.PI),r<l[f]&&l[f]<i&&(o?l[f]-s<u&&(s=Math.max(s,l[f])):s-l[f]<u&&(s=Math.min(s,l[f])))}return s}function y(e,t,n,r,i,a,o,u){var s=m(t,n,r,i,a,e>0?o:u,!0),c=m(t,n,r,s,a,e>0?u:o,!1);return{startangle:s,endangle:c}}function p(e,t){var n=t(e.id),r=St(e),i=_("b",e,n),a=_("c",e,n);return!(!i&&!a||r)}function x(e){return e>Math.PI||e<-Math.PI?e-2*Math.PI*Math.floor((e+Math.PI)/2*Math.PI):e}function w(e,t,n,r,i,a,o,u,s,c,f,l,d){function h(e,t){P++,1===P?(L=e,O=t):2===P&&(E=e,D=t)}function v(e){var t=n+i*Math.cos(e),a=r+i*Math.sin(e);t>T&&S>t&&a>C&&I>a&&h(t,a)}function g(e,t){var n=e*e;if(n===A)t(i);else if(A>n){var r=Math.sqrt(A-n);t(r),t(-r)}}function m(e){g(e-n,function(t){var n=r+t;n>=C&&I>=n&&p(e,r+t)})}function y(e){g(e-r,function(t){var r=n+t;r>=T&&S>=r&&p(n+t,e)})}function p(e,t){var i,u=e-n,s=t-r,c=Math.atan2(s,u);i=o>a?c>a&&o>c:c>a||o>c,(i!==d||c===a||c===o)&&h(e,t)}if(1e6>=i)return t.arc(n,r,i,a,o,u,s,c,f,l,d),void 0;var w=e.width(),M=e.height(),b=Math.floor(w/2),k=Math.floor(M/2),T=-b,S=w+b,C=-k,I=M+k;a=x(a),o=x(o);var L,O,E,D,P=0;v(a),v(o);var A=i*i;m(T),m(S),y(C),y(I),2===P&&t.line(Math.floor(L),Math.floor(O),Math.floor(E),Math.floor(D),u,s,c,f,l)}function M(e,t,n,r,i,a,o,u,s,c,f,l,d,h,v,g,m,x){var M=Math.floor((f+d)/2),b=Math.floor((l+h)/2),k=d-f,T=h-l,S=e.dim2(o);0===S&&(S=o>=0?1:-1);var C=Math.max(.001,T*T+k*k),I=Math.sqrt(C),L=(C/4+S*S)/(2*Math.abs(S)),E=L-Math.abs(S),D=Number(S)>0?1:-1,P=M-T*D*E/I,A=b+k*D*E/I,z=Math.atan2(l-A,f-P),N=Math.atan2(h-A,d-P),B=S>0?z:N,U=S>0?N:z;B>U&&(U+=2*Math.PI),i=i||0,a=a||0;var K=B+(S>0?i:a)*(U-B),F=B+(S>0?1-a:1-i)*(U-B),_=y(S,P,A,L,B,U,s,c);if(_.startangle=Math.max(K,_.startangle),_.endangle=Math.min(F,_.endangle),!(_.startangle>=_.endangle)){var H=(_.startangle+_.endangle)/2,j={};j.lx=P+L*Math.cos(H),j.ly=A+L*Math.sin(H);var Y,G,W,q,X,V,Z=1.5*g/L,$=-.25;if(n?(Y=S>0?_.startangle:_.endangle,G=P+L*Math.cos(Y),W=A+L*Math.sin(Y),S>0?_.startangle+=Z:_.endangle-=Z):at&&p(s,x)&&(S>0?_.startangle+=$*Z:_.endangle-=$*Z),r?(q=S>0?_.endangle:_.startangle,X=P+L*Math.cos(q),V=A+L*Math.sin(q),S>0?_.endangle-=Z:_.startangle+=Z):at&&p(c,x)&&(S>0?_.endangle-=$*Z:_.startangle+=$*Z),_.startangle<_.endangle){var Q=bt&&m&&("dashed"===m||"dotted"===m),J=!1;if(Q){var et=(_.endangle-_.startangle)*L;if(R(m,g,"line",et),0>S){var tt=_.startangle;_.startangle=_.endangle,_.endangle=tt,J=!0}}w(e,t,Math.floor(P),Math.floor(A),L,_.startangle,_.endangle,v,g,u,ht,vt,J)}return n&&O(e,t,G,W,g,.66*+D*Z+Y-D*Math.PI/2,v,u+wt+"a1"),r&&O(e,t,X,V,g,.66*-D*Z+q+Math.PI-D*Math.PI/2,v,u+wt+"a2"),j}}function b(e,t,n,r){return Math.sqrt((n-e)*(n-e)+(r-t)*(r-t))}function k(e,t,n){var r,i=Pt,a=t.e||1;return r=n.x>t.x&&"e"===t.sh?t.x+a*i:n.x<t.x&&"w"===t.sh?t.x-a*i:t.x,e.x(r)}function T(e,t,n,r,i,a,o,u,s,c,f,d,h,v,g){var m,y,p=k(e,s,c),x=k(e,c,s),w=e.y(o||0),M=e.dim2(st);x>p?(m=p+M,y=x-M,m>y&&(m=y=(p+x)/2)):(m=p-M,y=x+M,y>m&&(m=y=(p+x)/2));var T=b(p,f,m,w),S=b(m,w,y,w),C=b(y,w,x,d),I=T+S+C,L=Math.atan2(w-f,m-p),E=Math.atan2(w-d,y-x),D=0===T?0:l(v,T,L,s,p,f),P=0===C?0:l(v,C,E,c,x,d);i=0===T?0:(i||0)*I/T,a=0===C?0:(a||0)*I/C,D=Math.min(1,Math.max(i,D)),P=Math.min(1,Math.max(a,P));var A,z,N,B,U,K,F,_,H=p+D*(m-p),j=f+D*(w-f),Y=x+P*(y-x),G=d+P*(w-d);n&&(U=H,K=j,A=m-H,z=w-j,N=Math.max(.001,z*z+A*A),B=Math.sqrt(N),H+=1.5*v*A/B,j+=1.5*v*z/B),r&&(F=Y,_=G,A=y-Y,z=w-G,N=Math.max(.001,z*z+A*A),B=Math.sqrt(N),Y+=1.5*v*A/B,G+=1.5*v*z/B);var W=bt&&g&&"solid"!==g;W&&R(g,v,"line",I),t.line3(Math.floor(H),Math.floor(j),Math.floor(m),Math.floor(w),Math.floor(y),Math.floor(w),Math.floor(Y),Math.floor(G),h,v,u,ht,vt),n&&O(e,t,U,K,v,L+Math.PI,h,u+wt+"a1"),r&&O(e,t,F,_,v,E+Math.PI,h,u+wt+"a2");var q={above:!0,lx:(m+y)/2,ly:(w+w)/2};return q}function S(e,t,n,r,i,a,o,u,s,c,f,l,h,v,g,m,y){var x=d(c,f,l,h,e,g,u,s,n,r,i,a);if(!x.skip){var w,M,b,k,T,S,C=x.cx1,I=x.cy1,L=x.cx2,E=x.cy2,D=L-C,P=E-I,A=Math.max(.001,P*P+D*D),z=Math.sqrt(A),N=.25;n?(w=Math.atan2(P,D),b=C,k=I,C+=1.5*g*D/z,I+=1.5*g*P/z):at&&p(u,y)&&(C-=N*g*D/z,I-=N*g*P/z),r?(M=Math.atan2(P,D),T=L,S=E,L-=1.5*g*D/z,E-=1.5*g*P/z):at&&p(s,y)&&(L+=N*g*D/z,E+=N*g*P/z);var B=bt&&m&&"solid"!==m;B&&R(m,g,"line",z),t.line(Math.floor(C),Math.floor(I),Math.floor(L),Math.floor(E),v,g,o,ht,vt),n&&O(e,t,b,k,g,w+Math.PI,v,o+wt+"a1"),r&&O(e,t,T,S,g,M,v,o+wt+"a2");var U={};return U.lx=(C+L)/2,U.ly=(I+E)/2,U}}function C(e,t,n,r){if(e){var i=e.getNext();i.x=t,i.y=n,i.id=r}}function I(e,n,r,a,o,u,s,c,f,l){function d(e){return g&&dt&&lt.hasOwnProperty(e)?lt[e]:a[e]}if(!a.hi){a._edit=null;var h,v,g=l(o),m=g&&!dt,y=d("b1"),p=d("b2"),x=d("c"),w=d("fb"),b=d("fbc"),k=d("fc"),I=d("ff"),L=d("fs"),O=d("ls"),A=d("w"),z=n.x(u.x),B=n.y(u.y),U=n.x(s.x),R=n.y(s.y),K=n.w(A?A:1),F=x?x:mt.colours.midgrey,_=0;ht=vt=void 0,v="h"===a.st?T(n,r,a.a1,a.a2,y,p,a.y,o,u,s,B,R,F,K,O):a.off?M(n,r,a.a1,a.a2,y,p,a.off,o,u,s,z,B,U,R,F,K,O,l):S(n,r,a.a1,a.a2,y,p,o,u,s,z,B,U,R,F,K,O,l);var H=v?v.lx:(z+U)/2,j=v?v.ly:(B+R)/2;if(a._x=n.newToOldX(H),a._y=n.newToOldY(j),v){var Y=v.lx,G=v.ly,W=Y,q=G,X=Tt(a);L=Number(L?L:pt);var V=n.dim(L),Z=!1,$=k?k:mt.colours.black,Q=b?b:mt.colours.textback;m&&($=t(),Q=kt());var et=D(a),nt=P(et,e,V,w,I),it=L+3,at=n.dim(it);_=it*et.length,et.length>0&&(W-=nt[0]/2);for(var ot=(et.length-1)*at,ut=v.above?G-(ot+at/2+K/2):G-Math.round(ot/2),st=0;st<et.length;st++){0===st&&(q=ut);var ct=N(e,n,r,et[st],Y,ut,V,o,!0,$,Q,w,a,!1,!0,99,nt[st],m,L,I||rt);Z=Z||ct,ut+=at}var ft=!i(a)||!Z;if(ft&&m&&!X&&r.circle(Y,G,Math.floor(V/2),mt.colours.white,-1,kt(),!0,o),X){var gt=n.dim(It);ft?W+=Math.floor((a.g.length-1)*gt/2):W-=n.dim(Ct);var yt=W;if(ft&&m){for(h=a.g.length-1;h>=0;h--)r.circle(W,q,Math.floor(.6*gt),mt.colours.white,-1,kt(),!0,o),W-=gt;W=yt}for(h=a.g.length-1;h>=0;h--)J(r,n,e,o+wt+h,W,q,1,a.g[h],f),W-=gt}a.bu&&tt(r,n,e,o,Y,G,_/2+4,1,a.bu,f),X||i(a)||C(c,Y,G,o)}else C(c,H,j,o);E(u,"id1",o,z,B,r,K,F),E(s,"id2",o,U,R,r,K,F)}}function L(e,t){return 1.7*e+t.dim("small"===nt?6:10)}function O(e,t,n,r,i,a,o,u){var s=L(i,e);t.triangle(n+s*Math.cos(a+Math.PI+Lt),r+s*Math.sin(a+Math.PI+Lt),n+s*Math.cos(a+Math.PI-Lt),r+s*Math.sin(a+Math.PI-Lt),n,r,o,-1,o,!0,u)}function E(e,t,n,r,i,a,o,u){e.du&&a.circle(r,i,Math.floor(1.5*o),u,o,mt.colours.white,!0,n+wt+t)}function D(e){return e.t?(e.t+"").split(/\r\n|\r|\n/):[""]}function P(e,t,n,r,i){for(var a=[],o=0;o<e.length;o++)a[o]=mt.measureText(t,e[o],n,r,i||rt).width;return a}function A(e){for(var t=0,n=0;n<e.length;n++)t=Math.max(t,e[n]);return t}function z(e,t,n,r,i,a,o,u,s,c,f,l,d,h,v,g,m,y,p){var x=mt.measureText(e,r,o,l,p).width;return N(e,t,n,r,i,a,o,u,s,c,f,l,d,h,v,g,x,m,y,p)}function N(e,t,n,r,i,a,o,u,s,c,f,l,d,h,v,g,m,y,p,x){var w=!0;0===r.length&&(w=!1);var M=u+wt+"t";if(h&&m>g&&o>3)return z(e,t,n,r,i,a,Math.floor(.85*o),u,s,c,f,l,d,h,v,g,y,p,x);var b,k=t.dim(4),T=Math.floor(i-Math.round(m/2));b=v?Math.floor(a+Math.round(1+o/2)):Math.floor(a+Math.round((1+o)/2));var S={x1:T-k,y1:b-o,x2:T+Math.floor(m)+k,y2:b};if(o>3){if(s&&w&&n.rect(S.x1,S.y1,S.x2,S.y2,f,-1,f,!0,M),d&&B(d,S,o,!w),w){var C=v?t.dim(Mt):0;n.text(T,b+C,r,c,Math.round(o),l,M,x)}}else{if(S.y1-=1,S.y2-=1,S.x1=T,S.x2=T+Math.floor(m),S.y1===S.y2&&S.y2++,0===o){var I=t.dim(.2*p*r.length),L=Math.floor((S.x2+S.x1)/2);S.x2=L+I,S.x1=L-I}if(d&&B(d,S,o),w)if(s&&y)n.rect(S.x1,S.y1,S.x2,S.y2,f,-1,f,!0,M);else{var O=U(c,.4);n.rect(S.x1,S.y1,S.x2,S.y2,O,-1,O,!0,M)}}return w}function B(e,t,n,r){e._edit?(e._edit.x1=Math.min(e._edit.x1,t.x1),e._edit.x2=Math.max(e._edit.x2,t.x2),e._edit.y1=Math.min(e._edit.y1,t.y1),e._edit.y2=Math.max(e._edit.y2,t.y2)):(e._edit=t,e._edit.fs=n),ot&&!r&&e._cl&&e._cl.push(t)}function U(e,t){var n=e+t;return Ot[n]||(Ot[n]=mt.alphaize(e,t)),Ot[n]}function R(e,t,n,r,i){var a,o,u=2,s=Math.min(r,i||1/0);u="circle"===n?2*s*Math.PI:r,"dashed"===e?(a=Math.max(2*t,2),o=a/2):"dotted"===e&&(a=Math.min(t,.5),o=(2+a/t)*t);var c=u-(a+o)*Math.floor(u/(a+o)),f=c/Math.floor(u/(a+o));"circle"===n?(o-=.25*f,o=Math.max(o,1)):o+=.5*f,ht=a,vt=o}function K(e,t,n,r,i,a,o,u,s,c,f,l){var d="dotted"===s?0:f/2;if("box"===t&&(R(s,f,"line",i-n),e(n-d,r,i+d,r,c,f,l,ht,vt),e(i+d,a,n-d,a,c,f,l,ht,vt)),R(s,f,"line",a-r),"e"!==t&&e(i,r-d,i,a+d,c,f,l,ht,vt),"w"!==t&&e(n,a+d,n,r-d,c,f,l,ht,vt),"box"!==t){R(s,f,"line",i-n+b(n,r,o,u));var h="e"===t?d:0,v="e"===t?0:-d,g="e"===t?i:n;e(n-d+v,r,i+d+h,r,c,f,l,ht,vt),e(i+d+h,a,n-d+v,a,c,f,l,ht,vt),e(g+h+v,r,o,u,c,f,l,ht,vt),e(g+h+v,a,o,u,c,f,l,ht,vt)}}function F(e,t){var n=e.layer(),r=mt.selMap[n];r&&e.layer(r),t(),r&&e.layer(n)}function _(e,t,n){return n&&ft&&ct.hasOwnProperty(e)?ct[e]:t[e]}function H(e,t){return t?Bt[e.sh]?e.sh:"box":e.sh in Bt?e.sh:e.sq?"box":"circle"}function j(e,t,n,r,i,a,o,u,s,c){o?R("dashed",a,"circle",r,r):ht=vt=void 0,e.circle(t,n,r,i,a,u,s,c,ht,vt)}function Y(e,t,n,r,i,a,o,u,s,c,f){u?(e.rect(t,n,r,i,mt.colours.white,-1,s,c,f),K(e.line,"box",t,n,r,i,null,null,"dashed",a,o,f)):e.rect(t,n,r,i,a,o,s,c,f)}function G(e,t,n,r,i,a,o,u,s,c,f,l,d,h,v,g,m,y){h?(e.pentagon(t,n,r,i,a,o,u,s,c,f,mt.colours.white,-1,v,g,m),"e"===y?K(e.line,"e",c,f,a,o,r,i,"dashed",l,d,m):K(e.line,"w",a,o,c,f,r,i,"dashed",l,d,m)):e.pentagon(t,n,r,i,a,o,u,s,c,f,l,d,v,g,m)}function W(e,t,n,r,i,a,o,u,s,c){var f=r(i+o),l=r(a+o);if("circle"===e){var d=Math.min(f,l);u(d)}else{var h=t-f,v=n-l,g=t+f,m=n+l;if("box"===e)s(h,v,g,m);else{var y=f-r(i),p=y*Nt,x=r(i*Pt/Dt)+y*zt;"e"===e?(g-=p,c(g,v,t+x,n,g,m,h,m,h,v)):(h+=p,c(h,m,t-x,n,h,v,g,v,g,m))}}}function q(e,t,n,r,i,a,o,u,s,c,f,l,d,h){W(h,t,n,r,i,a,o,function(r){j(e,t,n,r,u,s,c,f,l,d)},function(t,n,r,i){Y(e,t,n,r,i,u,s,c,f,l,d)},function(t,n,r,i,a,o,v,g,m,y){G(e,t,n,r,i,a,o,v,g,m,y,u,s,c,f,l,d,h)})}function X(e,t,n,r,i,a,o,u){W(u,t,n,r,i,a,o,function(t){e._c=t},function(t,n,r,i){e._cl.push({x1:t,y1:n,x2:r,y2:i})},function(t,n,r,i,a,o,u,s,c,f){e._cl.push([t,n,r,i,a,o,u,s,c,f])})}function V(e,t,n,r,i,a,o,u,s){function c(e){return _(e,i,d)}if(!i.hi&&!i.du){var f=St(i),l=H(i,f),d=s(a),h=d&&!ft,v=c("b"),g=c("bs"),m=c("c"),y=f?1:c("e")||1,p=f?c("re"):!1,x=c("u");i._c=0,i._cl=[],i._edit=null;var w,M,b,k=!!v,T=!!m,S=!!x,C=bt&&k&&"dashed"===g,I=k?v:mt.colours.white,L=k?y*(c("bw")||Et):0,O=T?m:mt.colours.white,E=t.x(i.x),D=t.y(i.y),P=k?t.w(L):-1;f?(w=t.dim2,M=i.w/2,b=i.h/2):(w=t.dim,M=b=y*Dt);var A,z=M+L/2,N=b+L/2,B=k?L:y*Et,U=3*B/4;if(A=at?k||T?L/2:U-B/2:U+B/2,(k||T)&&q(r,E,D,w,z,N,0,I,P,C,O,T,a,l),(S||k||T)&&(X(i,E,D,w,z,N,A,l),d&&(p&&!S&&(_t=yt.clone(r.getLast())),h))){var R=kt();F(r,function(){q(r,E,D,w,z,N,U,R,t.w(B),!1,R,!1,a,l),p&&(Ft=r.getLast())})}if(S){var K=w(M)+1,j=w(b)+1;r.image(E-K,D-j,E+K,D+j,u+x,a,i.ci?"ci":void 0),d&&p&&(_t=yt.clone(r.getLast()))}Z(t,r,e,E,D,P,w,M,b,i,c,f,l,k,T,S,h,y,a,u)}}function Z(e,n,r,a,o,u,s,c,f,l,d,h,v,g,m,y,p,x,w,M){var b,k=a,T=o,S=Tt(l),C=!1,I=d("fb"),L=d("fbc"),O=d("fc"),E=d("ff"),A=Math.floor((d("fs")||pt)*x),z=s(A),B=s(3*x+A/2),U=O?O:mt.colours.black,R=L?L:mt.colours.textback;p&&(U=t(),R=kt());var K=o+s(f)+B,F=D(l),_=P(F,r,z,I,E),H=A+3,j=s(H),Y=H*F.length;F.length>0&&(k-=_[0]/2);var G=!1;if(h?l.tc&&(G=!0):y||(G=!0),G)if(!S||g||m||y)K=o-Math.round((F.length-1)*j/2);else{var W=s(Ct*x);k=a+W,a+=Math.floor(_[0]/2+W),K=o,o+=Math.round((F.length-1)*j/2),l._c=W}var q=a;if(("e"===v||"w"===v)&&(g||m)){var X=s(8*x);q+="e"===v?X:-X}F.length>0&&(T=K),g&&(y||h&&!l.tc)&&(K+=u-s(3*x));for(var V=0;V<F.length;V++){var Z=N(r,e,n,F[V],q,K,z,w,!0,U,R,I,l,!1,!0,99,_[V],p,A,E||rt);C=C||Z,K+=j}var $=!i(l)||!C;if(S)if(y||g||m){var nt=3,it=y?11:3;if(!h&&!y&&"circle"===v){var at=2;nt+=at,it+=at}h&&(nt++,it++);var ot=Math.floor(nt*x),ut=Math.floor(it*x);if(l.g.length)for(b=0;b<l.g.length;b++){var st,ct=l.g[b],ft=null,lt=!1;switch(ct.p){case"ne":ft=c-ot,st=-f+ut;break;case"nw":ft=-c+ot,st=-f+ut,lt=!0;break;case"sw":ft=-c+ot,st=f-ut,lt=!0;break;case"se":ft=c-ot,st=f-ut
}null!==ft&&Q(n,e,r,w+wt+ct.p,l.x,l.y,ft,st,x,ct,M,lt,!0)}}else{var dt=e.dim(It*x);$?k+=Math.floor((l.g.length-1)*dt/2):k-=e.dim(Ct*x);var ht=k;if($&&p){for(b=l.g.length-1;b>=0;b--)n.circle(k,T,Math.floor(.6*dt),mt.colours.white,-1,kt(),!0,w),k-=dt;k=ht}for(b=l.g.length-1;b>=0;b--)J(n,e,r,w+wt+b,k,T,x,l.g[b],M),k-=dt}if(h||et(n,e,r,w,a,o,x,l.bg,d),l.bu){var vt=0;h||y||g||m?vt=f:Y>0?vt=Y/2+4:Tt(l)&&(vt=13*x),tt(n,e,r,w,a,o,vt,x,l.bu,M)}}function $(e,t){var n=0,r=0;if(i(e)){var a=Math.floor((e.fs?e.fs:pt)*(e.e?e.e:1)),o=D(e),u=P(o,t,a,e.fb,e.ff);n=A(u),r=a*(o.length+1),e.u||(n/=10)}return{width:n,height:r}}function Q(e,t,n,r,i,a,o,u,s,c,f,l,d){var h=t.x(i)+t.dim(o),v=t.y(a)+t.dim(u);J(e,t,n,r,h,v,s,c,f,l,d)}function J(e,t,n,r,i,a,o,u,s,c,f){if(u){var l=u.a?Rt:1,d=t.dim(9*o*l),h="b"in u?u.b:mt.colours.keyline,v=h?t.w(2*o):-1;if(u.c){if(u.t){var g=u.hasOwnProperty("fb")?u.fb:!0,m=u.fc||mt.colours.white,y=u.ff||rt,p=o*xt[1],x=t.dim(p)*l,w=(u.t+"").substring(0,25),M=mt.measureText(n,w,x,g,y).width;if(u.w&&f&&M>2*d){var b,k,T,S=d;c?(b=i-(M-S)-d,k=i+d,T=i-(M-S)/2):(b=i-d,k=i+(M-S)+d,T=i+(M-S)/2),e.round(b,a-d,k,a+d,d,h,v,u.c,!0,r),N(n,t,e,w,T,a,x,r,!1,m,mt.colours.white,g,null,!0,!1,M,M,!1,p,y,0)}else e.circle(i,a,d,h,v,u.c,!0,r),w=(u.t+"").substring(0,4),p=o*xt[w.length-1],z(n,t,e,w,i,a,t.dim(p),r,!1,m,mt.colours.white,g,null,!0,!1,1.7*d,!1,p,y)}else if(e.circle(i,a,d,h,v,u.c,!0,r),u.u){var C=Math.floor(d/1.414);e.image(i-C,a-C,i+C,a+C,s+u.u,r)}}else u.u&&e.image(i-d,a-d,i+d,a+d,s+u.u,r);Kt=Kt||u.a}}function et(e,t,n,r,i,a,o,u,s){var c=e.layer();e.layer(u?mt.layers.BGHALOS:mt.layers.HALOS);for(var f=0;f<Ut.length;f++){var l=Ut[f],d=s(l);if(d){var h=r+wt+l,v=t.sdim(d.r*o),g=t.sdim(d.w*o);g/2>=v?e.circle(i,a,v+g/2,mt.colours.white,-1,d.c,!0,h):e.circle(i,a,v,d.c,g,mt.colours.white,!1,h)}}e.layer(c)}function tt(e,t,n,r,i,a,o,u,s,c){if(s.t){var f=e.layer();e.layer(mt.layers.BUBBLES);var l=s.p?""+s.p:"ne",d="w"===l.substring(1,2),h="s"===l.substring(0,1),v=r+wt+"bu",g=Number(s.fs?s.fs:pt),m=s.b?s.b:mt.colours.keyline,y=s.c?s.c:mt.colours.white,p=s.fc?s.fc:mt.colours.black,x=t.dim(g),w=D(s),M=t.dim(g+3),b=M*w.length,k=P(w,n,g,s.fb,s.ff),T=A(k),S=13,C=6,I=2*u,L=9,O=13,E=10;o+=O;var z=b+t.dim(2*C),N=t.dim(2),B=Math.max(Math.floor(N/2),1),U=Math.max(t.dim(3),1),R=s.g?17:0;d&&(i-=t.dim(T+2*I+2*S+R)),h&&(a+=t.dim((g+3)*w.length+2*o+2*C));var K=i+t.dim(I)+.5,F=i+t.dim(I+2*S+T+R)+.5,_=a-t.dim(o)-z+.5,H=a-t.dim(o)+.5;e.round(K,_,F,H,t.dim(8),m,N,y,!0,v),J(e,t,n,v,i+t.dim(R),(_+H)/2,1,s.g,c);for(var j=_-.5+t.dim(C)+M,Y=K+t.dim(S+R)-.5,G=0;G<w.length;G++)e.text(Y,j,w[G],p,x,s.fb,v,s.ff||rt),j+=M;d&&(K=F,L=-L,E=-E,B=-B),h&&(H=_,O=-O,U=-U),t.dim(Math.abs(E))>3&&(e.triangle(K+t.dim(L),H,K+t.dim(L+E),H,K+t.dim(L),H+t.dim(O),m,N,y,!0,v),e.triangle(K+t.dim(L)+B,H-U,K+t.dim(L+E)+B,H-U,K+t.dim(L)+B,H+t.dim(O)-U,m,-1,y,!0,v)),e.layer(f)}}var nt,rt,it,at,ot,ut,st,ct,ft,lt,dt,ht,vt,gt={},mt=KeyLines.Rendering,yt=KeyLines.Util,pt=gt.fontSize=14,xt=[12,9,7,7],wt=yt.idSep(),Mt=0,bt=!1;gt.setDashSupport=function(e){bt=!!e};var kt=gt.editColour=function(){return it||mt.colours.edit};gt.setOptions=function(e){nt=e.arrows,yt.isNumber(e.labelOffset)&&(Mt=e.labelOffset),it=e.selectionColour,st=e.fanLength,rt=e.fontFamily,ot=e.linkEnds.avoidLabels,at="loose"!==e.linkEnds.spacing,ut=e.selectionFontColour,ct=e.selectedNode,ft=yt.isNormalObject(e.selectedNode),lt=e.selectedLink,dt=yt.isNormalObject(e.selectedLink)};var Tt=gt.itemHasGlyph=function(e){return e.hasOwnProperty("g")&&yt.isArray(e.g)&&e.g.length>0},St=gt.shapeTest=function(e){return isFinite(e.w)&&isFinite(e.h)},Ct=13,It=21,Lt=Math.PI/7;gt.labelPosition=function(e,t){if(!e||e.hi)return null;for(var n=e._edit,r=["x1","x2","y1","y2","fs"],i=0;i<r.length;i++)n[r[i]]=t.unscale(n[r[i]]);return n};var Ot={},Et=4,Dt=27,Pt=50,At=Pt-Dt,zt=Math.sqrt(Dt*Dt+At*At)/Dt,Nt=1-Math.sin(Math.atan2(Dt,At)/2),Bt={box:!0,circle:!0,e:!1,w:!1};gt.nodeSize=function(e,t,n){if(e.w&&e.h)return yt.len(e.w,e.h);if(e.du)return 10;var r=Dt*(e.e?e.e:1),i=$(e,t);if(n){var a=r+i.height/2,o=i.width/2;return yt.len(o,a)}return r+i.height/2};var Ut=["ha0","ha1","ha2","ha3","ha4","ha5","ha6","ha7","ha8","ha9"];gt.contains=function(e,t){function n(e,t){e&&a.push(t)}var r,i,a=[];if(e=yt.defaults(e,{sh:"box",x:0,y:0}),St(e))if("circle"===e.sh){var o=Math.min(e.w,e.h)/2;for(i in t)r=t[i],St(r)?"circle"===r.sh?n(mt.insideCircle(e.x,e.y,o,r.x,r.y,Math.min(r.w,r.h)/2),r.id):n(mt.circleContains(e.x,e.y,o,r.x-r.w/2,r.y-r.h/2,r.x+r.w/2,r.y+r.h/2),r.id):n(mt.insideCircle(e.x,e.y,o,r.x,r.y),r.id)}else{var u={x1:e.x-e.w/2,y1:e.y-e.h/2,x2:e.x+e.w/2,y2:e.y+e.h/2};for(i in t)if(r=t[i],St(r))if("circle"===r.sh){var s=Math.min(r.w,r.h)/2;n(mt.rectContains(u,r.x-s,r.y-s,r.x+s,r.y+s),r.id)}else n(mt.rectContains(u,r.x-r.w/2,r.y-r.h/2,r.x+r.w/2,r.y+r.h/2),r.id);else n(mt.inside(u,r.x,r.y),r.id)}return a};var Rt,Kt,Ft,_t;return gt.reset=function(){Kt=!1,Ft=null,_t=null},gt.getResizePrimitive=function(){return _t},gt.animated=function(){return Kt},gt.generate=function(t,n,r,i,u,s,c,f,l,d,h){var v,g,m,y;Rt=e.atanEasing((new Date).getTime()%1e3/1e3),c&&c.reset();for(v in t)g=t[v],(!f||f(g))&&(y=a(g),r.layer(y),V(i,u,s[g.u],r,g,v,c,l,d));for(v in n)m=n[v],(!f||f(m))&&(y=o(m),r.layer(y),I(i,u,r,m,v,t[m.id1],t[m.id2],c,l,d));r.layer(mt.layers.HANDLES),Ft&&1===h.length&&mt.getHandles(r,i,Ft,1,Ft.id,kt(),wt)},gt}}(),!function(){var e=KeyLines.TimeBar.Model={};e.createModel=function(e,t){function n(){e.trigger("redraw")}function r(e,t,r,i){B.t1=e,B.t2=t,U.t1=r,U.t2=i,I&&(a(),n()),et=!0}function i(e){var n=W[e.units]*e.by,r=n/L;return r>=t.histogram.minwidth}function a(){L=(U.t2-U.t1)/(I.x2-I.x1);var e=c(L);for(H.major=A[e].major,H.minor=A[e].minor;e>0&&i(A[e-1].minor);)e--;H.histogram=A[e].minor}function o(){G=null;for(var e=0;e<Y.length;e++)j[e]=null,Y[e]=null;j.length=0,Y.length=0}function u(e){G=e;var n,r;for(n=0;n<e.length;n++){var i=e[n].index||0;if(i<t.selection.maxNumber&&e[n].id){var a=E.ensureArray(e[n].id);if(a.length){Y[i]=E.makeIdMap(a),j[i]=[];var o=0;for(r=0;r<z.length;r++)j[i][r]=o,z[r].id in Y[i]&&(o+=z[r].v);j[i][r]=o,s(i,e[n].c)}else!a.length&&j[i]&&(j[i]=null,Y[i]=null)}}}function s(e,n){var r={colour0:"rgb(114, 179, 0)",colour1:"rgb(255, 153, 0)",colour2:"rgb(178, 38, 9)"},i=r["colour"+e];n&&D.validatergb(n)&&(i=n),t.selection["colour"+e]=i}function c(e){for(var t=0;A[t].max<e;)t++;return t}function f(e){for(var t=0,n=z.length;n>t;){var r=t+n>>>1;z[r].t<e?t=r+1:n=r}return t}function l(e,t){for(var n=f(e),r=f(t),i={},a=n;r>a;a++)i[z[a].id]||(i[z[a].id]=1);return E.flattenMap(i)}function d(e,t,n){for(var r=f(e),i=f(t),a=r;i>a;a++){var o=z[a].id;R[o]=(R[o]||0)+n}}function h(){var e=B.t1,t=B.t2,n=K.t1,r=K.t2;n>e?d(e,Math.min(n,t),1):e>n&&d(n,Math.min(e,r),-1),t>r?d(Math.max(e,r),t,1):r>t&&d(Math.max(n,t),r,-1),K.t1=e,K.t2=t}function v(){var e=$(),n=e?2*(e.t2-e.t1):F.max,r=F.min;return t.options.minRange&&(r=Math.max(r,t.options.minRange)),n=Math.max(n,Math.floor(4*r)),r=Math.min(r,Math.floor(n/4)),{max:n,min:r}}function g(){var e=0,n=S,r=t.options.showControlBar?t.controlbar.height:0,i=t.options.scale.showMinor?t.bars.minor.height:0,a=t.options.scale.showMajor?t.bars.major.height:0,o=C-r,u=o-a,s=u-i,c=s-t.histogram.dy,f=c-t.histogram.topdy,l=f*t.selection.reducingFactor;I={bars:{major:{y1:u,y2:o},minor:{y1:s,y2:u}},histogram:{ybase:c,maxbarh:f,maxselh:l},x1:e,y1:s,x2:n,y2:o,width:S,height:C}}function m(){var e,n,r,i=t.selection.maxNumber,a=H.histogram,o=P.clear(U.t1,a.units,a.by),u=f(o),s=0,c=0,l=0;for(n=0;i>n;n++)J.hasSel[n]=!!j[n],J.selvalues[n]=J.selvalues[n]||[];do{r=o>U.t2,J.x[s]=X(o),o=P.add(o,a.units,a.by),e=f(o);var d=N[e]-N[u];for(J.value[s]=d,d>c&&!r&&(c=d),n=0;i>n;n++){var h=j[n];if(h){var v=h[e]-h[u];J.selvalues[n][s]=v,v>l&&!r&&(l=v)}}s++,u=e}while(!r);J.count=s-1,J.maxvalue=c,J.maxselvalue=l,et=!1}function y(e){var t=[];e=E.ensureArray(e);for(var n=0;n<e.length;n++){var r=e[n];if(r.id&&r.dt)for(var i=r.id+"",a=E.ensureArray(r.dt),o=E.ensureArray(r.v),u=0;u<a.length;u++){var s=q(a[u]);if(!E.isNumber(s))throw new Error("load: invalid date in dt property");var c=o[u]||1;if(!E.isNumber(c))throw new Error("load: invalid value in v property - must be numeric");t.push({id:i,t:s,v:c})}}return t}function p(){N=[0],R={},et=!0;for(var t=0;t<z.length;t++){var r=z[t];r.t>=B.t1&&r.t<B.t2&&(R[r.id]=(R[r.id]||0)+1),N[t+1]=N[t]+r.v}K.t1=B.t1,K.t2=B.t2,e.trigger("datachange"),n()}function x(e){E.numberSort(e,"t")}function w(e,t){return e.id===t.id?e.v-t.v:e.id>t.id?1:-1}function M(e,t,n){t.sort(w),n.sort(w);for(var r=0,i=0;r<t.length&&i<n.length;){var a=w(t[r],n[i]);0>a?(e.push(t[r]),r++):a>0?(e.push(n[i]),i++):(e.push(t[r]),r++,i++)}for(;r<t.length;)e.push(t[r]),r++;for(;i<n.length;)e.push(n[i]),i++}function b(e,t){for(var n=[],r=0,i=0;r<e.length&&i<t.length;){var a=e[r].t,o=t[i].t;if(o>a)n.push(e[r]),r++;else if(a>o)n.push(t[i]),i++;else{var u=r,s=i;do r++;while(r<e.length&&e[r].t===o);do i++;while(i<t.length&&t[i].t===o);r===u+1&&i===s+1?(n.push(e[u]),(e[u].id!==t[s].id||e[u].v!==t[s].v)&&n.push(t[s])):M(n,e.slice(u,r),t.slice(s,i))}}for(;r<e.length;)n.push(e[r]),r++;for(;i<t.length;)n.push(t[i]),i++;return n}function k(e,t){var n=Math.floor((e.t2-e.t1)*t);return{t1:e.t1-n,t2:e.t2+n}}function T(){var e=B.t1,t=B.t2;rt(B.t1,B.t2),(e!==B.t1||t!==B.t2)&&it()}var S,C,I,L,O={},E=KeyLines.Util,D=KeyLines.Rendering,P=KeyLines.DateTime,A=t.rates,z=[],N=[],B={t1:0,t2:0},U={t1:0,t2:0},R={},K={t1:0,t2:0},F={max:315576e7,min:3e3},_=250,H={},j=[],Y=[],G=null,W=[1,1e3,6e4,36e5,864e5,6048e5,2592e6,31536e6],q=O.extractUTC=function(e){var t;return e instanceof Date?t=P.UTCify(e):"number"==typeof e&&(t=e),t},X=O.ttox=function(e){return I.x1+Math.floor((e-U.t1)/L)},V=O.xtot=function(e){return U.t1+Math.floor((e-I.x1)*L)},Z=O.getClickedBar=function(e){return e>=I.bars.major.y1?"major":e>=I.bars.minor.y1?"minor":"histogram"};O.findRange=function(e,t){var n,r=Z(t),i=V(e);return Q(r,function(e,t){return t>i?(n={t1:e,t2:t,bar:r},!0):void 0}),n};var $=O.dataRange=function(){if(z.length>0){var e=z[0].t,t=z[z.length-1].t+1;return{t1:e,t2:t}}},Q=O.eachTick=function(e,t){var n,r=H[e],i=P.clear(U.t1,r.units,r.by),a=!1;do n=P.add(i,r.units,r.by),a=t(i,n,X(i),X(n),r.f),i=n;while(!a&&i<=U.t2)},J={count:0,x:[],value:[],hasSel:[],selvalues:[],maxvalue:0,maxselvalue:0},et=!0;O.getHistogram=function(){return et&&m(),J},O.getBounds=function(){return I},O.getInnerRange=function(){return B},O.getOuterRange=function(){return U},O.getTimeRate=function(){return L},O.nextPage=function(e){var t=B.t1,n=B.t2,r="forward"===e?1:-1,i=P.units.month;if(t===P.clear(t,i,1)&&n===P.clear(n,i,1)){var a=new Date(t),o=new Date(n),u=12*(o.getUTCFullYear()-a.getUTCFullYear())+o.getUTCMonth()-a.getUTCMonth();t=P.add(t,i,r*u),n=P.add(n,i,r*u)}else{var s=r*(n-t);t+=s,n+=s}return{t1:t,t2:n}},O.getItems=function(){return z},O.setInnerRangeSide=function(e,t){B[e]=t},O.getSideLimits=function(e){var n,r;if("t1"===e?(n=U.t1,r=B.t2):(n=B.t1,r=U.t2),"fixed"===t.options.sliders){var i=r-n,a=Math.floor(.1*i);n+=a,r-=a}var o=v();"t1"===e?(n=Math.max(n,B.t2-o.max),r=Math.min(r,B.t2-o.min)):(n=Math.max(n,B.t1+o.min),r=Math.min(r,B.t1+o.max));var u=$();return u&&("t1"===e?r=Math.min(r,u.t2):n=Math.max(n,u.t1)),{min:n,max:r}};var tt=O.hasItems=function(){return z.length>0},nt=O.limitInnerRange=function(e,t,n){var r,i=$(),a=n?(e+t)/2:(B.t1+B.t2)/2,o=v(),u=t-e;return u>o.max?(e=Math.ceil(a-o.max/2),t=Math.floor(a+o.max/2)):u<o.min&&(e=Math.floor(a-o.min/2),t=Math.ceil(a+o.min/2)),i&&(t<i.t1?(r=i.t1-t,e+=r,t+=r):e>i.t2&&(r=e-i.t2,e-=r,t-=r)),{t1:e,t2:t}};O.inMainBarOrHistogram=function(e,t){return e>=I.x1&&e<=I.x2&&t>=0&&t<=I.y2},O.load=function(e,t){var n=(e||{}).items,r=y(n);x(r),z=r,o(),p(),E.invoke(t)},O.merge=function(e,t){var n=y(e);n.length>0&&(x(n),z=0===z.length?n:n[0].t>z[z.length-1].t?z.concat(n):n[n.length-1].t<z[0].t?n.concat(z):b(z,n),G&&u(G),p()),E.invoke(t)},O.offsetRanges=function(e){var t=B.t1,n=B.t2;return rt(t+e,n+e),t!==B.t1||n!==B.t2},O.selection=function(e){e=E.isNullOrUndefined(e)?e:E.ensureArray(e),e&&(e.length?u(e):o()),et=!0,n();for(var t=[],r=0;r<Y.length;r++)t[r]=Y[r]?E.flattenMap(Y[r]):null;return t};var rt=O.setInner=function(e,n){var i,a=nt(e,n);i="none"===t.options.sliders?a:"free"===t.options.sliders?tt()?k($(),t.freeSideFactor):U:k(a,t.fixedSideFactor),r(a.t1,a.t2,i.t1,i.t2)};O.setOuter=function(e,t){r(B.t1,B.t2,e,t)},O.updateOptions=function(){T(),g()},O.setSize=function(e,t){S=e,C=t,g()};var it=O.triggerTimeBarChanged=E.ratelimit(function(){e.trigger("change")},_);return O.getIdcounts=function(){return(K.t1!==B.t1||K.t2!==B.t2)&&h(),R},O.getRangeForIds=function(e){e=E.ensureArray(e);var t,n,r=1/0,i=-1/0,a={};for(t=0;t<e.length;t++)a[e[t]]=!0;for(t=0;t<z.length;t++)n=z[t],a[n.id]&&(n.t<r&&(r=n.t),n.t>i&&(i=n.t));return 1/0!==r?{t1:r,t2:i}:void 0},O.getIds=function(e,t){if(E.isNullOrUndefined(e)||E.isNullOrUndefined(t))throw new Error("getIds error: both dt1 and dt2 dates must be passed.");var n=q(e),r=q(t);return l(n,r)},O}}(),!function(){var e=KeyLines.View={},t=e.createView=function(e,n,r,i){function a(){return O(f*k)}function o(){return O(f/k)}function u(e,t,n,r,i){var a=r.instructionPool();return e.generate(a,t,v,n,null,null,i),a}var s,c,f,l,d,h=KeyLines.Util,v={},g=n,m=r,y=i?i:1;v.scaleFactor=function(e){return e&&(y=e),y};var p=v.scale=function(e){return Math.floor(y*e)};v.unscale=function(e){return Math.floor(e/y)},v.settings=function(){return{width:g,height:m,zoom:f,offsetX:l,offsetY:d}},v.fromSettingsDirect=function(e,t,n,r){return K(f,O(e.zoom),e.offsetX-l,e.offsetY-d,t,n,r)},v.fromOldSettings=function(n,r,i,a){if(r){var o=t(e,n.width,n.height);o.setZoom(n.zoom,!1),o.offsetX=n.offsetX,o.offsetY=n.offsetY;var u={x1:o.newToOldX(0),y1:o.newToOldY(0),x2:o.newToOldX(o.width()),y2:o.newToOldY(o.height())};return D(u,i,!1,!1,!1,a)}E(n.zoom,!1),l=n.offsetX,d=n.offsetY},v.width=function(e){return e&&(g=e),g},v.height=function(e){return e&&(m=e),m};var x=v.x=v.oldToNewX=function(e){return Math.floor(((e-s)*f+l)*y)},w=v.y=v.oldToNewY=function(e){return Math.floor(((e-c)*f+d)*y)},M=v.newToOldX=function(e){return Math.floor((e/y-l)/f+s)},b=v.newToOldY=function(e){return Math.floor((e/y-d)/f+c)};v.w=function(e){return Math.max(1,Math.floor(e*Math.min(f,I)*y))},v.dim=function(e){return Math.floor(e*Math.min(f,I)*y)},v.sdim=function(e){return e*Math.min(f,I)*y},v.dim2=function(e){return Math.floor(e*f*y)},v.undim=function(e){return Math.floor(e/(Math.min(f,I)*y))};var k=1.4,T=4,S=.05,C=200,I=1/0,L=100;v.maxZoom=function(){return T},v.minZoom=function(){return S},v.setMaxItemZoom=function(e){I=e?e:1/0},v.getMaxItemZoom=function(){return I},v.zoomIn=function(e,t,n){var r=a();return A(r,y*g/2,y*m/2,e,t,n)},v.zoomOut=function(e,t,n){var r=o();return A(r,y*g/2,y*m/2,e,t,n)};var O=function(e){return Math.min(T,Math.max(e,S))},E=v.setZoom=function(e,t,n,r){var i=O(e);return A(i,y*g/2,y*m/2,t,n,r)};v.wheelToPosition=function(e,t,n){var r=e>0?a():o();return A(r,t,n,!0,200)},v.fitWorldExtents=function(e,t,n,r,i,a,o){if(!e)return h.invoke(o),null;var u={x1:x(e.x1),y1:w(e.y1),x2:x(e.x2),y2:w(e.y2)};return D(u,t,n,r,i,a,!1,o)};var D=v.fitExtents=function(e,t,n,r,i,a,o,u,h){var v,p=(e.y2-e.y1)/(e.x2-e.x1),x=m/g;if(p>x){var w=i?m/8:0;v=f*(m-w)/(e.y2-e.y1)}else{var k=i?g/8:0;v=f*(g-k)/(e.x2-e.x1)}v*=y,n&&(v=O(v)),r&&v>1&&(v=1),h&&(v=f);var T=(e.x1+e.x2)/2,S=(e.y1+e.y2)/2,C=M(T),I=b(S),L=g/2-(C-s)*v,E=m/2-(I-c)*v;return K(f,v,L-l,E-d,t,a,u,o)};v.fitToSelection=function(e,t,n,r,i,a,o,u,s){var c=r.instructionPool();return e.generateSelection(c,t,v,n,void 0,u),P(t,c,r,i,a,o,s)};var P=function(e,t,n,r,i,a,o){var u=n.getUnionExtents3(e,t);return u?D(u,r,!0,!0,!0,i,!1,a,o):(h.invoke(a),null)};v.modelExtents=function(e,t,n,r,i){var a=I;I=1/0;var o=u(e,t,n,r,i);return I=a,r.getUnionExtents3(t,o)},v.fitToModel=function(e,t,n,r,i,a,o,s){var c=u(e,t,n,r,s);return P(t,c,r,i,a,o)},v.fitModelHeight=function(e,t,n,r,i,a,o,s){var c=u(e,t,n,r,s),f=r.getUnionExtents3(t,c);return f?(f.x1=f.x2=v.width()/2,D(f,i,!0,!0,!0,a,!1,o)):(h.invoke(o),void 0)};var A=v.zoomToPosition=function(e,t,n,r,i,a){e=O(e);var o=M(t),u=b(n),h=t/y-(o-s)*e,v=n/y-(u-c)*e;return K(f,e,h-l,v-d,r,i,a)},z=v.reset=function(e){s=421,c=298,e?K(f,1,421-l,298-d,!0):(l=421,d=298,f=1)};v.zoom=function(){return f},v.offsetX=function(e){return h.defined(e)&&(l=e),l},v.offsetY=function(e){return h.defined(e)&&(d=e),d},v.pan=function(e,t,n,r){var i=0,a=0;switch(e){case"up":a=1;break;case"down":a=-1;break;case"left":i=1;break;case"right":i=-1}return i*=L,a*=L,R(i,a,t,!1,n,r)};var N,B,U,R=v.panBy=function(e,t,n,r,i,a){return K(f,f,e,t,n,i,a,r)},K=function(t,n,r,i,a,o,u,s){return a?F(t,n,r,i,o,u):(l+=Math.floor(r),d+=Math.floor(i),f=n,e&&!s&&e.trigger("viewchange"),h.invoke(u),void 0)},F=function(t,n,r,i,a,o){a||(a=C);var u=a,s=l,c=d;return{animate:function(v){u-=v;var g=e.atanEasing(Math.max(0,Math.min(1,(a-u)/a)));l=s+g*r,d=c+g*i,f=O(t+g*(n-t));var m=u>0;return m||(e.trigger("viewchange"),h.invoke(o)),m}}},_=function(t,n,r){var i=.1;return{animate:function(a){var o=0===B&&0===U;return l+=a*i*B,d+=a*i*U,N=!o,r&&r.dragMove(t,n),o||e.trigger("viewchange"),!o}}};return v.cancelScroll=function(){B=U=0},v.maybeScroll=function(e,t,n){var r=p(50);return B=0,U=0,r>e&&(B=1),e>p(g)-r&&(B=-1),r>t&&(U=1),t>p(m)-r&&(U=-1),n.direction&&(n.direction.x||(B=0),n.direction.y||(U=0)),0===B&&0===U||N?void 0:(N=!0,_(e,t,n))},z(),v}}(),!function(){var e=KeyLines.DateTime={},t=e.defaultLocale={longMonths:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],longDays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],ampm:["AM","PM"],quarter:"Q",half:"H"},n=[31,28,31,30,31,30,31,31,30,31,30,31],r=e.units={milli:0,sec:1,min:2,hour:3,day:4,week:5,month:6,year:7},i=function(e,t){return t?e-e%t:0},a=function(e){if(e<r.milli||r.year<e)throw new Error("bad unit range")},o=function(e,t){return 1===e&&u(t)?29:n[e]},u=function(e){return 1===new Date(e,1,29).getMonth()};e.UTCify=function(e){return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())},e.unUTCify=function(e){var t=new Date(e);return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds(),t.getUTCMilliseconds())},e.clear=function(e,t,n){a(t);var o=new Date(e);switch(t>r.milli&&o.setUTCMilliseconds(0),t>r.sec&&o.setUTCSeconds(0),t>r.min&&o.setUTCMinutes(0),t>r.hour&&o.setUTCHours(0),t>=r.month&&o.setUTCDate(1),t>=r.year&&o.setUTCMonth(0),t){case r.milli:o.setUTCMilliseconds(i(o.getUTCMilliseconds(),n));break;case r.sec:o.setUTCSeconds(i(o.getUTCSeconds(),n));break;case r.min:o.setUTCMinutes(i(o.getUTCMinutes(),n));break;case r.hour:o.setUTCHours(i(o.getUTCHours(),n));break;case r.day:break;case r.week:var u=o.getUTCDay(),s=u>=1?u-1:6;o.setTime(o.getTime()-864e5*s);break;case r.month:o.setUTCMonth(i(o.getUTCMonth(),n));break;case r.year:o.setUTCFullYear(i(o.getUTCFullYear(),n))}return o.getTime()};var s=e.add=function(e,t,n){if(a(t),t<=r.week){var i=n;return t>r.milli&&(i*=1e3),t>r.sec&&(i*=60),t>r.min&&(i*=60),t>r.hour&&(i*=24),t>r.day&&(i*=7),e+i}var c=new Date(e);switch(t){case r.month:var f=c.getUTCMonth()+n,l=f%12,d=Math.floor(f/12);0>l&&(l+=12);var h=c.getUTCDate();h=Math.min(h,o(l,c.getUTCFullYear()+d)),c.setUTCDate(h),c.setUTCMonth(l),0!==d&&c.setTime(s(c.getTime(),r.year,d));break;case r.year:if(1===c.getUTCMonth()&&29===c.getUTCDate()){var v=c.getUTCFullYear()+n;u(v)||c.setTime(s(c.getTime(),r.day,-1))}c.setUTCFullYear(c.getUTCFullYear()+n)}return c.getTime()},c=function(e){for(var t=e+"";t.length<2;)t="0"+t;return t},f=new RegExp("(f?f?f)|(s?s)|(m?m)|(h?h)|(H?H)|(t?t?t)|(d?d?d?d)|(M?M?M?M?M)|(Q?Q)|yyyy|yy","gm"),l={f:function(e){return Math.floor(e.getUTCMilliseconds()/100)},ff:function(e){return c(Math.floor(e.getUTCMilliseconds()/10))},fff:function(e){return c(Math.floor(e.getUTCMilliseconds()))},s:function(e){return e.getUTCSeconds()},ss:function(e){return c(e.getUTCSeconds())},m:function(e){return e.getUTCMinutes()},mm:function(e){return c(e.getUTCMinutes())},h:function(e){return e.getUTCHours()%12||12},hh:function(e){return c(e.getUTCHours()%12||12)},H:function(e){return e.getUTCHours()},HH:function(e){return c(e.getUTCHours())},t:function(e,t){return t.ampm[Math.floor(e.getUTCHours()/12)].charAt(0)},tt:function(e,t){return t.ampm[Math.floor(e.getUTCHours()/12)]},ttt:function(e,t){var n=Math.floor(e.getUTCHours()/12);return t.ampm[n+2]||t.ampm[n]},d:function(e){return e.getUTCDate()},dd:function(e){return c(e.getUTCDate())},ddd:function(e,t){return t.shortDays[e.getUTCDay()]},dddd:function(e,t){return t.longDays[e.getUTCDay()]},M:function(e){return e.getUTCMonth()+1},MM:function(e){return c(e.getUTCMonth()+1)},MMM:function(e,t){return t.shortMonths[e.getUTCMonth()]},MMMM:function(e,t){return t.longMonths[e.getUTCMonth()]},MMMMM:function(e,t){return t.shortMonths[e.getUTCMonth()].substr(0,1)},Q:function(e,t){var n=e.getUTCMonth(),r=Math.floor(n/3)+1;return t.quarter+r},QQ:function(e,t){var n=e.getUTCMonth(),r=Math.floor(n/6)+1;return t.half+r},yyyy:function(e){return e.getUTCFullYear()},yy:function(e){return c(e.getUTCFullYear()%100)}};e.format=function(e,n,r){return"number"==typeof e&&(e=new Date(e)),r=r||t,n.replace(f,function(t){return l[t](e,r)})};var d="(?::)?",h="(?:-|$)",v="(?:T|$)",g=function(e,t){return e[t]?parseInt(e[t],10):void 0},m=function(e,t,n,r){var i=g(e,t);return y(i)?i>=n&&r>=i?i:void 0:n},y=function(e){return"undefined"!=typeof e},p=new RegExp("^(\\d{4})"+h+"(\\d{2})?"+h+"(\\d{2})?"+v+"(\\d{2})?"+d+"(\\d{2})?"+d+"(\\d{2})?"+"(?:Z)?"+"(\\+|-)?"+"(\\d{2})?"+d+"(\\d{2})?");e.parseISO8601=function(e){var t=p.exec(e);if(t){var n=g(t,1),r=m(t,2,1,12),i=m(t,3,1,31),a=m(t,4,0,23),u=m(t,5,0,59),s=m(t,6,0,59),c="-"===t[7]?-1:1,f=m(t,8,0,12),l=m(t,9,0,59);if(!(y(n)&&y(r)&&y(i)&&y(a)&&y(u)&&y(s)&&y(f)&&y(l)))return;if(i>o(r-1,n))return;var d=6e4*c*(60*f+l);return new Date(Date.UTC(n,r-1,i,a,u,s)-d)}}}(),!function(){var e=KeyLines.API=KeyLines.API||{};e.createAPI=function(){function e(e,t){e?x.afterChange(t):(x.render(),l.invoke(t))}function t(e){return e===!0&&(e={animate:!0}),l.defaults(e,{animate:!1,time:1e3})}function n(e,t){function n(e,t,n){h.privateEach({type:"link"},function(e){if(!t[e.id1]||!t[e.id2]){var r=t[e.id1]||t[e.id2],i=t[e.id1]?e.id2:e.id1;r&&i&&(n[i]||(n[i]={x:0,y:0,counter:0,id:i}),n[i].x+=r.x,n[i].y+=r.y,n[i].counter++)}});var r=0;return l.iterator(n,function(e){t[e.id]||(e.x/=e.counter,e.y/=e.counter,t[e.id]=e,r++)}),r}function r(e,r){for(var i,a={},u=[];0!==i;)i=n(e,r,a);l.iterator(e,function(e){"node"===e.type&&(a[e.id]||(e.x=o[e.id].x,e.y=o[e.id].y))}),l.iterator(a,function(e){u.push(e)}),h.setProperties(u,!1,function(){l.invoke(t,s)})}function i(){var e=[],t={};return y.each({type:"node"},function(n){e.push(n.id),t[n.id]=n}),{list:e,dict:t}}function a(e){for(var t=[],n={},r=0;r<e.length;r++){var i=e[r];l.isNullOrUndefined(i)||n[i.id]||(n[i.id]=1,o[i.id]={x:i.x,y:i.y},delete i.x,delete i.y,t.push(i))}return t}var o={};e=a(e);var u=i(),s=u.list,c=u.dict;h.merge(e,function(){r(e,c)})}function r(e){x.draw(e),x.drawoffscreen(),x.afterDraw()}var i,a=KeyLines.Controller,o=KeyLines.Draggers,u=KeyLines.Events,s=KeyLines.Model,c=KeyLines.Overlays,f=KeyLines.Rendering,l=KeyLines.Util,d=KeyLines.View,h={},v=u.createEventBus(),g=o.createDraggers(v),m=KeyLines.Generator.create(v),y=s.createModel(v,g,m),p=c.createOverlays(v,d),x=a.createController(h,v,p,m);x.setModel(y);var w;h.privateInit=function(e,t,n,r,i,a,o,u,s){w=r,x.assetPath(o),x.setCursorFn(i),x.setCreateCanvasFn(r),x.setImageGenFn(a),M(e,t,n,u),x.imageBasePath(s)};var M=h.privateSetSize=function(e,t,n,r,a){var o=w(t,n);x.makeGhostCanvas(t,n),r&&(t/=r,n/=r);var u=i;i=d.createView(v,t,n,r),x.setView(i),x.setCanvas(e),x.setShadowCanvas(o.getContext("2d"),t,n),f.clearLastFont(),u&&(i.setMaxItemZoom(u.getMaxItemZoom()),i.fromOldSettings(u.settings(),!1)),x.afterChange(null,a)};h.privateNamespaceDefinitions=function(){var e={};return e.graph={degrees:!0,distances:!0,betweenness:!0,closeness:!0},e.combo={},e},h.graph=function(){return y.graph()},h.combo=function(){return x.combo.api},h.toDataURL=function(e,t,n){function r(n){e=Math.floor(e/n),t=Math.floor(t/n)}e=Math.floor(e),t=Math.floor(t),e=e>0?e:100,t=t>0?t:100,n=l.defaults(n,{fit:"view",watermark:!0,gradient:!0,logo:!0});var o;if("oneToOne"===n.fit){var s=x.modelExtents();s||(s={x1:0,y1:0,x2:100,y2:100});var f=10;o={x1:i.newToOldX(s.x1)-f,x2:i.newToOldX(s.x2)+f,y1:i.newToOldY(s.y1)-f,y2:i.newToOldY(s.y2)+f};var v=x.watermarkSize();if(v&&n.watermark){var g=(v.width-(o.x2-o.x1))/2;g>0&&(o.x1-=g,o.x2+=g);var p=(v.height-(o.y2-o.y1))/2;p>0&&(o.y1-=p,o.y2+=p)}e=o.x2-o.x1,t=o.y2-o.y1,n.noScale=!0}var M=16e6,b=e*t,k=b/M;if(k>1){var T=Math.sqrt(k);r(T)}var S=8e3,C=e/S;C>1&&r(C);var I=t/S;I>1&&r(I);var L=w(e,t),O=L.getContext("2d"),E=n.noScale?1:e/i.width(),D=u.createEventBus(),P=d.createView(D,Math.floor(e/E),Math.floor(t/E)),A=c.createOverlays(D,d),z=a.createController(h,D,A,m);z.setCreateCanvasFn(w),z.setModel(y),z.setView(P),z.setCanvas(O),z.assetPath(x.assetPath()),z.imageBasePath(x.imageBasePath()),z.imageList(x.imageList());var N=x.options();N.overview={shown:!1},n.watermark||(N.watermark=!1),n.gradient||(N.gradient=!1),n.logo||(N.logo=!1),z.options(N,null,!0),z.makeGhostCanvas(P.width(),P.height());var B=[];switch(n.selection||(B=y.doSelection(),y.doSelection([])),n.fit){case"chart":z.fitToModel(!1);break;case"view":P.fromOldSettings(i.settings(),!0);break;case"exact":P.fromOldSettings(i.settings(),!1);break;case"oneToOne":P.fitWorldExtents(o,!1,!1,!1,0,0)}P.scaleFactor(E),z.draw(!0);var U;try{U=L.toDataURL()}catch(R){throw new Error("[toDataURL] There is a problem to export the chart with tainted canvas.")}return n.selection||y.doSelection(B),U},h.load=function(e,t){switch(e.type){case"LinkChart":y=s.createModel(v,g,m),x.setModel(y),x.load(e),x.afterChange(t);break;default:throw new Error("Unknown chart type passed to load")}},h.chartType=function(){return y.type()},h.clear=function(){v.trigger("prechange","delete"),y.load({items:[]}),x.combo.internalUse.loadUp(),x.afterChange(null,!0)},h.merge=function(t,n){var r=x.merge(t);e(r,function(){x.postMerge(n)})},h.privateMerge=function(t,n){var r=y.merge(t);e(r,n)},h.privateEach=function(e,t){y.each(e,t)},h.privateBothEndsShown=function(e){return y.bothEndsShown(e)},h.privateRemoveItem=function(e){y.removeItem(e),x.render()},h.privateGraph=function(){return y.graph()},h.setProperties=function(t,n,r){var i=x.setProperties(t,n);e(i,r)},h.animateProperties=function(e,t,n){t=l.defaults(t,{time:1e3,easing:"linear",queue:!0}),e=l.ensureArray(e),x.animateProperties(e,t,n)},h.animateBackColourOpacity=function(e,t,n){t=l.defaults(t,{time:500}),e=isFinite(e)?Math.min(Math.max(0,e),1):e?1:0,x.animateBackColourOpacity(e,t.time,n)},h.ping=function(e,t,n){t=l.defaults(t,{c:"#909090",w:20,r:80,time:800,repeat:1}),x.ping(e,t,n)},h.getItem=function(e){if(l.isArray(e)){for(var t=[],n=0;n<e.length;n++){var r=y.getItem(e[n]);r=r||null,t.push(r)}return t}return y?y.getItem(e):null},h.setItem=function(t,n){if(t){v.trigger("prechange","properties");var r=x.setItem(t);e(r,function(){x.postMerge(n)})}},h.removeItem=function(e){v.trigger("prechange","delete"),x.removeItem(e),x.render()},h.hide=function(e,n,r){v.trigger("prechange","hide"),e=l.ensureArray(e),n=t(n),x.hide(e,n,r)},h.hidden=function(){return y.hidden()},h.show=function(e,n,r,i){v.trigger("prechange","show"),e=l.ensureArray(e),r=t(r),x.show(e,n,r,i)},h.labelPosition=function(e){return y?x.labelPosition(e,i):null},h.contains=function(e){return y?y.contains(e):[]},h.serialize=function(){var e=y.serialize(i);return x.appendCombos(e),e.viewSettings=i.settings(),e},h.worldCoordinates=function(e,t){var n=i.scale(e),r=i.scale(t);return{x:i.newToOldX(n),y:i.newToOldY(r)}},h.viewCoordinates=function(e,t){var n=i.oldToNewX(e),r=i.oldToNewY(t);return{x:i.unscale(n),y:i.unscale(r)}},h.viewOptions=function(e,n,r){if(!e)return i.settings();var a=t(n);e=l.defaults(e,{offsetX:0,offsetY:0,zoom:1}),x.setViewSettings(e,a.animate,a.time,function(){x.render(),l.invoke(r)})},h.options=function(e,t){return x.options(e,t)},h.displayOptions=function(e,t){return h.options(e,t)},h.interactionOptions=function(e){return h.options(e)},h.lock=function(e,t){return"undefined"!=typeof e&&(b=e,e?(t=t||{},x.wait(t.wait)):x.wait(!1),x.render()),b};var b=!1;h.zoom=function(e,n,r){var i=t(n);switch(e){case"in":x.zoomIn(i.animate,i.time,r);break;case"out":x.zoomOut(i.animate,i.time,r);break;case"one":x.setZoom(1,i.animate,i.time,r);break;case"fit":x.fitToModel(i.animate,i.time,r);break;case"selection":x.fitToSelection(i.animate,i.time,r);break;case"height":x.fitModelHeight(i.animate,i.time,r)}},h.pan=function(e,n,r){var i=t(n);"selection"===e?x.fitToSelection(i.animate,i.time,r,!0):x.pan(e,i.animate,i.time,r)},h.getLastError=function(){return v.getErrors()},h.imagePrefix=function(e){return x.imagePrefix(e)},h.cancelAnimation=function(){x.cancelAnimation()},h.layout=function(e,t,n){e||(e="standard");var r=h.viewOptions(),i=r.height>0?r.width/r.height:1;t=l.defaults(t,{fit:!0,animate:!0,tidy:!0,ratio:i,tightness:5,straighten:!0}),x.layout(e,t,!1,n)},h.arrange=function(e,t,n,r){e||(e="grid"),n=l.defaults(n,{fit:!1,animate:!0,tidy:!1,ratio:1}),x.arrange(e,t,n,r)},h.selection=function(e){e=l.isNullOrUndefined(e)?e:l.ensureArray(e);var t=y?y.doSelection(e):[];return e&&x.render(),t},h.expand=function(e,t,r){function i(e){var n={fixed:e,animate:!!t.animate,time:t.time,tightness:t.tightness,tidy:t.tidy,fit:t.fit,strategy:"spiral"};h.layout("standard",n,r)}t=l.defaults(t,{fit:!1,tidy:!1,animate:!0,tightness:5,time:1e3}),v.trigger("prechange","expand"),e=l.ensureArray(e),n(e,i)},h.createLink=function(e,t,n,r){function i(e,t){"dummy"===e&&(h.removeItem(o),h.unbind("dragcomplete",i),l.invoke(r,t))
}var a=h.getItem(e);if(e&&a&&"node"===a.type&&t){t=l.rawId(t),n=l.defaults(n,{style:{}}),h.bind("dragcomplete",i);var o="dummyEnd"+Math.floor(1e7*Math.random()),u={type:"node",du:!0,id:o,x:a.x,y:a.y},s=l.merge(n.style,{id:t,id1:e,id2:o,type:"link"});h.merge([u,s],function(){setTimeout(function(){x.startDragger(t,o+l.idSep()+"id2",a.x,a.y)},50)})}},KeyLines.Common.appendActions(h,x,h.lock),h.mousemove=function(e,t,n,r){x.mousemove(e,t,n,r,b)},h.dragover=function(e,t){x.dragover(e,t)},l.merge(h,v);var k=KeyLines.Common.frameManager(r,x.animate);return l.merge(h,k),h.bind("redraw",k.redraw),h}}(),!function(){var e=KeyLines.Combo={};e.create=function(e){function t(t,n){for(var r=[],i=e.serialize().items,a=0;a<i.length;a++){var o=i[a];o.type===n&&t[o.id]&&r.push(o)}return r}function n(e){for(var t={},n=0;n<e.length;n++)t[e[n].id]=e[n];return t}function r(e){var t=[];for(var n in e)n=F.rawId(n),t.push(e[n]);return t}function i(e){return e+Math.floor(1e7*Math.random())}function a(e,t){var n=i(t);return e[n]?a(e):n}function o(e,t){return e.substr(0,t.length)===t}function u(e){return o(e,_)&&!!H[e]}function s(e){var t=[];if(u(e))for(var n=H[e].nodes,r=0;r<n.length;r++)u(n[r].id)?t=t.concat(s(n[r].id)):t.push(n[r]);return t}function c(e){var t=[];if(u(e))for(var n=H[e].nodes,r=0;r<n.length;r++)u(n[r].id)&&(t.push(n[r].id),t=t.concat(c(n[r].id)));return t}function f(e,t){var n=j[e.id];if("undefined"==typeof n)return 0;var r=H[n],i=Number(e[t])-Number(r[t]);return i+f(r,t)}function l(e,t,n){var r=a(H,_);return H[r]={id:r,nodes:e,x:t,y:n},r}function d(e){var t=H[e];return delete H[e],t}function h(){var e={};for(var t in H){t=F.rawId(t);for(var n=0;n<H[t].nodes.length;n++)e[H[t].nodes[n].id]=t}return e}function v(){j=h()}function g(e){for(var t;e;)t=e,e=j[e];return t}function m(e){return e!==g(e)}function y(e){return o(e,Y)}function p(){var t=i(Y);return e.getItem(t)?p():t}function x(e,t,n){var r=g(e.id1),i=g(e.id2);return r===t&&i===n||r===n&&i===t}function w(t){if(y(t)){var n=e.getItem(t);if(n){var r=[];for(var i in G)i=F.rawId(i),x(G[i],n.id1,n.id2)&&r.push(G[i]);return r}}return null}function M(){function t(e,t,n){var r=t>e?e:t,i=e>t?e:t;c[r]||(c[r]={}),c[r][i]||(c[r][i]=[]),c[r][i].push(n)}function n(e){for(var t=0;t<e.length;t++)if(!e[t].hi)return!0;return!1}function r(e,t,n){var r=n.a1,i=n.a2;if(e===n.id1)return r;if(e===n.id2)return i;if(t===n.id1)return i;if(t===n.id2)return r;var a;for(a=0;u(e)&&a<H[e].nodes.length;a++){if(n.id1===H[e].nodes[a].id)return r;if(n.id2===H[e].nodes[a].id)return i}for(a=0;u(t)&&a<H[t].nodes.length;a++){if(n.id1===H[t].nodes[a].id)return r;if(n.id2===H[t].nodes[a].id)return i}return void 0}function i(e){return!(o(e,_)&&!H[e])}function a(e,t,n,i){for(var a,o,u=0;(!a||!o)&&u<i.length;u++)a=a||r(t,n,i[u]),o=o||r(n,t,i[u]);e.a1=a,e.a2=o}var s={};e.privateEach({type:"node"},function(e){s[e.id]={}}),e.privateEach({type:"link"},function(e){s[e.id1][e.id2]=s[e.id2][e.id1]=!0});var c={};for(var f in G){f=F.rawId(f);var l=G[f],d=g(l.id1),h=g(l.id2),v=i(d)&&i(h);v&&d!==h&&(s[d][h]||t(d,h,l))}var m=[];for(var y in c){y=F.rawId(y);for(var x in c[y])if(x=F.rawId(x),u(y)||u(x)){var w=c[y][x],M=F.clone(w[0]);M.id1=y,M.id2=x,M.id=p(),M.hi&&n(w)&&delete M.hi,M.off=void 0,a(M,y,x,w),m.push(M)}else for(var b=c[y][x],k=0;k<b.length;k++)m.push(b[k]),delete G[b[k].id]}return m}function b(t,n,r){for(var i=e.privateGraph().shortestPaths(n,r,{all:!0}).items,a=0;a<i.length;a++)if(i[a]!==n&&i[a]!==r&&y(i[a]))for(var o=w(i[a]),u=0;u<o.length;u++)if(t===o[u].id)return i[a]}function k(e){var t,n=G[e],r=g(n.id1),i=g(n.id2),a=r&&i&&r!==i,o=r&&r===i;return t=a?b(e,r,i):o?r:r||i}function T(e){e=F.ensureArray(e);for(var t=[],n=0;n<e.length;n++){var r=null;if(e[n]){r=g(e[n]);var i=u(r),a=e[n]in G;i||(r=a?k(e[n]):null)}t.push(r)}return t}function S(e){if(F.isNullOrUndefined(e))throw new Error("[Find] Undefined argument passed");return F.isArray(e)?T(e):T(e)[0]}function C(e,t){if(F.isNullOrUndefined(t.label)){for(var n="",r=0;r<e.length;r++)F.isNullOrUndefined(e[r].t)||(n+=e[r].t,r<e.length-1&&(n+="\n"));return n}return t.label}function I(e,t,n,r){var i,a=0,o=0;for(i=0;i<e.length;i++)a+=e[i].x,o+=e[i].y;a/=e.length,o/=e.length;var u="average"===t.position?a:e[0].x,s="average"===t.position?o:e[0].y;for(i=0;i<e.length;i++)n.push({id:e[i].id,x:u,y:s}),i>0&&r.push({id:e[i].id,x:e[i].x+t.dx,y:e[i].y+t.dy});return{x:u,y:s}}function L(e,t,n){var r=t.style?t.style:F.clone(e[0]);delete r.id,F.isNormalObject(t.style)&&(r=F.merge(r,t.style));var i={p:"ne",c:"rgb(255, 0, 0)",t:n};F.isNormalObject(t.glyph)&&(t.glyph=F.defaults(t.glyph,{p:"ne",c:null,u:null})),F.isNormalObject(t.glyph)&&(i=F.merge(i,t.glyph),t.glyph.c||t.glyph.u||(i.c="rgb(255, 0, 0)"));var a=[];return null!==t.glyph&&a.push(i),r.g=a,F.isNormalObject(t.d)&&(r.d=F.clone(t.d)),r.type="node",r}function O(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n].id);return t}function E(e){for(var t,n=[],r={},i=0;i<e.length;i++)for(var a=0;a<e[i].ids.length;a++){if(t=e[i].ids[a],r[t])throw new Error("[Combine] nodes should be only in one combo");r[t]=1,n.push(t)}return n}function D(t){for(var n,r,i={},a=[],o=e.getItem(t),u=0;u<t.length;u++)if(n=t[u],!i[n]){if(r=o[u],!r||"node"!==r.type)throw new Error("[Combine] function must be passed valid ids");"node"===r.type&&(a.push(r),i[n]=1)}if(a.length<1)throw new Error("[Combine] function must be passed at least one node id");return a}function P(e,t,n){var r=l(e,n.x,n.y);v();var i=s(r),a=L(e,t,i.length),o=F.merge(a,{id:r,t:C(e,t),x:n.x,y:n.y});return o}function A(t,n,r){function i(){for(var i=[],a=0;a<t.length;a++){var o=P(c[a],t[a],v[a]);i.push(o)}e.merge(i,function(){e.privateRemoveItem(f);var t=M();e.privateMerge(t,function(){var t=O(i);n.select&&(e.selection(t),e.trigger("selectionchange")),F.invoke(r,t)})})}var a,o,u,s,c=[];for(n=F.defaults(n,{animate:!0,select:!0,time:250}),t=F.ensureArray(t),a=0;a<t.length;a++)s=t[a],t[a]=F.defaults(s,{position:"average",dx:0,dy:0,label:null,style:null,d:null}),t[a].ids=F.ensureArray(t[a].ids),u=D(t[a].ids),c.push(u);var f;f=E(t);var l,d=[],h=[],v=[];for(a=0;a<t.length;a++)l=I(c[a],t[a],d,h),v.push(l);var g=e.privateGraph().neighbours(f,{all:!0});for(o=0;o<g.links.length;o++){var m=g.links[o];y(m)||(G[m]=e.getItem(m))}e.trigger("prechange","combine");var p=d.length?n.time:0;e.setProperties(h,!1,function(){n.animate?e.animateProperties(d,{time:p},i):e.setProperties(d,!1,i)})}function z(t){for(var n=0;n<t.length;n++){var r=t[n];r.hi=!e.privateBothEndsShown(r)}}function N(t,n,r){function i(){n.select&&(e.selection(y),e.trigger("selectionchange")),F.invoke(r)}e.trigger("prechange","uncombine"),n=F.defaults(n,{animate:!0,time:250,full:!1,select:!0}),v();for(var a,o=F.ensureArray(t),l={},h=0,g={},m=[],y=[],p=[],x=0;x<o.length;x++)if(a=o[x],u(a)){var w=e.getItem(a);w&&(h++,l[a]=w,n.full?(g[a]=s(a),m=m.concat(c(a))):g[a]=H[a].nodes)}if(0===h)return F.invoke(r),void 0;for(a in l){a=F.rawId(a);for(var b=0;b<g[a].length;b++){var k=g[a][b];y.push(k.id),p.push({id:k.id,x:l[a].x+f(k,"x"),y:l[a].y+f(k,"y")})}}for(var T=0;T<m.length;T++)d(m[T]);for(a in l){a=F.rawId(a);for(var S=g[a],C=0;C<S.length;C++)S[C].x=l[a].x,S[C].y=l[a].y;e.privateMerge(S),d(a),e.privateRemoveItem(a)}v();var I=M();z(I),e.privateMerge(I,function(){n.animate?e.animateProperties(p,{time:n.time},i):e.setProperties(p,!1,i)})}function B(e){return u(e)?{nodes:s(e),links:null}:y(e)?{nodes:null,links:w(e)}:null}function U(e,t){var n=F.ensureArray(e);if(t=F.defaults(t,{type:"all"}),!t.type.match(/^(node|link|all)$/))throw new TypeError("[isCombo] opts type property should be either 'node', 'link' or 'all'");for(var r=0;r<n.length;r++){if(u(n[r])&&"link"!==t.type)return!0;if(y(n[r])&&"node"!==t.type)return!0}return!1}function R(e){for(var t=["id","id1","id2"],n=0;n<t.length;n++)t[n]in e&&(e[t[n]]+="")}function K(e){e&&(H=n(e.nodes),G=n(e.links));var t=F.clone(r(H)),i=F.clone(r(G));return{nodes:t,links:i}}var F=KeyLines.Util,_="_combo_",H={},j={},Y="_combolink_",G={},W={api:{combine:A,uncombine:N,info:B,isCombo:U,find:S},internalUse:{preMerge:function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];if(R(r),"node"===r.type)m(r.id)||t.push(r);else{if("link"!==r.type)throw new Error("The type of the item should be specified.");m(r.id1)||m(r.id2)?G[r.id]=r:t.push(r)}}return t},postMerge:function(t){var n=M();e.privateMerge(n,t)},preDelete:function(n){var r;n=F.ensureArray(n);var i=F.makeIdMap(n),a=t(i,"node"),o=[];for(r=0;r<a.length;r++)o.push(a[r].id);var s=t(i,"link"),c=e.privateGraph().neighbours(o,{all:!0}).links,f=F.makeIdMap(c);for(r=0;r<s.length;r++)f[s[r].id]=1;for(var l in G)if(l=""+l,l in f){if(y(l)){var h=w(l);for(r=0;r<h.length;r++)G[h[r].id]&&delete G[h[r].id]}}else{var m=G[l],p=g(m.id1),x=g(m.id2);(p in i||x in i)&&delete G[l]}for(r=0;r<a.length;r++){var M=a[r].id;u(M)&&d(M)}v()},serialize:K,loadUp:function(e){e?K(e):(H={},G={}),v()}}};return W}}();;

